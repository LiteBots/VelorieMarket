<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Velorie Market — Katalog ogłoszeń</title>
  <meta name="description" content="Velorie Market — katalog ogłoszeń freelancerów. Filtry, wyszukiwarka, profil, zapisane i panel konta." />
  <meta name="keywords" content="velorie market, freelancer, ogłoszenia, portfolio, katalog" />
  <meta name="theme-color" content="#0a1030" />

  <link rel="icon" type="image/png" href="favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --accent:#ff0354;
      --accent2:#7c3aed;
      --bg0:#00010f;
      --bg1:#0a1030;

      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.085);
      --border: rgba(255,255,255,.12);

      --muted: rgba(255,255,255,.75);
      --muted2: rgba(255,255,255,.58);

      --shadow: 0 18px 75px rgba(0,0,0,.62);
      --shadow2: 0 18px 70px rgba(255,3,84,.18);
      --ring: 0 0 0 1px rgba(255,255,255,.12) inset;

      --radius-xl: 26px;
      --radius-lg: 22px;
      --radius-md: 18px;

      --ease: cubic-bezier(.2,.9,.2,1);
    }

    html { scroll-behavior: smooth; }
    body{
      background-color: var(--bg0);
      background-image:
        radial-gradient(1200px 700px at 70% -10%, rgba(10,16,48,1) 0%, rgba(6,6,18,.9) 35%, rgba(0,1,15,1) 70%),
        radial-gradient(900px 550px at 12% 110%, rgba(255,3,84,.18) 0%, rgba(255,3,84,0) 62%),
        radial-gradient(850px 550px at 95% 85%, rgba(124,58,237,.16) 0%, rgba(124,58,237,0) 62%),
        radial-gradient(700px 420px at 40% 35%, rgba(0,163,255,.08) 0%, rgba(0,163,255,0) 70%);
      color: #fff;
      overflow-x: hidden;
    }

    /* scrollbars */
    ::-webkit-scrollbar{ width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb{ background: var(--accent); border-radius: 999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.08); }

    /* progress bar */
    #scroll-progress{
      position: fixed;
      inset: 0 0 auto 0;
      height: 2px;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), rgba(124,58,237,1), rgba(0,163,255,1));
      z-index: 90;
      box-shadow: 0 16px 60px rgba(255,3,84,.25);
    }

    /* subtle noise */
    .noise::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.06;
      mix-blend-mode: overlay;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='190' height='190'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='190' height='190' filter='url(%23n)' opacity='.6'/%3E%3C/svg%3E");
      background-size: 190px 190px;
    }

    /* animated grid */
    .grid-bg{
      position:absolute;
      inset:-1px;
      pointer-events:none;
      opacity:.18;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 44px 44px;
      mask-image: radial-gradient(60% 60% at 50% 35%, black 0%, transparent 70%);
      animation: gridFloat 14s var(--ease) infinite;
    }
    @keyframes gridFloat{
      0%,100%{ transform: translateY(0px); }
      50%{ transform: translateY(10px); }
    }

    /* aurora blobs */
    .aurora{
      position:absolute;
      inset:-200px -200px auto -200px;
      height: 520px;
      pointer-events:none;
      filter: blur(40px);
      opacity:.7;
    }
    .aurora::before, .aurora::after{
      content:"";
      position:absolute;
      width: 520px;
      height: 520px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,3,84,.38), rgba(255,3,84,0) 60%);
      animation: blob 16s var(--ease) infinite;
    }
    .aurora::after{
      right: 8%;
      top: 40px;
      width: 560px;
      height: 560px;
      background: radial-gradient(circle at 30% 30%, rgba(124,58,237,.30), rgba(124,58,237,0) 62%);
      animation-duration: 18s;
    }
    @keyframes blob{
      0%,100%{ transform: translate(0,0) scale(1); }
      50%{ transform: translate(40px, 14px) scale(1.06); }
    }

    /* reveal */
    .reveal{
      opacity: 0;
      transform: translateY(14px);
      transition: opacity .55s var(--ease), transform .55s var(--ease);
      will-change: opacity, transform;
    }
    .reveal.is-visible{ opacity: 1; transform: translateY(0); }

    /* glass surfaces */
    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .glass-soft{
      background: rgba(0,0,0,.40);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 55px rgba(0,0,0,.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    /* gradient border utility */
    .g-border{
      position: relative;
      border-radius: var(--radius-xl);
    }
    .g-border::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: inherit;
      background: linear-gradient(120deg, rgba(255,3,84,.55), rgba(124,58,237,.35), rgba(0,163,255,.25));
      opacity:.55;
      filter: blur(.1px);
      z-index: 0;
      pointer-events:none;
    }
    .g-border > *{ position: relative; z-index: 1; }

    /* chips */
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding: .50rem .72rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.13);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.86);
      font-size: 12px;
      line-height: 1;
      white-space: nowrap;
      user-select:none;
      transition: background .15s var(--ease), border-color .15s var(--ease), transform .15s var(--ease), filter .15s var(--ease);
    }
    .chip:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.20); filter: brightness(1.02); }
    .chip:active{ transform: translateY(1px); }
    .chip[data-active="true"]{
      background: rgba(255,3,84,.16);
      border-color: rgba(255,3,84,.45);
    }

    /* buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.55rem;
      border-radius: 16px;
      padding: .85rem 1.05rem;
      font-weight: 850;
      letter-spacing: -.01em;
      transition: transform .14s var(--ease), filter .14s var(--ease), background .14s var(--ease), border-color .14s var(--ease), box-shadow .14s var(--ease);
      user-select:none;
      transform: translateZ(0);
    }
    .btn:active{ transform: translateY(1px); }

    .btn-primary{
      background: linear-gradient(180deg, rgba(255,3,84,1) 0%, rgba(255,3,84,.86) 100%);
      color: #0b0010;
      box-shadow: 0 18px 70px rgba(255,3,84,.22);
    }
    .btn-primary:hover{ filter: brightness(1.07); box-shadow: 0 18px 80px rgba(255,3,84,.28); }

    .btn-ghost{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }

    .btn-outline{
      background: transparent;
      border: 1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.92);
    }
    .btn-outline:hover{ background: rgba(255,255,255,.06); }

    /* badges */
    .badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size: 12px;
      font-weight: 900;
      padding: .28rem .62rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.94);
    }
    .badge-verified{ background: rgba(124,58,237,.18); }
    .badge-premium{ background: rgba(255,3,84,.18); }

    /* portfolio thumbs */
    .thumb{
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      box-shadow: 0 12px 38px rgba(0,0,0,.28);
      position: relative;
    }
    .thumb::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.25) 100%);
      opacity:.0;
      transition: opacity .25s var(--ease);
    }
    .thumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
      transform: scale(1.03);
      transition: transform .35s var(--ease);
    }
    .thumb:hover img{ transform: scale(1.09); }
    .thumb:hover::after{ opacity:.6; }

    /* profile card */
    .profile-card{
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 14px 70px rgba(0,0,0,.50);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      transition: transform .16s var(--ease), background .16s var(--ease), border-color .16s var(--ease), box-shadow .16s var(--ease);
      position: relative;
      overflow: hidden;
    }
    .profile-card::before{
      content:"";
      position:absolute;
      inset:-120px -120px auto -120px;
      height: 180px;
      background: radial-gradient(closest-side at 20% 30%, rgba(255,3,84,.18), rgba(255,3,84,0)),
                  radial-gradient(closest-side at 80% 35%, rgba(124,58,237,.14), rgba(124,58,237,0));
      opacity: .9;
      pointer-events:none;
      filter: blur(8px);
    }
    .profile-card:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.062);
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 18px 85px rgba(0,0,0,.56);
    }

    .avatar{
      width: 58px;
      height: 58px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      flex: 0 0 auto;
      background: rgba(255,255,255,.06);
    }
    .avatar img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    /* overlay + drawer + modal */
    .overlay{
      position: fixed;
      inset: 0;
      z-index: 110;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      display: none;
      opacity: 0;
      transition: opacity .2s var(--ease);
    }
    .overlay[data-open="true"]{
      display:block;
      opacity: 1;
    }

    .drawer{
      position: fixed;
      inset: 0 0 0 auto;
      width: min(680px, 94vw);
      z-index: 140;
      transform: translateX(110%);
      transition: transform .28s var(--ease);
      display: flex;
      flex-direction: column;
      border-left: 1px solid rgba(255,255,255,.10);
    }
    .drawer[data-open="true"]{ transform: translateX(0%); }

    .modal{
      position: fixed;
      inset: 0;
      z-index: 150;
      display: none;
      place-items: center;
      padding: 16px;
    }
    .modal[data-open="true"]{ display: grid; }
    .modal-card{
      width: min(1020px, 96vw);
      max-height: min(86vh, 820px);
      overflow: hidden;
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(5,6,10,.80), rgba(5,6,10,.70));
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 22px 100px rgba(0,0,0,.70);
      transform: translateY(6px) scale(.99);
      animation: pop .22s var(--ease) forwards;
    }
    @keyframes pop{
      to{ transform: translateY(0) scale(1); }
    }

    .divider{ height: 1px; background: rgba(255,255,255,.10); }

    /* inputs */
    .input{
      width: 100%;
      border-radius: 16px;
      padding: .82rem .95rem;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      outline: none;
      transition: border-color .15s var(--ease), background .15s var(--ease), box-shadow .15s var(--ease);
      -webkit-appearance:none;
      appearance:none;
    }
    .input:focus{
      border-color: rgba(255,3,84,.60);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 4px rgba(255,3,84,.12);
    }
    .label{
      font-size: 12px;
      color: rgba(255,255,255,.70);
      margin-bottom: .35rem;
      display:block;
    }

    /* sticky filters bar */
    #filters-bar{
      position: sticky;
      top: 66px;
      z-index: 70;
    }

    /* skeleton */
    .skel{
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      overflow: hidden;
      position: relative;
    }
    .skel::after{
      content:"";
      position:absolute;
      inset:-40% -60%;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.10) 50%, transparent 100%);
      transform: rotate(8deg);
      animation: shimmer 1.1s infinite;
    }
    @keyframes shimmer{
      0%{ transform: translateX(-42%) rotate(8deg); }
      100%{ transform: translateX(42%) rotate(8deg); }
    }

    /* focus */
    :focus-visible{
      outline: none;
      box-shadow: 0 0 0 4px rgba(255,3,84,.16);
      border-radius: 16px;
    }

    /* Active filter pills */
    .pill {
      display:inline-flex;
      align-items:center;
      gap:.48rem;
      padding:.48rem .74rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: rgba(255,255,255,.88);
      font-size: 12px;
      line-height:1;
      white-space: nowrap;
    }
    .pill button{
      width:18px;height:18px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
    }
    .pill button:hover{ background: rgba(255,255,255,.14); }

    /* mobile bottom bar */
    #mobile-bar{
      position: fixed;
      inset: auto 0 0 0;
      z-index: 95;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      display: none;
    }
    @media (max-width: 768px){
      #mobile-bar{ display: block; }
    }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior: auto; }
      .grid-bg, .aurora::before, .aurora::after{ animation: none !important; }
      .reveal{ transition: none !important; }
      .modal-card{ animation: none !important; transform: none !important; }
      .skel::after{ animation: none !important; }
      .btn, .profile-card, .thumb img{ transition: none !important; }
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: { glow: "0 18px 80px rgba(255,3,84,0.28)" }
        }
      }
    };
  </script>
</head>

<body class="min-h-screen text-white selection:bg-[#ff0354]/40 selection:text-white">
  <div id="scroll-progress" aria-hidden="true"></div>

  <!-- BACKGROUND LAYERS -->
  <div class="pointer-events-none fixed inset-0 -z-10 noise">
    <div class="aurora"></div>
    <div class="grid-bg"></div>
  </div>

  <!-- HEADER -->
  <header class="sticky top-0 z-[85] backdrop-blur-xl bg-black/25 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-3">
      <a href="#katalog" class="flex items-center gap-3 group">
        <img src="https://i.imgur.com/ikYb7tH.png" alt="Velorie" class="h-10 w-10 rounded-xl ring-1 ring-white/10 group-hover:ring-white/20 transition" />
        <div class="leading-tight">
          <div class="text-lg font-black tracking-tight">
            Velorie Market
            <span class="ml-2 inline-flex items-center gap-1 text-[10px] font-black text-white/70 bg-white/5 border border-white/10 px-2 py-1 rounded-full align-middle">
              <i data-lucide="sparkles" class="h-3 w-3 text-[var(--accent)]"></i>
              app-feel
            </span>
          </div>
          <div class="text-xs text-white/60">Katalog ogłoszeń • Filtry • Zapisane • Profil</div>
        </div>
      </a>

      <div class="hidden md:flex items-center gap-2">
        <button id="btn-jump-search" class="btn btn-outline px-4 py-2 text-sm" type="button" aria-label="Przejdź do wyszukiwarki">
          <i data-lucide="search" class="h-4 w-4"></i>
          <span>Szukaj</span>
          <span class="ml-1 text-[10px] px-2 py-1 rounded-full bg-white/5 border border-white/10 text-white/70 font-black">/</span>
        </button>

        <button id="btn-open-saved" class="btn btn-ghost px-4 py-2 text-sm" type="button" aria-label="Włącz filtr: zapisane">
          <i data-lucide="bookmark" class="h-4 w-4"></i>
          <span>Zapisane</span>
          <span id="saved-pill" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
        </button>

        <button id="btn-open-panel" class="btn btn-ghost px-4 py-2 text-sm" type="button" aria-label="Otwórz konto">
          <i data-lucide="user" class="h-4 w-4"></i>
          <span>Konto</span>
        </button>
      </div>

      <!-- mobile header actions -->
      <div class="flex md:hidden items-center gap-2">
        <button id="btn-open-saved-m" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Zapisane">
          <i data-lucide="bookmark" class="h-4 w-4"></i>
          <span id="saved-pill-m" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
        </button>
        <button id="btn-open-panel-m" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Konto">
          <i data-lucide="user" class="h-4 w-4"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- OVERLAY -->
  <div id="overlay" class="overlay" data-open="false" aria-hidden="true"></div>

  <main id="katalog" class="relative py-10">
    <div class="mx-auto max-w-7xl px-4">

      <!-- TOP -->
      <section class="reveal g-border">
        <div class="glass rounded-[26px] p-6 md:p-7">
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
            <div class="max-w-2xl">
              <div class="inline-flex items-center gap-2 text-xs font-black text-white/70 bg-white/5 border border-white/10 px-3 py-2 rounded-full">
                <i data-lucide="shield" class="h-4 w-4 text-[var(--accent)]"></i>
                kontakt bezpośredni • bez escrow • bez prowizji
              </div>

              <h1 class="mt-3 text-3xl md:text-4xl font-black tracking-tight leading-[1.05]">
                Katalog ogłoszeń
              </h1>

              <p class="text-white/65 mt-3 leading-relaxed">
                Wyszukuj, filtruj, zapisuj i otwieraj profile. Panel konta służy do edycji profilu publicznego i ogłoszenia.
              </p>

              <div class="mt-4 flex flex-wrap items-center gap-2 text-xs text-white/60">
                <span class="chip"><i data-lucide="sparkles" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium = wyróżnienie</span>
                <span class="chip"><i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Verified = zaufanie</span>
                <span class="chip"><i data-lucide="keyboard" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Skróty: <b>/</b> szukaj, <b>Esc</b> zamyka</span>
              </div>
            </div>

            <!-- quick stats -->
            <div class="min-w-[260px] w-full lg:w-[340px]">
              <div class="grid grid-cols-3 gap-2">
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Wyniki</div>
                  <div class="text-2xl font-black" id="stat-results">0</div>
                </div>
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Zapisane</div>
                  <div class="text-2xl font-black" id="stat-saved">0</div>
                </div>
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Filtry</div>
                  <div class="text-2xl font-black" id="stat-filters">0</div>
                </div>
              </div>

              <div class="mt-3 flex items-center justify-between text-xs text-white/55">
                <span class="inline-flex items-center gap-2">
                  <i data-lucide="activity" class="h-4 w-4 text-[var(--accent)]"></i>
                  “App feeling” UI (bez frameworka)
                </span>
                <span id="results-hint"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- FILTERS BAR -->
      <div id="filters-bar" class="mt-6">
        <div class="glass rounded-[26px] p-4 md:p-5 reveal">
          <div class="flex flex-col gap-4">

            <!-- Row 1: Search + Sort -->
            <div class="grid lg:grid-cols-12 gap-3 items-end">
              <div class="lg:col-span-6">
                <label class="label">Szukaj</label>
                <div class="relative">
                  <input id="search-input" class="input pr-10" placeholder="Szukaj po nazwie, tagach, opisie..." />
                  <div class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-white/55">
                    <i data-lucide="search" class="h-4 w-4"></i>
                  </div>
                </div>
                <div class="mt-2 text-[11px] text-white/50 flex items-center gap-2">
                  <i data-lucide="sparkles" class="h-3.5 w-3.5 text-[var(--accent)]"></i>
                  Podpowiedź: wpisz np. <span class="text-white/70 font-semibold">“react”</span>, <span class="text-white/70 font-semibold">“branding”</span>, <span class="text-white/70 font-semibold">“linux”</span>.
                </div>
              </div>

              <div class="lg:col-span-3">
                <label class="label">Branża</label>
                <select id="industry-select" class="input">
                  <option value="all">Wszystkie</option>
                  <option value="dev">Programista</option>
                  <option value="gfx">Grafik</option>
                  <option value="video">Montażysta / Content</option>
                  <option value="tech">Technik / DevOps</option>
                  <option value="mc">Budowniczy Minecraft</option>
                </select>
              </div>

              <div class="lg:col-span-3">
                <label class="label">Sortowanie</label>
                <select id="sort-select" class="input">
                  <option value="recommended">Polecane</option>
                  <option value="newest">Najnowsze</option>
                  <option value="rating">Najwyższa ocena</option>
                  <option value="verified">Zweryfikowani</option>
                </select>
              </div>
            </div>

            <!-- Row 2: Quick toggles + Budget -->
            <div class="grid lg:grid-cols-12 gap-3 items-end">
              <div class="lg:col-span-6">
                <label class="label">Szybkie filtry</label>
                <div class="flex flex-wrap gap-2">
                  <button id="filter-saved" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="bookmark" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Zapisane
                  </button>
                  <button id="filter-premium" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="zap" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium
                  </button>
                  <button id="filter-verified" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Verified
                  </button>
                  <button id="filter-available" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny ≤72h
                  </button>
                </div>
              </div>

              <div class="lg:col-span-6">
                <label class="label">Budżet (PLN)</label>
                <div class="grid grid-cols-2 gap-2">
                  <input id="budget-min" class="input" type="number" min="0" step="10" placeholder="Min. np. 100" />
                  <input id="budget-max" class="input" type="number" min="0" step="10" placeholder="Max. np. 1000" />
                </div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <button class="chip" type="button" data-budget-preset="300">≤ 300</button>
                  <button class="chip" type="button" data-budget-preset="500">≤ 500</button>
                  <button class="chip" type="button" data-budget-preset="1000">≤ 1000</button>
                  <button class="chip" type="button" data-budget-preset="0">Bez limitu</button>
                </div>
              </div>
            </div>

            <!-- Row 3: Active filters pills -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
              <div class="text-xs text-white/60 flex items-center gap-2">
                <i data-lucide="info" class="h-4 w-4"></i>
                <span>Kontakt i rozliczenia odbywają się bezpośrednio między stronami.</span>
              </div>

              <div class="flex items-center gap-2">
                <div id="active-filters" class="hidden sm:flex flex-wrap gap-2 justify-end"></div>

                <button id="btn-reset-filters" class="btn btn-outline px-3 py-2 text-xs" type="button">
                  <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                  Wyczyść
                </button>

                <button id="btn-open-panel-inline" class="btn btn-primary px-3 py-2 text-xs" type="button">
                  <i data-lucide="sliders-horizontal" class="h-4 w-4"></i>
                  Konto
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- RESULTS -->
      <section class="mt-8">
        <div class="flex items-center justify-between gap-3 mb-3">
          <div class="text-sm text-white/70 flex items-center gap-2">
            <i data-lucide="layers" class="h-4 w-4 text-[var(--accent)]"></i>
            <span>Wyświetlane: <b id="shown-count">0</b> / <b id="total-count">0</b></span>
          </div>
          <div class="text-[11px] text-white/50 hidden md:block">
            Kliknij kartę profilu, aby otworzyć modal. Strzałki ←/→ działają w modalu.
          </div>
        </div>

        <div class="space-y-4" id="profiles-list">
          <!-- filled by JS -->
        </div>
      </section>

      <!-- Pagination -->
      <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-3 text-sm text-white/70">
        <div class="flex items-center gap-2">
          <i data-lucide="sparkles" class="h-4 w-4 text-[var(--accent)]"></i>
          <span class="text-white/60">Tip:</span>
          <span>Użyj <b class="text-white/90">Zapisane</b> do shortlisty.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="btn-load-more" class="btn btn-ghost px-4 py-2" type="button">
            <i data-lucide="plus" class="h-4 w-4"></i>
            <span>Wczytaj więcej</span>
          </button>
        </div>
      </div>

      <!-- FOOTER -->
      <footer class="mt-10 pb-24 md:pb-8 text-xs text-white/50">
        <div class="glass rounded-[26px] p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 reveal">
          <div class="flex items-center gap-2">
            <i data-lucide="sparkles" class="h-4 w-4 text-[var(--accent)]"></i>
            <span>Velorie Market • Platforma ogłoszeń freelancerów</span>
          </div>
          <div class="flex items-center gap-2">
            <span id="footer-year"></span>
            <span>•</span>
            <span class="text-white/60">Made for fast MVP</span>
          </div>
        </div>
      </footer>

    </div>
  </main>

  <!-- MOBILE BAR -->
  <div id="mobile-bar" class="pointer-events-none">
    <div class="pointer-events-auto glass rounded-[22px] px-3 py-2 flex items-center justify-between gap-2">
      <button id="m-search" class="btn btn-outline px-3 py-2 text-sm" type="button" aria-label="Szukaj">
        <i data-lucide="search" class="h-4 w-4"></i>
        <span>Szukaj</span>
      </button>
      <button id="m-saved" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Zapisane">
        <i data-lucide="bookmark" class="h-4 w-4"></i>
        <span id="m-saved-count" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
      </button>
      <button id="m-account" class="btn btn-primary px-3 py-2 text-sm" type="button" aria-label="Konto">
        <i data-lucide="user" class="h-4 w-4"></i>
        <span>Konto</span>
      </button>
    </div>
  </div>

  <!-- PROFILE MODAL -->
  <section id="profile-modal" class="modal" data-open="false" aria-label="Profil" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="p-4 flex items-center justify-between gap-3 border-b border-white/10">
        <div class="flex items-center gap-3 min-w-0">
          <div class="avatar">
            <img id="modal-avatar" src="" alt="Avatar profilu" />
          </div>
          <div class="leading-tight min-w-0">
            <div class="flex items-center gap-2 flex-wrap">
              <div class="text-lg md:text-xl font-black tracking-tight truncate" id="modal-name">Profil</div>
              <span id="modal-badges" class="flex items-center gap-2"></span>
            </div>
            <div class="text-xs text-white/60 truncate" id="modal-sub">—</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button id="modal-prev" class="btn btn-ghost px-3 py-2" type="button" aria-label="Poprzedni profil">
            <i data-lucide="chevron-left" class="h-4 w-4"></i>
          </button>
          <button id="modal-next" class="btn btn-ghost px-3 py-2" type="button" aria-label="Następny profil">
            <i data-lucide="chevron-right" class="h-4 w-4"></i>
          </button>
          <button id="modal-close" class="btn btn-outline px-3 py-2" type="button" aria-label="Zamknij modal">
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>
      </div>

      <div class="grid lg:grid-cols-12 gap-0">
        <div class="lg:col-span-7 p-4 border-b lg:border-b-0 lg:border-r border-white/10">
          <div class="flex flex-wrap items-center gap-2" id="modal-chips"></div>

          <div class="mt-4 grid grid-cols-3 gap-2" id="modal-portfolio"></div>

          <div class="mt-4 glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="file-text" class="h-4 w-4 text-[var(--accent)]"></i>
              Opis
            </div>
            <p class="mt-2 text-sm text-white/75 leading-relaxed whitespace-pre-line" id="modal-about"></p>
          </div>
        </div>

        <div class="lg:col-span-5 p-4">
          <div class="glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="message-circle" class="h-4 w-4 text-[var(--accent)]"></i>
              Kontakt
            </div>
            <p class="mt-2 text-sm text-white/70">
              Skopiuj nick i odezwij się wybranym kanałem. (Demo nie wysyła wiadomości.)
            </p>

            <div class="mt-3 grid sm:grid-cols-2 gap-2">
              <button id="btn-copy-name" class="btn btn-primary px-4 py-3" type="button">
                <i data-lucide="copy" class="h-4 w-4"></i>
                Kopiuj nick
              </button>
              <button id="btn-save-from-modal" class="btn btn-ghost px-4 py-3" type="button">
                <i data-lucide="bookmark" class="h-4 w-4"></i>
                Zapisz
              </button>
            </div>

            <div class="mt-4 divider"></div>

            <div class="mt-4 text-xs text-white/55">
              Tip: Link do profilu zawiera <span class="text-white/70 font-semibold">#profile=ID</span>.
            </div>
          </div>

          <div class="mt-3 glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="shield-alert" class="h-4 w-4 text-[var(--accent)]"></i>
              Bezpieczeństwo
            </div>
            <ul class="mt-2 text-sm text-white/70 list-disc pl-5 space-y-1">
              <li>Ustalaj warunki współpracy na piśmie.</li>
              <li>Nie udostępniaj haseł ani kodów przed ustaleniem zasad.</li>
              <li>W razie podejrzeń — zgłaszaj naruszenia.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- USER PANEL (drawer) -->
  <aside id="user-panel" class="drawer glass-soft" data-open="false" aria-label="Panel konta">
    <div class="p-4 flex items-center justify-between gap-3 border-b border-white/10">
      <div class="flex items-center gap-3 min-w-0">
        <div class="avatar">
          <img id="panel-avatar" src="" alt="Ty" />
        </div>
        <div class="leading-tight min-w-0">
          <div class="font-black tracking-tight">Konto</div>
          <div class="text-xs text-white/60 truncate">
            <span id="panel-username"></span> • <span id="panel-status">Aktywne konto</span>
          </div>
        </div>
      </div>
      <button id="btn-close-panel" class="btn btn-outline px-3 py-2" type="button">
        <i data-lucide="x" class="h-4 w-4"></i>
        <span class="hidden sm:inline">Zamknij</span>
      </button>
    </div>

    <div class="px-4 py-3 text-xs text-white/65 border-b border-white/10 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <i data-lucide="circle-check" class="h-4 w-4 text-[var(--accent)]"></i>
        <span id="save-status">Wszystko zapisane</span>
      </div>
      <div class="text-white/55">
        Plan: <span id="plan-status" class="text-white/80 font-semibold">Standard</span>
      </div>
    </div>

    <!-- tabs -->
    <div class="p-4">
      <div class="grid grid-cols-2 gap-2">
        <button class="btn btn-ghost px-4 py-3" data-tab="edit" type="button">
          <i data-lucide="pencil" class="h-4 w-4"></i>
          <span>Profil</span>
        </button>
        <button class="btn btn-ghost px-4 py-3" data-tab="preview" type="button">
          <i data-lucide="eye" class="h-4 w-4"></i>
          <span>Podgląd</span>
        </button>
        <button class="btn btn-ghost px-4 py-3" data-tab="listing" type="button">
          <i data-lucide="file-plus" class="h-4 w-4"></i>
          <span>Ogłoszenie</span>
        </button>
        <button class="btn btn-primary px-4 py-3" data-tab="shop" type="button">
          <i data-lucide="shopping-bag" class="h-4 w-4"></i>
          <span>Plany</span>
        </button>
      </div>
    </div>

    <div class="divider"></div>

    <!-- tab content -->
    <div class="p-4 space-y-4 overflow-auto" style="height: calc(100vh - 230px);">

      <!-- EDIT PROFILE -->
      <section id="tab-edit" class="space-y-4">
        <div class="glass rounded-[22px] p-5">
          <div class="font-black flex items-center gap-2">
            <i data-lucide="pencil" class="h-5 w-5 text-[var(--accent)]"></i>
            Dane profilu
          </div>

          <div class="mt-4 grid sm:grid-cols-2 gap-3">
            <div>
              <label class="label">Nick / Imię</label>
              <input id="edit-name" class="input" />
              <div class="mt-1 text-xs text-white/45">Min. 2 znaki.</div>
            </div>
            <div>
              <label class="label">Branża</label>
              <select id="edit-industry" class="input">
                <option value="dev">Programista</option>
                <option value="gfx">Grafik</option>
                <option value="video">Montażysta / Content</option>
                <option value="tech">Technik / DevOps</option>
                <option value="mc">Budowniczy Minecraft</option>
              </select>
            </div>

            <div class="sm:col-span-2">
              <label class="label">Opis</label>
              <textarea id="edit-about" class="input" rows="5" placeholder="Napisz kilka zdań o sobie..."></textarea>
            </div>

            <div>
              <label class="label">Dostępność</label>
              <select id="edit-availability" class="input">
                <option>24h</option>
                <option>48h</option>
                <option>72h</option>
                <option>Tydzień</option>
              </select>
            </div>

            <div>
              <label class="label">Budżet minimalny (PLN)</label>
              <input id="edit-budget" class="input" type="number" min="0" step="1" />
            </div>

            <div class="sm:col-span-2">
              <label class="label">Tagi (oddziel przecinkami)</label>
              <input id="edit-tags" class="input" placeholder="React, Node, API..." />
              <div class="mt-1 text-xs text-white/45">Max 12 tagów.</div>
            </div>

            <div class="sm:col-span-2">
              <label class="label">Avatar (URL)</label>
              <input id="edit-avatar-url" class="input" placeholder="https://..." />
              <div class="mt-1 text-xs text-white/45">Jeśli puste — zostaje obecny.</div>
            </div>
          </div>

          <div class="mt-4 flex flex-wrap items-center gap-2">
            <button id="btn-save-profile" class="btn btn-primary px-4 py-3" type="button">
              <i data-lucide="save" class="h-4 w-4"></i>
              <span>Zapisz</span>
            </button>
            <button id="btn-reset-profile" class="btn btn-ghost px-4 py-3" type="button">
              <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
              <span>Przywróć</span>
            </button>
            <button id="btn-open-me-modal" class="btn btn-outline px-4 py-3" type="button">
              <i data-lucide="external-link" class="h-4 w-4"></i>
              <span>Otwórz profil</span>
            </button>
          </div>
        </div>

        <div class="glass rounded-[22px] p-5">
          <div class="font-black flex items-center gap-2">
            <i data-lucide="images" class="h-5 w-5 text-[var(--accent)]"></i>
            Portfolio (3 zdjęcia)
          </div>
          <p class="mt-2 text-sm text-white/70">
            Widoczne w katalogu i w profilu.
          </p>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div>
              <label class="label">Zdjęcie 1 URL</label>
              <input id="edit-portfolio-1" class="input" placeholder="https://..." />
            </div>
            <div>
              <label class="label">Zdjęcie 2 URL</label>
              <input id="edit-portfolio-2" class="input" placeholder="https://..." />
            </div>
            <div>
              <label class="label">Zdjęcie 3 URL</label>
              <input id="edit-portfolio-3" class="input" placeholder="https://..." />
            </div>
          </div>
        </div>
      </section>

      <!-- PREVIEW -->
      <section id="tab-preview" class="space-y-4 hidden">
        <div class="glass rounded-[22px] p-5">
          <div class="font-black flex items-center gap-2">
            <i data-lucide="eye" class="h-5 w-5 text-[var(--accent)]"></i>
            Podgląd profilu
          </div>
          <p class="mt-2 text-sm text-white/70">
            Ten podgląd pokazuje jak Twoja karta wygląda w katalogu.
          </p>

          <div class="mt-4" id="preview-card"></div>
        </div>
      </section>

      <!-- LISTING -->
      <section id="tab-listing" class="space-y-4 hidden">
        <div class="glass rounded-[22px] p-5">
          <div class="font-black flex items-center gap-2">
            <i data-lucide="file-plus" class="h-5 w-5 text-[var(--accent)]"></i>
            Ogłoszenie
          </div>
          <p class="mt-2 text-sm text-white/70">
            Uzupełnij opis i opublikuj wizytówkę w katalogu.
          </p>

          <div class="mt-4 grid sm:grid-cols-2 gap-3">
            <div>
              <label class="label">Tytuł ogłoszenia</label>
              <input id="listing-title" class="input" placeholder="np. Programista React/Node — szybkie MVP" />
            </div>
            <div>
              <label class="label">Kanał kontaktu (główny)</label>
              <select id="listing-contact-main" class="input">
                <option>Discord</option>
                <option>E-mail</option>
                <option>Instagram</option>
                <option>Facebook</option>
              </select>
            </div>

            <div class="sm:col-span-2">
              <label class="label">Krótki opis</label>
              <input id="listing-short" class="input" placeholder="2–3 zdania: co robisz i dla kogo." />
            </div>

            <div class="sm:col-span-2">
              <label class="label">Dłuższy opis</label>
              <textarea id="listing-long" class="input" rows="6" placeholder="Szczegóły usług, proces, terminy, zasady..."></textarea>
            </div>
          </div>

          <div class="mt-4 flex flex-wrap items-center gap-2">
            <button id="btn-publish" class="btn btn-primary px-4 py-3" type="button">
              <i data-lucide="rocket" class="h-4 w-4"></i>
              <span>Opublikuj / Zaktualizuj</span>
            </button>
            <button id="btn-unpublish" class="btn btn-outline px-4 py-3" type="button">
              <i data-lucide="eye-off" class="h-4 w-4"></i>
              <span>Ukryj</span>
            </button>
          </div>
        </div>
      </section>

      <!-- SHOP -->
      <section id="tab-shop" class="space-y-4">
        <div class="glass rounded-[22px] p-5">
          <div class="font-black flex items-center gap-2">
            <i data-lucide="shopping-bag" class="h-5 w-5 text-[var(--accent)]"></i>
            Plany i wyróżnienia
          </div>
          <p class="mt-2 text-sm text-white/70">
            Aktywny plan wpływa na widoczność oraz oznaczenia profilu w wynikach.
          </p>

          <div class="mt-4 space-y-3">
            <div class="rounded-[22px] border border-white/10 bg-white/5 p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="flex items-center gap-2">
                    <span class="badge badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>
                  </div>
                  <p class="mt-2 text-sm text-white/70">Wyżej w wynikach i wyróżnienie profilu.</p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-black">23.99 PLN</div>
                  <div class="text-xs text-white/55">/ miesiąc</div>
                </div>
              </div>

              <div class="mt-3 flex flex-col sm:flex-row gap-2">
                <button id="buy-premium" class="btn btn-primary px-4 py-3" type="button">
                  <i data-lucide="credit-card" class="h-4 w-4"></i>
                  <span>Aktywuj</span>
                </button>
                <button id="cancel-premium" class="btn btn-outline px-4 py-3" type="button">
                  <i data-lucide="x-circle" class="h-4 w-4"></i>
                  <span>Wyłącz</span>
                </button>
              </div>
            </div>

            <div class="rounded-[22px] border border-white/10 bg-white/5 p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="flex items-center gap-2">
                    <span class="badge badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>
                  </div>
                  <p class="mt-2 text-sm text-white/70">Oznaczenie zaufanego profilu.</p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-black">19.55 PLN</div>
                  <div class="text-xs text-white/55">/ miesiąc</div>
                </div>
              </div>

              <div class="mt-3 flex flex-col sm:flex-row gap-2">
                <button id="buy-verify" class="btn btn-primary px-4 py-3" type="button">
                  <i data-lucide="badge-check" class="h-4 w-4"></i>
                  <span>Aktywuj</span>
                </button>
                <button id="cancel-verify" class="btn btn-outline px-4 py-3" type="button">
                  <i data-lucide="x-circle" class="h-4 w-4"></i>
                  <span>Wyłącz</span>
                </button>
              </div>
            </div>

            <div class="text-xs text-white/55">
              Zarządzanie subskrypcją i płatnościami jest dostępne z poziomu konta. (Demo)
            </div>
          </div>
        </div>
      </section>
    </div>
  </aside>

<script>
/**
 * Velorie Market — “UX upgrade”
 * - lepszy UI (hero card, aurora, micro-interactions)
 * - skróty klawiaturowe: / focus search, Esc zamyka, ←/→ w modalu
 * - poprawione A11y: focus trap, scroll lock, lepsze aria
 * - mobilny bottom bar
 * - łagodniejsze animacje i prefers-reduced-motion
 */

(() => {
  /* ----------------------------- helpers ----------------------------- */
  const $ = (sel, root = document) => root.querySelector(sel);
  const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

  const safeJSON = {
    parse(v, fallback) { try { return JSON.parse(v); } catch { return fallback; } },
    stringify(v, fallback = "{}") { try { return JSON.stringify(v); } catch { return fallback; } }
  };

  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const now = () => Date.now();

  function escapeHTML(str) {
    return String(str ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function debounce(fn, delay = 250) {
    let t = null;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), delay);
    };
  }

  const setSaveStatus = (txt) => { $("#save-status") && ($("#save-status").textContent = txt); };

  /* ------------------------------ toast ------------------------------ */
  const Toast = (() => {
    let wrap = null;
    let queue = [];
    let showing = false;

    function ensure() {
      if (wrap) return wrap;
      wrap = document.createElement("div");
      wrap.id = "toast-wrap";
      wrap.className = "fixed bottom-5 left-1/2 -translate-x-1/2 z-[200] space-y-2";
      document.body.appendChild(wrap);
      return wrap;
    }

    function showNext() {
      if (showing) return;
      const item = queue.shift();
      if (!item) return;

      showing = true;
      ensure();

      const el = document.createElement("div");
      el.className = "glass rounded-2xl px-4 py-3 text-sm text-white/90 border border-white/10 shadow-glow max-w-[92vw] flex items-center gap-2";
      el.innerHTML = `<span class="inline-flex items-center justify-center w-7 h-7 rounded-xl bg-white/5 border border-white/10">
        <i data-lucide="${item.icon || "sparkles"}" class="h-4 w-4 text-[var(--accent)]"></i>
      </span><span>${escapeHTML(item.message)}</span>`;
      wrap.appendChild(el);
      try { lucide.createIcons(); } catch {}

      setTimeout(() => {
        el.style.opacity = "0";
        el.style.transform = "translateY(6px)";
        el.style.transition = "opacity .25s ease, transform .25s ease";
        setTimeout(() => {
          el.remove();
          showing = false;
          showNext();
        }, 260);
      }, item.ms || 1700);
    }

    return {
      push(message, icon = "sparkles", ms = 1700) {
        queue.push({ message, icon, ms });
        showNext();
      }
    };
  })();

  /* ----------------------------- storage ----------------------------- */
  const LS = {
    keyProfiles: "vm_profiles_v2",
    keySaved: "vm_saved_v2",
    keySubs: "vm_subs_v2",
    keyMe: "vm_me_v2",
    getProfiles() {
      const v = localStorage.getItem(this.keyProfiles);
      return safeJSON.parse(v, null);
    },
    setProfiles(list) {
      localStorage.setItem(this.keyProfiles, safeJSON.stringify(list, "[]"));
    },
    getSaved() {
      const v = localStorage.getItem(this.keySaved);
      return new Set(safeJSON.parse(v, []));
    },
    setSaved(setOrArr) {
      const arr = Array.isArray(setOrArr) ? setOrArr : Array.from(setOrArr);
      localStorage.setItem(this.keySaved, safeJSON.stringify(arr, "[]"));
    },
    getSubs() {
      const v = localStorage.getItem(this.keySubs);
      return safeJSON.parse(v, { premium: false, verified: false });
    },
    setSubs(obj) {
      localStorage.setItem(this.keySubs, safeJSON.stringify(obj, "{}"));
    },
    getMe() {
      const v = localStorage.getItem(this.keyMe);
      return safeJSON.parse(v, null);
    },
    setMe(obj) {
      localStorage.setItem(this.keyMe, safeJSON.stringify(obj, "{}"));
    }
  };

  /* ----------------------------- seed data ---------------------------- */
  const FALLBACK_PROFILES = [
    {
      id: "p1",
      name: "zxq0",
      industry: "dev",
      industryLabel: "Programista",
      tagline: "React • Node • API • Automatyzacje",
      about: "Buduję szybkie MVP, integracje i automatyzacje. Działam konkretnie: zakres → prototyp → wdrożenie.\n\nPreferuję: React, Node, API, deployment, dashboardy.",
      rating: 4.9,
      availableIn: "48h",
      minBudget: 300,
      location: "Online",
      premium: true,
      verified: true,
      avatar: "https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
      portfolio: [
        "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
      ],
      createdAt: now() - 1000 * 60 * 60 * 24 * 10
    },
    {
      id: "p2",
      name: "Klaudia",
      industry: "gfx",
      industryLabel: "Grafik",
      tagline: "Branding • UI • Miniatury • Packi",
      about: "Robię branding, UI i grafiki pod social. Lubię mocny kontrast i clean systemy.\n\nDostarczam pliki + guideline (opcjonalnie).",
      rating: 4.7,
      availableIn: "24h",
      minBudget: 200,
      location: "Online",
      premium: true,
      verified: false,
      avatar: "https://images.unsplash.com/photo-1548142813-c348350df52b?q=80&w=512&auto=format&fit=crop",
      portfolio: [
        "https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=900&auto=format&fit=crop"
      ],
      createdAt: now() - 1000 * 60 * 60 * 24 * 4
    },
    {
      id: "p3",
      name: "kubus",
      industry: "tech",
      industryLabel: "Technik / DevOps",
      tagline: "Linux • Proxy • Security • Optymalizacja",
      about: "Pomagam z serwerami, bezpieczeństwem i optymalizacją. Ustawiam proxy, monitoring, backupy.\n\nW cenie: checklist + rekomendacje.",
      rating: 4.8,
      availableIn: "72h",
      minBudget: 250,
      location: "Online",
      premium: false,
      verified: true,
      avatar: "https://images.unsplash.com/photo-1603415526960-f7e0328b7cf6?q=80&w=512&auto=format&fit=crop",
      portfolio: [
        "https://images.unsplash.com/photo-1531297484001-80022131f5a1?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop"
      ],
      createdAt: now() - 1000 * 60 * 60 * 24 * 7
    }
  ];

  function ensureInit() {
    if (!LS.getProfiles()) LS.setProfiles(FALLBACK_PROFILES);

    if (!LS.getMe()) {
      LS.setMe({
        id: "me",
        name: "zxq0",
        industry: "dev",
        about: "Tworzę produkty web, automatyzacje i integracje. Działam szybko i konkretnie.",
        availability: "48h",
        minBudget: 300,
        tags: ["React", "Node", "API", "Automatyzacje"],
        avatar: "https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
        portfolio: ["", "", ""],
        listing: {
          title: "Programista React/Node — szybkie MVP",
          contactMain: "Discord",
          short: "Buduję MVP, dashboardy i integracje. Szybkie iteracje i konkretne wdrożenia.",
          long: "Zakres → prototyp → wdrożenie. Integracje API, panele, automatyzacje, deployment.\n\nUstalamy cele i deadline, pracuję iteracyjnie.",
          published: true
        }
      });
    }

    if (!localStorage.getItem(LS.keySaved)) LS.setSaved([]);
    if (!localStorage.getItem(LS.keySubs)) LS.setSubs({ premium: false, verified: false });
  }

  /* ----------------------------- state ------------------------------ */
  const state = {
    q: "",
    industry: "all",
    premiumOnly: false,
    verifiedOnly: false,
    availableOnly: false,
    savedOnly: false,
    sort: "recommended",
    budgetMin: null,
    budgetMax: null,

    pageSize: 6,
    shown: 0,
    lastRenderToken: 0,

    // modal
    modalOpen: false,
    modalList: [],
    modalIndex: -1,
    lastFocus: null
  };

  /* ------------------------- progress + reveal ------------------------ */
  function initProgress() {
    const bar = $("#scroll-progress");
    if (!bar) return;
    let ticking = false;

    const onScroll = () => {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(() => {
        const doc = document.documentElement;
        const max = doc.scrollHeight - doc.clientHeight;
        const p = max <= 0 ? 0 : (doc.scrollTop / max) * 100;
        bar.style.width = `${p}%`;
        ticking = false;
      });
    };
    window.addEventListener("scroll", onScroll, { passive: true });
    onScroll();
  }

  function initReveal() {
    const els = $$(".reveal");
    if (!els.length) return;
    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((e) => { if (e.isIntersecting) e.target.classList.add("is-visible"); });
      },
      { threshold: 0.12 }
    );
    els.forEach((el) => io.observe(el));
  }

  /* ------------------------------ overlay ----------------------------- */
  function lockBody(lock) {
    document.body.style.overflow = lock ? "hidden" : "";
  }

  function setOverlay(open) {
    const ov = $("#overlay");
    if (!ov) return;
    ov.dataset.open = open ? "true" : "false";
    ov.setAttribute("aria-hidden", open ? "false" : "true");
  }

  /* ------------------------------ modal ------------------------------ */
  function setPanelOpen(open) {
    const panel = $("#user-panel");
    if (!panel) return;
    panel.dataset.open = open ? "true" : "false";
    setOverlay(open || state.modalOpen);
    lockBody(open || state.modalOpen);
    if (open) setTimeout(() => panel.querySelector('[data-tab]')?.focus(), 0);
  }

  function setModalOpen(open) {
    const modal = $("#profile-modal");
    if (!modal) return;

    state.modalOpen = open;

    if (open) state.lastFocus = document.activeElement;
    modal.dataset.open = open ? "true" : "false";

    setOverlay(open || ($("#user-panel")?.dataset.open === "true"));
    lockBody(open || $("#user-panel")?.dataset.open === "true");

    if (open) setTimeout(() => $("#modal-close")?.focus(), 0);
    else {
      const el = state.lastFocus;
      if (el && typeof el.focus === "function") el.focus();
    }
  }

  function getHashProfileId() {
    const h = location.hash || "";
    const m = h.match(/profile=([^&]+)/);
    return m ? decodeURIComponent(m[1]) : null;
  }
  function setHashProfileId(id) {
    if (!id) {
      if (location.hash.includes("profile=")) {
        history.replaceState(null, "", location.pathname + location.search + "#katalog");
      }
      return;
    }
    history.replaceState(null, "", location.pathname + location.search + `#profile=${encodeURIComponent(id)}`);
  }

  function openProfileModalById(id, list) {
    const profiles = list || getFilteredProfiles(true);
    const idx = profiles.findIndex(p => p.id === id);
    if (idx === -1) {
      Toast.push("Nie znaleziono profilu.", "alert-triangle");
      return;
    }
    state.modalList = profiles;
    state.modalIndex = idx;
    renderModal();
    setModalOpen(true);
    setHashProfileId(id);
  }

  function closeProfileModal() {
    setModalOpen(false);
    setHashProfileId(null);
  }

  function moveModal(delta) {
    if (!state.modalOpen) return;
    const len = state.modalList.length;
    if (!len) return;
    state.modalIndex = (state.modalIndex + delta + len) % len;
    renderModal();
    setHashProfileId(state.modalList[state.modalIndex].id);
  }

  function modalTrapFocus(e) {
    if (!state.modalOpen) return;
    if (e.key !== "Tab") return;

    const modal = $("#profile-modal");
    if (!modal) return;

    const focusables = $$(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',
      modal
    ).filter(el => !el.disabled && el.offsetParent !== null);

    if (!focusables.length) return;

    const first = focusables[0];
    const last = focusables[focusables.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault();
      last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault();
      first.focus();
    }
  }

  /* --------------------------- drawer/panel --------------------------- */
  function switchTab(tab) {
    const ids = ["edit", "preview", "listing", "shop"];
    ids.forEach((id) => {
      const sec = $(`#tab-${id}`);
      if (sec) sec.classList.toggle("hidden", id !== tab);
    });
  }

  function focusSearch() {
    const input = $("#search-input");
    if (!input) return;
    input.scrollIntoView({ behavior: "smooth", block: "center" });
    setTimeout(() => input.focus(), 120);
  }

  function bindPanel() {
    $("#btn-open-panel")?.addEventListener("click", () => setPanelOpen(true));
    $("#btn-open-panel-inline")?.addEventListener("click", () => setPanelOpen(true));
    $("#btn-close-panel")?.addEventListener("click", () => setPanelOpen(false));

    $("#btn-open-panel-m")?.addEventListener("click", () => setPanelOpen(true));
    $("#m-account")?.addEventListener("click", () => setPanelOpen(true));

    $("#btn-open-saved-m")?.addEventListener("click", () => $("#btn-open-saved")?.click());
    $("#m-saved")?.addEventListener("click", () => $("#btn-open-saved")?.click());

    $("#btn-jump-search")?.addEventListener("click", focusSearch);
    $("#m-search")?.addEventListener("click", focusSearch);

    $("#overlay")?.addEventListener("click", () => {
      if (state.modalOpen) closeProfileModal();
      else setPanelOpen(false);
    });

    window.addEventListener("keydown", (e) => {
      // "/" = search (jak w nowoczesnych appkach)
      if (e.key === "/" && !e.ctrlKey && !e.metaKey && !e.altKey) {
        const tag = (document.activeElement?.tagName || "").toLowerCase();
        const typing = tag === "input" || tag === "textarea" || tag === "select";
        if (!typing) {
          e.preventDefault();
          focusSearch();
        }
      }

      if (e.key === "Escape") {
        if (state.modalOpen) closeProfileModal();
        else if ($("#user-panel")?.dataset.open === "true") setPanelOpen(false);
      }

      if (state.modalOpen && (e.key === "ArrowLeft" || e.key === "ArrowRight")) {
        moveModal(e.key === "ArrowLeft" ? -1 : 1);
      }
    });

    document.addEventListener("keydown", modalTrapFocus);

    $$("[data-tab]").forEach((btn) => {
      btn.addEventListener("click", () => switchTab(btn.dataset.tab));
    });

    $("#btn-open-me-modal")?.addEventListener("click", () => {
      setPanelOpen(false);
      openProfileModalById("me");
    });
  }

  /* ------------------------------ filters ----------------------------- */
  function bindFilters() {
    $("#industry-select")?.addEventListener("change", (e) => {
      state.industry = e.target.value;
      resetPagination();
      render();
    });

    $("#sort-select")?.addEventListener("change", (e) => {
      state.sort = e.target.value;
      resetPagination();
      render();
    });

    const onSearch = debounce(() => {
      state.q = ($("#search-input")?.value || "").trim();
      resetPagination();
      render();
    }, 220);

    $("#search-input")?.addEventListener("input", onSearch);

    const toggleChip = (id, key) => {
      const el = $(id);
      if (!el) return;
      el.addEventListener("click", () => {
        state[key] = !state[key];
        el.dataset.active = state[key] ? "true" : "false";
        el.setAttribute("aria-pressed", state[key] ? "true" : "false");
        resetPagination();
        render();
      });
    };

    toggleChip("#filter-saved", "savedOnly");
    toggleChip("#filter-premium", "premiumOnly");
    toggleChip("#filter-verified", "verifiedOnly");
    toggleChip("#filter-available", "availableOnly");

    // header shortcut: toggles saved filter + sync chip
    const toggleSaved = () => {
      state.savedOnly = !state.savedOnly;
      const el = $("#filter-saved");
      if (el) {
        el.dataset.active = state.savedOnly ? "true" : "false";
        el.setAttribute("aria-pressed", state.savedOnly ? "true" : "false");
      }
      resetPagination();
      render();
      Toast.push(state.savedOnly ? "Filtr: zapisane" : "Wyłączono filtr: zapisane", "bookmark");
    };
    $("#btn-open-saved")?.addEventListener("click", toggleSaved);

    // budget
    const onBudget = debounce(() => {
      const minRaw = $("#budget-min")?.value ?? "";
      const maxRaw = $("#budget-max")?.value ?? "";

      const minV = Number(minRaw);
      const maxV = Number(maxRaw);

      state.budgetMin = (minRaw !== "" && Number.isFinite(minV)) ? Math.max(0, minV) : null;
      state.budgetMax = (maxRaw !== "" && Number.isFinite(maxV)) ? Math.max(0, maxV) : null;

      // if both set and invalid order, swap
      if (state.budgetMin != null && state.budgetMax != null && state.budgetMin > state.budgetMax) {
        const t = state.budgetMin;
        state.budgetMin = state.budgetMax;
        state.budgetMax = t;
        $("#budget-min") && ($("#budget-min").value = String(state.budgetMin));
        $("#budget-max") && ($("#budget-max").value = String(state.budgetMax));
      }

      resetPagination();
      render();
    }, 220);

    $("#budget-min")?.addEventListener("input", onBudget);
    $("#budget-max")?.addEventListener("input", onBudget);

    $$("[data-budget-preset]").forEach(btn => {
      btn.addEventListener("click", () => {
        const v = Number(btn.dataset.budgetPreset || 0);
        const max = $("#budget-max");
        const min = $("#budget-min");
        if (v <= 0) {
          if (min) min.value = "";
          if (max) max.value = "";
        } else {
          if (min) min.value = "";
          if (max) max.value = String(v);
        }
        onBudget();
      });
    });

    $("#btn-reset-filters")?.addEventListener("click", () => {
      state.q = "";
      state.industry = "all";
      state.premiumOnly = false;
      state.verifiedOnly = false;
      state.availableOnly = false;
      state.savedOnly = false;
      state.sort = "recommended";
      state.budgetMin = null;
      state.budgetMax = null;

      const industry = $("#industry-select");
      const sort = $("#sort-select");
      const q = $("#search-input");
      if (industry) industry.value = "all";
      if (sort) sort.value = "recommended";
      if (q) q.value = "";

      $("#budget-min") && ($("#budget-min").value = "");
      $("#budget-max") && ($("#budget-max").value = "");

      ["#filter-saved","#filter-premium", "#filter-verified", "#filter-available"].forEach((id) => {
        const el = $(id);
        if (!el) return;
        el.dataset.active = "false";
        el.setAttribute("aria-pressed", "false");
      });

      resetPagination();
      render();
      Toast.push("Wyczyszczono filtry.", "rotate-ccw");
    });

    $("#btn-load-more")?.addEventListener("click", () => {
      state.shown += state.pageSize;
      renderList();
    });
  }

  function resetPagination() {
    state.shown = 0;
  }

  /* --------------------------- list logic ----------------------------- */
  function parseAvailableHours(str) {
    const s = String(str || "").toLowerCase();
    if (s.includes("tydz")) return 168;
    const m = s.match(/(\d+)\s*h/);
    return m ? Number(m[1]) : 9999;
  }

  function normalizeText(s) {
    return String(s || "")
      .toLowerCase()
      .normalize("NFD")
      .replace(/\p{Diacritic}/gu, "");
  }

  function scoreRecommended(p) {
    const premium = p.premium ? 1 : 0;
    const verified = p.verified ? 1 : 0;
    const rating = Number(p.rating || 0);
    const recency = typeof p.createdAt === "number" ? p.createdAt : 0;
    return premium * 4 + verified * 2.2 + rating * 1.2 + recency / 1e12;
  }

  function getFilteredProfiles(ignorePagination = false) {
    const profiles = LS.getProfiles() || [];
    const savedSet = LS.getSaved();
    let out = profiles.slice();

    if (state.savedOnly) out = out.filter(p => savedSet.has(p.id));
    if (state.industry !== "all") out = out.filter((p) => p.industry === state.industry);
    if (state.premiumOnly) out = out.filter((p) => !!p.premium);
    if (state.verifiedOnly) out = out.filter((p) => !!p.verified);
    if (state.availableOnly) out = out.filter((p) => parseAvailableHours(p.availableIn) <= 72);

    // budget
    if (state.budgetMin != null) out = out.filter(p => Number(p.minBudget || 0) >= state.budgetMin);
    if (state.budgetMax != null) out = out.filter(p => Number(p.minBudget || 0) <= state.budgetMax);

    // search
    if (state.q) {
      const nq = normalizeText(state.q);
      out = out.filter(p => {
        const blob = [
          p.name, p.tagline, (p.tags || []).join(" "),
          p.industryLabel, p.about, (p.listing?.title || ""), (p.listing?.short || ""), (p.listing?.long || "")
        ].join(" ");
        return normalizeText(blob).includes(nq);
      });
    }

    // sorting
    if (state.sort === "newest") out.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
    else if (state.sort === "rating") out.sort((a, b) => (b.rating || 0) - (a.rating || 0));
    else if (state.sort === "verified") out.sort((a, b) => Number(!!b.verified) - Number(!!a.verified));
    else out.sort((a, b) => scoreRecommended(b) - scoreRecommended(a));

    if (ignorePagination) return out;

    if (state.shown <= 0) state.shown = state.pageSize;
    return out.slice(0, state.shown);
  }

  function badgesHTML(p) {
    const verified = p.verified
      ? `<span class="badge badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>`
      : "";
    const premium = p.premium
      ? `<span class="badge badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>`
      : "";
    return `${verified}${premium}`;
  }

  function profileCardHTML(p, savedSet) {
    const isSaved = savedSet.has(p.id);
    const saveLabel = isSaved ? "Zapisano" : "Zapisz";
    const saveIcon = isSaved ? "bookmark-check" : "bookmark";

    const chips = [
      `<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${(p.rating ?? 0).toFixed(1)}</span>`,
      `<span class="chip"><i data-lucide="clock" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: ${escapeHTML(p.availableIn || "-")}</span>`,
      `<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.location || "Online")}</span>`,
      `<span class="chip"><i data-lucide="wallet" class="h-3.5 w-3.5 text-[var(--accent)]"></i> od ${escapeHTML(p.minBudget ?? "-")} PLN</span>`
    ].join("");

    const port = (p.portfolio || []).slice(0, 3);
    const thumbs = [0,1,2].map(i => {
      const src = port[i] || "";
      return `<div class="thumb aspect-[4/3]">${src ? `<img src="${escapeHTML(src)}" alt="Portfolio" loading="lazy" />` : ""}</div>`;
    }).join("");

    const short = (p.listing?.short || p.tagline || "").trim();

    return `
      <article class="profile-card reveal p-4 md:p-5" data-profile-id="${escapeHTML(p.id)}">
        <div class="flex flex-col md:flex-row md:items-center gap-4 relative z-[1]">
          <button class="text-left flex items-center gap-3 min-w-[260px] group" type="button" data-open="${escapeHTML(p.id)}" aria-label="Otwórz profil ${escapeHTML(p.name)}">
            <div class="avatar">
              <img src="${escapeHTML(p.avatar || "")}" alt="Avatar" loading="lazy" />
            </div>
            <div class="leading-tight min-w-0">
              <div class="flex items-center gap-2 flex-wrap">
                <div class="text-lg font-black tracking-tight group-hover:text-white">${escapeHTML(p.name || "Anon")}</div>
                ${badgesHTML(p)}
              </div>
              <div class="text-sm text-white/70 font-semibold">${escapeHTML(p.industryLabel || "")}</div>
              <div class="text-xs text-white/55 line-clamp-2">${escapeHTML(short)}</div>
            </div>
          </button>

          <div class="flex-1">
            <div class="flex flex-wrap items-center gap-2">
              ${chips}
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2">
              ${thumbs}
            </div>
          </div>

          <div class="flex md:flex-col gap-2 md:items-end">
            <button class="btn btn-ghost px-4 py-3 w-full md:w-auto btn-save" type="button" data-save="${escapeHTML(p.id)}">
              <i data-lucide="${saveIcon}" class="h-4 w-4"></i>
              <span>${saveLabel}</span>
            </button>
            <button class="btn btn-outline px-4 py-3 w-full md:w-auto" type="button" data-open="${escapeHTML(p.id)}">
              <i data-lucide="external-link" class="h-4 w-4"></i>
              <span>Profil</span>
            </button>
          </div>
        </div>
      </article>
    `;
  }

  function skeletonHTML(count = 3) {
    return Array.from({ length: count }).map(() => `
      <div class="skel p-5">
        <div class="flex items-center gap-3">
          <div class="rounded-2xl bg-white/10 w-14 h-14"></div>
          <div class="flex-1">
            <div class="h-4 bg-white/10 rounded-full w-40"></div>
            <div class="mt-2 h-3 bg-white/10 rounded-full w-56"></div>
            <div class="mt-2 h-3 bg-white/10 rounded-full w-32"></div>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-3 gap-2">
          <div class="rounded-2xl bg-white/10 aspect-[4/3]"></div>
          <div class="rounded-2xl bg-white/10 aspect-[4/3]"></div>
          <div class="rounded-2xl bg-white/10 aspect-[4/3]"></div>
        </div>
      </div>
    `).join("");
  }

  function renderActiveFiltersPills() {
    const wrap = $("#active-filters");
    if (!wrap) return;

    const pills = [];
    const actions = [];

    const add = (label, onClear) => {
      pills.push(`
        <span class="pill">
          ${escapeHTML(label)}
          <button type="button" aria-label="Usuń filtr">×</button>
        </span>
      `);
      actions.push(onClear);
    };

    if (state.q) add(`Szukaj: ${state.q}`, () => { state.q=""; $("#search-input").value=""; });
    if (state.industry !== "all") add(`Branża: ${state.industry}`, () => { state.industry="all"; $("#industry-select").value="all"; });
    if (state.premiumOnly) add("Premium", () => { state.premiumOnly=false; const el=$("#filter-premium"); el.dataset.active="false"; el.setAttribute("aria-pressed","false"); });
    if (state.verifiedOnly) add("Verified", () => { state.verifiedOnly=false; const el=$("#filter-verified"); el.dataset.active="false"; el.setAttribute("aria-pressed","false"); });
    if (state.availableOnly) add("≤72h", () => { state.availableOnly=false; const el=$("#filter-available"); el.dataset.active="false"; el.setAttribute("aria-pressed","false"); });
    if (state.savedOnly) add("Zapisane", () => { state.savedOnly=false; const el=$("#filter-saved"); el.dataset.active="false"; el.setAttribute("aria-pressed","false"); });
    if (state.budgetMin != null || state.budgetMax != null) {
      add(`Budżet: ${state.budgetMin ?? 0}–${state.budgetMax ?? "∞"} PLN`, () => {
        state.budgetMin=null; state.budgetMax=null;
        $("#budget-min").value=""; $("#budget-max").value="";
      });
    }

    if (!pills.length) {
      wrap.classList.add("hidden");
      wrap.innerHTML = "";
      return;
    }

    wrap.classList.remove("hidden");
    wrap.innerHTML = pills.join("");

    const nodes = $$(".pill", wrap);
    nodes.forEach((node, i) => {
      const btn = node.querySelector("button");
      const act = actions[i];
      if (btn && act) {
        btn.addEventListener("click", () => {
          act();
          resetPagination();
          render();
        });
      }
    });
  }

  function renderList() {
    const listEl = $("#profiles-list");
    if (!listEl) return;

    const token = ++state.lastRenderToken;
    listEl.innerHTML = skeletonHTML(3);

    setTimeout(() => {
      if (token !== state.lastRenderToken) return;

      const saved = LS.getSaved();
      const full = getFilteredProfiles(true);
      const shownList = getFilteredProfiles(false);
      const total = full.length;

      $("#total-count") && ($("#total-count").textContent = String(total));
      $("#shown-count") && ($("#shown-count").textContent = String(shownList.length));

      const filtersCount =
        Number(!!state.q) +
        Number(state.industry !== "all") +
        Number(state.premiumOnly) +
        Number(state.verifiedOnly) +
        Number(state.availableOnly) +
        Number(state.savedOnly) +
        Number(state.budgetMin != null || state.budgetMax != null);

      $("#stat-results") && ($("#stat-results").textContent = String(total));
      $("#stat-saved") && ($("#stat-saved").textContent = String(saved.size));
      $("#stat-filters") && ($("#stat-filters").textContent = String(filtersCount));

      $("#saved-pill") && ($("#saved-pill").textContent = String(saved.size));
      $("#saved-pill-m") && ($("#saved-pill-m").textContent = String(saved.size));
      $("#m-saved-count") && ($("#m-saved-count").textContent = String(saved.size));

      $("#results-hint") && ($("#results-hint").textContent = state.savedOnly ? "• tryb: zapisane" : "");

      renderActiveFiltersPills();

      if (!shownList.length) {
        listEl.innerHTML = `
          <div class="glass rounded-[26px] p-6 text-white/80">
            <div class="flex items-center gap-2 text-white/90 font-black">
              <i data-lucide="search-x" class="h-5 w-5 text-[var(--accent)]"></i>
              Brak wyników
            </div>
            <p class="mt-2 text-sm text-white/70">Zmień filtry lub wyszukiwane hasło.</p>
            <div class="mt-4 flex flex-wrap gap-2">
              <button class="btn btn-outline px-4 py-2 text-sm" type="button" id="btn-empty-reset">
                <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                Wyczyść filtry
              </button>
              <button class="btn btn-primary px-4 py-2 text-sm" type="button" id="btn-empty-search">
                <i data-lucide="search" class="h-4 w-4"></i>
                Szukaj
              </button>
            </div>
          </div>
        `;
        $("#btn-empty-reset")?.addEventListener("click", () => $("#btn-reset-filters")?.click());
        $("#btn-empty-search")?.addEventListener("click", () => focusSearch());
        try { lucide.createIcons(); } catch {}
        return;
      }

      listEl.innerHTML = shownList.map((p) => profileCardHTML(p, saved)).join("");

      $$(".btn-save", listEl).forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.dataset.save;
          if (!id) return;
          const set = LS.getSaved();
          if (set.has(id)) {
            set.delete(id);
            Toast.push("Usunięto z zapisanych.", "bookmark-minus");
          } else {
            set.add(id);
            Toast.push("Dodano do zapisanych.", "bookmark-plus");
          }
          LS.setSaved(set);
          renderList();
        });
      });

      $$("[data-open]", listEl).forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.dataset.open;
          if (!id) return;
          openProfileModalById(id, full);
        });
      });

      const loadMore = $("#btn-load-more");
      if (loadMore) loadMore.style.display = (state.shown < total) ? "inline-flex" : "none";

      initReveal();
      try { lucide.createIcons(); } catch {}
    }, 110);
  }

  /* ------------------------------ modal render ------------------------ */
  function renderModal() {
    const p = state.modalList[state.modalIndex];
    if (!p) return;

    $("#modal-avatar") && ($("#modal-avatar").src = p.avatar || "");
    $("#modal-name") && ($("#modal-name").textContent = p.name || "Profil");
    $("#modal-sub") && ($("#modal-sub").textContent = `${p.industryLabel || ""} • ${p.tagline || ""}`);

    const badges = [];
    if (p.verified) badges.push(`<span class="badge badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>`);
    if (p.premium) badges.push(`<span class="badge badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>`);
    $("#modal-badges") && ($("#modal-badges").innerHTML = badges.join(""));

    const chips = [
      `<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${(p.rating ?? 0).toFixed(1)}</span>`,
      `<span class="chip"><i data-lucide="clock" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: ${escapeHTML(p.availableIn || "-")}</span>`,
      `<span class="chip"><i data-lucide="wallet" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Budżet: od ${escapeHTML(p.minBudget ?? "-")} PLN</span>`,
      `<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.location || "Online")}</span>`
    ];
    $("#modal-chips") && ($("#modal-chips").innerHTML = chips.join(""));

    const port = (p.portfolio || []).slice(0, 3);
    const thumbs = [0,1,2].map(i => {
      const src = port[i] || "";
      return `
        <div class="thumb aspect-[4/3]">
          ${src ? `<img src="${escapeHTML(src)}" alt="Portfolio" loading="lazy" />` : ""}
        </div>`;
    }).join("");
    $("#modal-portfolio") && ($("#modal-portfolio").innerHTML = thumbs);

    const about = (p.about || p.listing?.long || p.listing?.short || p.tagline || "Brak opisu.").trim();
    $("#modal-about") && ($("#modal-about").textContent = about);

    $("#btn-copy-name")?.addEventListener("click", () => {
      navigator.clipboard?.writeText(p.name || "").then(
        () => Toast.push("Skopiowano nick.", "copy"),
        () => Toast.push("Nie udało się skopiować.", "alert-triangle")
      );
    });

    const saveBtn = $("#btn-save-from-modal");
    if (saveBtn) {
      const set = LS.getSaved();
      const isSaved = set.has(p.id);
      saveBtn.innerHTML = `<i data-lucide="${isSaved ? "bookmark-check" : "bookmark"}" class="h-4 w-4"></i><span>${isSaved ? "Zapisano" : "Zapisz"}</span>`;
      saveBtn.onclick = () => {
        const s = LS.getSaved();
        if (s.has(p.id)) { s.delete(p.id); Toast.push("Usunięto z zapisanych.", "bookmark-minus"); }
        else { s.add(p.id); Toast.push("Dodano do zapisanych.", "bookmark-plus"); }
        LS.setSaved(s);
        renderList();
        renderModal();
      };
    }

    try { lucide.createIcons(); } catch {}
  }

  function bindModal() {
    $("#modal-close")?.addEventListener("click", closeProfileModal);
    $("#modal-prev")?.addEventListener("click", () => moveModal(-1));
    $("#modal-next")?.addEventListener("click", () => moveModal(1));
  }

  /* ------------------------------ panel render ------------------------ */
  function renderPanelFromMe() {
    const me = LS.getMe();
    if (!me) return;

    $("#panel-username") && ($("#panel-username").textContent = me.name || "Użytkownik");
    $("#panel-avatar") && ($("#panel-avatar").src = me.avatar || "");

    $("#edit-name") && ($("#edit-name").value = me.name || "");
    $("#edit-industry") && ($("#edit-industry").value = me.industry || "dev");
    $("#edit-about") && ($("#edit-about").value = me.about || "");
    $("#edit-availability") && ($("#edit-availability").value = me.availability || "48h");
    $("#edit-budget") && ($("#edit-budget").value = String(me.minBudget ?? 0));
    $("#edit-tags") && ($("#edit-tags").value = (me.tags || []).join(", "));
    $("#edit-avatar-url") && ($("#edit-avatar-url").value = "");

    $("#edit-portfolio-1") && ($("#edit-portfolio-1").value = me.portfolio?.[0] || "");
    $("#edit-portfolio-2") && ($("#edit-portfolio-2").value = me.portfolio?.[1] || "");
    $("#edit-portfolio-3") && ($("#edit-portfolio-3").value = me.portfolio?.[2] || "");

    $("#listing-title") && ($("#listing-title").value = me.listing?.title || "");
    $("#listing-contact-main") && ($("#listing-contact-main").value = me.listing?.contactMain || "Discord");
    $("#listing-short") && ($("#listing-short").value = me.listing?.short || "");
    $("#listing-long") && ($("#listing-long").value = me.listing?.long || "");

    const subs = LS.getSubs();
    $("#plan-status") && ($("#plan-status").textContent = subs.premium ? "Premium" : (subs.verified ? "Verified" : "Standard"));

    const buyP = $("#buy-premium");
    const cancelP = $("#cancel-premium");
    const buyV = $("#buy-verify");
    const cancelV = $("#cancel-verify");

    if (buyP) buyP.disabled = !!subs.premium;
    if (cancelP) cancelP.disabled = !subs.premium;
    if (buyV) buyV.disabled = !!subs.verified;
    if (cancelV) cancelV.disabled = !subs.verified;

    [buyP, cancelP, buyV, cancelV].forEach((b) => {
      if (!b) return;
      b.classList.toggle("opacity-60", b.disabled);
      b.classList.toggle("pointer-events-none", b.disabled);
    });

    renderPreviewCard();
  }

  function upsertMeIntoProfiles() {
    const me = LS.getMe();
    if (!me) return;

    const subs = LS.getSubs();

    const industryLabelMap = {
      dev: "Programista",
      gfx: "Grafik",
      video: "Montażysta / Content",
      tech: "Technik / DevOps",
      mc: "Budowniczy Minecraft"
    };

    const published = me.listing?.published !== false;

    const p = {
      id: "me",
      name: me.name || "Ja",
      industry: me.industry || "dev",
      industryLabel: industryLabelMap[me.industry] || "Freelancer",
      tagline: (me.tags || []).slice(0, 6).join(" • "),
      about: (me.about || me.listing?.long || "").trim(),
      rating: 5.0,
      availableIn: me.availability || "48h",
      minBudget: Number(me.minBudget || 0),
      location: "Online",
      premium: !!subs.premium,
      verified: !!subs.verified,
      avatar: me.avatar || "",
      portfolio: (me.portfolio || ["", "", ""]).slice(0, 3),
      createdAt: now(),
      listing: me.listing ? { ...me.listing } : undefined
    };

    const profiles = LS.getProfiles() || [];
    const idx = profiles.findIndex((x) => x.id === "me");

    if (!published) {
      if (idx !== -1) {
        profiles.splice(idx, 1);
        LS.setProfiles(profiles);
      }
      return;
    }

    if (idx === -1) profiles.unshift(p);
    else profiles[idx] = { ...profiles[idx], ...p };

    LS.setProfiles(profiles);
  }

  function renderPreviewCard() {
    const me = LS.getMe();
    if (!me) return;

    const subs = LS.getSubs();
    const mock = {
      id: "me",
      name: me.name || "Użytkownik",
      industryLabel: ({
        dev: "Programista",
        gfx: "Grafik",
        video: "Montażysta / Content",
        tech: "Technik / DevOps",
        mc: "Budowniczy Minecraft"
      })[me.industry] || "Freelancer",
      tagline: (me.tags || []).slice(0, 6).join(" • "),
      rating: 5.0,
      availableIn: me.availability || "48h",
      minBudget: me.minBudget || 0,
      location: "Online",
      premium: !!subs.premium,
      verified: !!subs.verified,
      avatar: me.avatar || "",
      portfolio: (me.portfolio || ["","",""]).slice(0,3),
      listing: { short: me.listing?.short || "" }
    };

    const saved = LS.getSaved();
    const html = profileCardHTML(mock, saved);
    const wrap = $("#preview-card");
    if (wrap) {
      wrap.innerHTML = html;

      $$("[data-open]", wrap).forEach(btn => btn.addEventListener("click", () => openProfileModalById("me")));
      $$(".btn-save", wrap).forEach(btn => btn.addEventListener("click", () => {
        const set = LS.getSaved();
        if (set.has("me")) set.delete("me");
        else set.add("me");
        LS.setSaved(set);
        Toast.push("Zaktualizowano zapisane.", "bookmark");
        renderPreviewCard();
        renderList();
      }));

      try { lucide.createIcons(); } catch {}
    }
  }

  function bindProfileSave() {
    $("#btn-save-profile")?.addEventListener("click", () => {
      const me = LS.getMe() || {};

      const name = ($("#edit-name")?.value || "").trim();
      if (name.length < 2) {
        Toast.push("Nick jest za krótki (min. 2 znaki).", "alert-triangle");
        $("#edit-name")?.focus();
        return;
      }

      const industry = $("#edit-industry")?.value || me.industry || "dev";
      const about = $("#edit-about")?.value || "";
      const availability = $("#edit-availability")?.value || "48h";
      const minBudget = clamp(Number($("#edit-budget")?.value || 0), 0, 10_000_000);

      const tagsRaw = $("#edit-tags")?.value || "";
      const tags = tagsRaw.split(",").map(s => s.trim()).filter(Boolean).slice(0, 12);

      const avatarURLInput = ($("#edit-avatar-url")?.value || "").trim();
      const avatar = avatarURLInput || me.avatar || "";

      const p1 = ($("#edit-portfolio-1")?.value || "").trim();
      const p2 = ($("#edit-portfolio-2")?.value || "").trim();
      const p3 = ($("#edit-portfolio-3")?.value || "").trim();

      const next = {
        ...me,
        name,
        industry,
        about,
        availability,
        minBudget,
        tags,
        avatar,
        portfolio: [p1, p2, p3],
        listing: me.listing || { title: "", contactMain: "Discord", short: "", long: "", published: true }
      };

      LS.setMe(next);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      setSaveStatus("Wszystko zapisane");
      Toast.push("Zapisano profil.", "save");
    });

    $("#btn-reset-profile")?.addEventListener("click", () => {
      localStorage.removeItem(LS.keyMe);
      ensureInit();
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      setSaveStatus("Wszystko zapisane");
      Toast.push("Przywrócono domyślne dane.", "rotate-ccw");
    });
  }

  function bindListing() {
    $("#btn-publish")?.addEventListener("click", () => {
      const me = LS.getMe();
      if (!me) return;

      const title = ($("#listing-title")?.value || "").trim();
      const short = ($("#listing-short")?.value || "").trim();
      const long = ($("#listing-long")?.value || "").trim();
      const contactMain = $("#listing-contact-main")?.value || "Discord";

      if (title.length < 6) { Toast.push("Uzupełnij tytuł (min. 6 znaków).", "alert-triangle"); $("#listing-title")?.focus(); return; }
      if (short.length < 12) { Toast.push("Uzupełnij krótki opis (min. 12 znaków).", "alert-triangle"); $("#listing-short")?.focus(); return; }

      me.listing = { ...(me.listing || {}), title, contactMain, short, long, published: true };
      LS.setMe(me);

      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      Toast.push("Ogłoszenie opublikowane / zaktualizowane.", "rocket");
    });

    $("#btn-unpublish")?.addEventListener("click", () => {
      const me = LS.getMe();
      if (!me) return;

      me.listing = { ...(me.listing || {}), published: false };
      LS.setMe(me);

      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      Toast.push("Ogłoszenie ukryte w katalogu.", "eye-off");
    });
  }

  function bindShop() {
    $("#buy-premium")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.premium = true;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      Toast.push("Premium aktywne.", "zap");
    });

    $("#cancel-premium")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.premium = false;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      Toast.push("Premium wyłączone.", "x-circle");
    });

    $("#buy-verify")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.verified = true;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      Toast.push("Verified aktywne.", "badge-check");
    });

    $("#cancel-verify")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.verified = false;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      Toast.push("Verified wyłączone.", "x-circle");
    });
  }

  /* ------------------------------- render ------------------------------ */
  function render() {
    renderPanelFromMe();
    upsertMeIntoProfiles();
    renderList();
    renderActiveFiltersPills();
    $("#footer-year") && ($("#footer-year").textContent = String(new Date().getFullYear()));
  }

  /* ------------------------------- boot ------------------------------- */
  document.addEventListener("DOMContentLoaded", () => {
    ensureInit();

    initProgress();
    bindPanel();
    bindFilters();
    bindProfileSave();
    bindListing();
    bindShop();
    bindModal();

    // default tab: shop
    switchTab("shop");

    // initial chip states
    ["#filter-saved","#filter-premium", "#filter-verified", "#filter-available"].forEach(id => {
      const el = $(id);
      if (el) el.dataset.active = "false";
    });

    // Autosave for profile fields
    const autosave = debounce(() => {
      $("#btn-save-profile")?.click();
    }, 700);

    ["#edit-name","#edit-about","#edit-tags","#edit-avatar-url","#edit-budget","#edit-portfolio-1","#edit-portfolio-2","#edit-portfolio-3"].forEach(sel=>{
      $(sel)?.addEventListener("input", () => { setSaveStatus("Zmieniono — zapisuję…"); autosave(); });
    });
    ["#edit-industry","#edit-availability"].forEach(sel=>{
      $(sel)?.addEventListener("change", () => { setSaveStatus("Zmieniono — zapisuję…"); autosave(); });
    });

    // jump search button
    $("#btn-jump-search")?.addEventListener("click", () => $("#search-input")?.focus());

    render();

    initReveal();
    try { lucide.createIcons(); } catch {}

    // open modal if hash provided
    const pid = getHashProfileId();
    if (pid) setTimeout(() => openProfileModalById(pid), 150);
  });
})();
</script>

</body>
</html>
