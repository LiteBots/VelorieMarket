<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Velorie Market — Premium Freelance Catalog</title>
  <meta name="description" content="Velorie Market — ekskluzywny katalog freelancerów. Znajdź ekspertów, buduj zespół." />
  <meta name="theme-color" content="#030712" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;700;900&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      /* Palette refinement - Deep Space Theme */
      --primary: #f43f5e;   /* Rose 500 */
      --primary-glow: rgba(244, 63, 94, 0.4);
      --secondary: #8b5cf6; /* Violet 500 */
      --secondary-glow: rgba(139, 92, 246, 0.4);
      
      --bg-dark: #030712;   /* Gray 950 */
      
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.12);
      --glass-surface: rgba(255, 255, 255, 0.03);

      --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
      --ease-smooth: cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* --- Base Typography --- */
    body {
      background-color: var(--bg-dark);
      font-family: 'Inter', sans-serif;
      color: #f3f4f6;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }
    
    h1, h2, h3, h4, h5, .font-display {
      font-family: 'Outfit', sans-serif;
    }

    /* --- Aurora Background & Noise --- */
    .bg-noise {
      position: fixed;
      inset: 0;
      z-index: -1;
      opacity: 0.035;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      pointer-events: none;
    }

    .aurora-blob {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      z-index: -2;
      opacity: 0.5;
      animation: float-aurora 10s infinite alternate ease-in-out;
    }
    .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--primary-glow); animation-delay: 0s; }
    .blob-2 { bottom: -10%; right: -10%; width: 40vw; height: 40vw; background: var(--secondary-glow); animation-delay: -5s; }
    .blob-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: rgba(56, 189, 248, 0.2); animation-duration: 15s; }

    @keyframes float-aurora {
      0% { transform: translate(0, 0) scale(1); }
      100% { transform: translate(30px, -30px) scale(1.1); }
    }

    /* --- Advanced Glass Components --- */
    .glass-panel {
      background: var(--glass-surface);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-top-color: var(--glass-highlight);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.4s var(--ease-smooth);
    }

    .glass-card {
      position: relative;
      background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transition: transform 0.4s var(--ease-smooth), box-shadow 0.4s var(--ease-smooth), border-color 0.4s;
      overflow: hidden;
    }
    
    .glass-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 20px rgba(244, 63, 94, 0.1);
      border-color: rgba(255,255,255,0.2);
    }

    /* Special Styling for Premium */
    .glass-card.premium-border {
      border: 1px solid transparent;
      background-clip: padding-box, border-box;
      background-origin: padding-box, border-box;
      background-image: 
        linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,0,0,0.2)),
        linear-gradient(135deg, rgba(244,63,94,0.5), rgba(139,92,246,0.5));
    }

    /* --- UI Elements --- */
    .btn-new {
      position: relative;
      overflow: hidden;
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      letter-spacing: 0.02em;
      transition: all 0.3s var(--ease-elastic);
    }
    .btn-new:active { transform: scale(0.96); }

    .btn-accent {
      background: linear-gradient(90deg, #f43f5e, #e11d48);
      color: white;
      box-shadow: 0 10px 25px -5px rgba(244, 63, 94, 0.4);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn-accent:hover {
      filter: brightness(1.1);
      box-shadow: 0 15px 35px -5px rgba(244, 63, 94, 0.5);
    }

    .btn-glass {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border);
      color: rgba(255,255,255,0.9);
    }
    .btn-glass:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.25);
    }

    /* Inputs */
    .input-modern {
      background: rgba(0,0,0,0.2);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: white;
      transition: all 0.3s;
      font-size: 0.95rem;
    }
    .input-modern:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(244, 63, 94, 0.15);
      background: rgba(0,0,0,0.3);
      outline: none;
    }

    /* Chips/Tags */
    .tag-modern {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.35rem 0.75rem;
      border-radius: 99px;
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    .tag-modern[data-active="true"] {
      background: rgba(244, 63, 94, 0.15);
      border-color: rgba(244, 63, 94, 0.4);
      color: #fda4af;
      box-shadow: 0 0 15px rgba(244, 63, 94, 0.15);
    }
    .tag-modern:not([data-active="true"]) {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.6);
    }
    .tag-modern:hover:not([data-active="true"]) {
      background: rgba(255,255,255,0.08);
      color: white;
    }

    /* --- Particles (Zachowane) --- */
    .particle {
      position: absolute;
      border-radius: 50%;
      background: white;
      pointer-events: none;
      filter: blur(1px);
      animation: particle-animation linear infinite;
    }
    @keyframes particle-animation {
      0%, 100% { transform: translateY(0%) translateX(0%) rotate(0deg); opacity: 0.2; }
      50% { transform: translateY(-10%) translateX(5%) rotate(20deg); opacity: 0.5; }
    }

    /* --- Scroll Progress --- */
    #scroll-progress {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      height: 3px;
      box-shadow: 0 2px 10px var(--primary-glow);
      position: fixed; top: 0; left: 0; z-index: 100;
    }

    /* Modal Animation */
    @keyframes modal-pop {
      from { opacity: 0; transform: scale(0.95) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .modal-card-new {
      animation: modal-pop 0.4s var(--ease-elastic) forwards;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            border: "rgba(255,255,255,0.1)",
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            display: ['Outfit', 'sans-serif'],
          }
        }
      }
    };
  </script>
</head>

<body class="min-h-screen text-slate-200 selection:bg-rose-500/30 selection:text-white relative">

  <div class="bg-noise"></div>
  <div class="aurora-blob blob-1"></div>
  <div class="aurora-blob blob-2"></div>
  <div class="aurora-blob blob-3"></div>
  <div id="particles-container" aria-hidden="true" class="pointer-events-none fixed inset-0 overflow-hidden -z-10 opacity-30"></div>

  <div id="scroll-progress" class="w-0 transition-all duration-100 ease-out" aria-hidden="true"></div>

  <header id="app-header" class="fixed top-0 inset-x-0 z-50 transition-all duration-300 border-b border-transparent">
    <div class="absolute inset-0 bg-[#030712]/70 backdrop-blur-xl pointer-events-none"></div>
    <div class="relative mx-auto max-w-7xl px-4 md:px-6 h-[72px] flex items-center justify-between">
      
      <a href="#katalog" class="flex items-center gap-3 group relative z-10">
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-rose-500 to-violet-600 flex items-center justify-center shadow-lg shadow-rose-500/20 group-hover:scale-105 transition-transform duration-300">
          <span class="font-display font-black text-white text-xl">V</span>
        </div>
        <div class="flex flex-col">
          <span class="font-display font-bold text-lg leading-none tracking-tight text-white group-hover:text-rose-400 transition-colors">Velorie</span>
          <span class="text-[10px] uppercase tracking-widest text-slate-400 font-semibold">Market v3.0</span>
        </div>
      </a>

      <nav class="hidden md:flex items-center gap-2 bg-white/5 border border-white/10 rounded-full p-1.5 backdrop-blur-md shadow-2xl">
        <button id="btn-jump-search" class="flex items-center gap-2 px-4 py-2 rounded-full hover:bg-white/10 text-xs font-semibold text-slate-300 transition-all group">
          <i data-lucide="search" class="h-4 w-4 text-slate-400 group-hover:text-white transition-colors"></i>
          <span>Szukaj</span>
          <kbd class="hidden lg:inline-flex h-5 items-center gap-1 rounded border border-white/10 bg-white/5 px-1.5 font-mono text-[10px] font-medium text-slate-400">/</kbd>
        </button>
        <div class="w-px h-4 bg-white/10"></div>
        <button id="btn-open-saved" class="flex items-center gap-2 px-4 py-2 rounded-full hover:bg-white/10 text-xs font-semibold text-slate-300 transition-all relative">
          <span>Zapisane</span>
          <span id="saved-pill" class="bg-rose-500/20 text-rose-300 border border-rose-500/30 px-1.5 rounded-md text-[10px]">0</span>
        </button>
        <button id="btn-open-panel" class="btn-new btn-accent px-5 py-2 rounded-full text-xs shadow-glow">
          Konto
        </button>
      </nav>

      <div class="flex md:hidden items-center gap-3 relative z-10">
         <button id="btn-open-saved-m" class="h-10 w-10 flex items-center justify-center rounded-full bg-white/5 border border-white/10 active:scale-95 transition">
            <i data-lucide="bookmark" class="h-5 w-5"></i>
            <span id="saved-pill-m" class="absolute top-0 right-0 h-2 w-2 bg-rose-500 rounded-full hidden"></span>
         </button>
         <button id="btn-open-panel-m" class="h-10 w-10 flex items-center justify-center rounded-full bg-white/5 border border-white/10 active:scale-95 transition">
            <i data-lucide="menu" class="h-5 w-5"></i>
         </button>
      </div>
    </div>
  </header>

  <div id="overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[90] opacity-0 pointer-events-none transition-opacity duration-300" aria-hidden="true"></div>

  <main id="katalog" class="relative pt-28 pb-20 min-h-screen">
    <div class="mx-auto max-w-7xl px-4 md:px-6">

      <section class="reveal mb-12">
        <div class="relative overflow-hidden rounded-3xl glass-panel p-8 md:p-12 border border-white/10">
          <div class="absolute top-0 right-0 -mt-20 -mr-20 w-80 h-80 bg-rose-500/20 blur-[100px] rounded-full pointer-events-none"></div>

          <div class="relative z-10 flex flex-col lg:flex-row lg:items-end justify-between gap-8">
            <div class="max-w-2xl">
              <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-rose-500/10 border border-rose-500/20 text-rose-300 text-xs font-bold uppercase tracking-wider mb-4">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-rose-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-rose-500"></span>
                </span>
                Bezpieczne zlecenia Direct
              </div>
              <h1 class="text-4xl md:text-6xl font-display font-black tracking-tight text-white mb-6 leading-[1.1]">
                Znajdź <span class="text-transparent bg-clip-text bg-gradient-to-r from-rose-400 to-violet-400">Twórców</span><br>do Twojego projektu.
              </h1>
              <p class="text-lg text-slate-400 leading-relaxed max-w-lg">
                Elitarny katalog zweryfikowanych freelancerów. Programiści, graficy, montażyści. Bez pośredników, bez prowizji.
              </p>
            </div>

            <div class="grid grid-cols-3 gap-3 w-full lg:w-auto min-w-[300px]">
               <div class="bg-white/5 border border-white/10 rounded-2xl p-4 text-center hover:bg-white/10 transition duration-300">
                 <div class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">Dostępnych</div>
                 <div class="text-3xl font-display font-black text-white" id="stat-results">0</div>
               </div>
               <div class="bg-white/5 border border-white/10 rounded-2xl p-4 text-center hover:bg-white/10 transition duration-300">
                 <div class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">Zapisane</div>
                 <div class="text-3xl font-display font-black text-rose-400" id="stat-saved">0</div>
               </div>
               <div class="bg-white/5 border border-white/10 rounded-2xl p-4 text-center hover:bg-white/10 transition duration-300">
                 <div class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">Filtry</div>
                 <div class="text-3xl font-display font-black text-violet-400" id="stat-filters">0</div>
               </div>
            </div>
          </div>
        </div>
      </section>

      <div id="filters-sentinel"></div>
      <div id="filters-bar" class="sticky top-[80px] z-40 transition-all duration-300 mb-8">
        <div class="glass-panel rounded-2xl p-4 md:p-5 shadow-2xl shadow-black/50 filters-inner-container">
          
          <div class="flex flex-col gap-5">
            <div class="grid lg:grid-cols-12 gap-4">
              <div class="lg:col-span-5 relative group">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-rose-400 transition-colors h-5 w-5"></i>
                <input id="search-input" class="input-modern w-full pl-12 pr-4 py-3" placeholder="Szukaj (np. React, Logo, Montaż)..." />
              </div>

              <div class="lg:col-span-3">
                <select id="industry-select" class="input-modern w-full py-3 px-4 appearance-none cursor-pointer">
                  <option value="all">Wszystkie branże</option>
                  <option value="dev">Programista</option>
                  <option value="gfx">Grafik</option>
                  <option value="video">Montażysta / Content</option>
                  <option value="tech">Technik / DevOps</option>
                  <option value="mc">Budowniczy Minecraft</option>
                </select>
              </div>

              <div class="lg:col-span-2">
                 <select id="sort-select" class="input-modern w-full py-3 px-4 appearance-none cursor-pointer">
                  <option value="recommended">Polecane</option>
                  <option value="newest">Najnowsze</option>
                  <option value="rating">Najwyższa ocena</option>
                  <option value="verified">Zweryfikowani</option>
                </select>
              </div>

               <div class="lg:col-span-2 flex items-center justify-end">
                  <button id="btn-open-panel-inline" class="btn-new btn-glass w-full h-full rounded-xl flex items-center justify-center gap-2 hover:bg-white/10 text-xs font-bold uppercase tracking-wide">
                    <i data-lucide="sliders-horizontal" class="h-4 w-4"></i>
                    Moje Konto
                  </button>
               </div>
            </div>

            <div class="h-px bg-white/5 w-full"></div>

            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
              <div class="flex flex-wrap gap-2">
                 <button id="filter-saved" class="tag-modern flex items-center gap-2 cursor-pointer" type="button">
                    <i data-lucide="bookmark" class="h-3 w-3"></i> Zapisane
                 </button>
                 <button id="filter-premium" class="tag-modern flex items-center gap-2 cursor-pointer" type="button">
                    <i data-lucide="zap" class="h-3 w-3"></i> Premium Only
                 </button>
                 <button id="filter-verified" class="tag-modern flex items-center gap-2 cursor-pointer" type="button">
                    <i data-lucide="badge-check" class="h-3 w-3"></i> Zweryfikowani
                 </button>
                 <button id="filter-available" class="tag-modern flex items-center gap-2 cursor-pointer" type="button">
                    <i data-lucide="clock" class="h-3 w-3"></i> Dostępny ≤72h
                 </button>
              </div>

              <div class="flex items-center gap-3 w-full lg:w-auto">
                <span class="text-xs text-slate-500 font-bold uppercase">Budżet (PLN)</span>
                <input id="budget-min" type="number" placeholder="Min" class="input-modern w-20 py-1.5 px-3 text-sm text-center" />
                <span class="text-slate-600">-</span>
                <input id="budget-max" type="number" placeholder="Max" class="input-modern w-20 py-1.5 px-3 text-sm text-center" />
                 <button id="btn-reset-filters" class="ml-2 text-xs text-slate-400 hover:text-white underline decoration-slate-600 hover:decoration-white transition-all">
                    Reset
                 </button>
              </div>
            </div>
            
             <div id="active-filters" class="hidden flex-wrap gap-2 pt-2"></div>
          </div>
        </div>
      </div>

      <section>
        <div class="flex items-center justify-between mb-4 px-2">
          <div class="text-sm font-medium text-slate-400">
             <i data-lucide="layers" class="h-4 w-4 inline mr-1 text-rose-500"></i>
             Wyświetlane: <span id="shown-count" class="text-white">0</span> z <span id="total-count" class="text-white">0</span>
             <span id="results-hint" class="ml-2 text-xs text-slate-500"></span>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="profiles-list">
           </div>

        <div class="mt-12 text-center">
           <button id="btn-load-more" class="btn-new btn-glass px-8 py-3 rounded-full text-sm flex items-center gap-2 mx-auto disabled:opacity-50 disabled:cursor-not-allowed">
              <span>Wczytaj więcej</span>
              <i data-lucide="chevron-down" class="h-4 w-4"></i>
           </button>
        </div>
      </section>

      <footer class="mt-20 border-t border-white/5 pt-8 pb-24 text-center">
         <span id="footer-year" class="text-slate-500 text-sm">© 2024</span>
         <span class="text-slate-600 mx-2">•</span>
         <span class="text-slate-500 text-sm">Velorie Market Premium</span>
      </footer>

    </div>
  </main>

  <div id="mobile-bar" class="fixed bottom-4 inset-x-4 z-50 md:hidden pointer-events-none">
    <div class="pointer-events-auto bg-[#111]/90 backdrop-blur-xl border border-white/10 rounded-2xl p-2 flex justify-between shadow-2xl">
      <button id="m-search" class="flex-1 flex flex-col items-center justify-center py-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition">
        <i data-lucide="search" class="h-5 w-5 mb-1"></i>
        <span class="text-[10px] font-medium">Szukaj</span>
      </button>
      <button id="m-saved" class="flex-1 flex flex-col items-center justify-center py-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition relative">
        <i data-lucide="bookmark" class="h-5 w-5 mb-1"></i>
        <span class="text-[10px] font-medium">Zapisane</span>
        <span id="m-saved-count" class="absolute top-1 right-8 h-2 w-2 bg-rose-500 rounded-full opacity-0"></span>
      </button>
      <button id="m-account" class="flex-1 flex flex-col items-center justify-center py-2 rounded-xl text-rose-400 hover:bg-rose-500/10 transition">
        <i data-lucide="user" class="h-5 w-5 mb-1"></i>
        <span class="text-[10px] font-medium">Konto</span>
      </button>
    </div>
  </div>

  <section id="profile-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 sm:p-6" role="dialog" aria-modal="true" data-open="false">
     <div class="modal-card-new w-full max-w-4xl max-h-[90vh] bg-[#0f111a] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex flex-col relative z-[101]">
        
        <div class="shrink-0 h-40 relative bg-gradient-to-r from-slate-900 to-slate-800 overflow-hidden">
           <div class="absolute inset-0 opacity-30 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>
           <div class="absolute inset-0 bg-gradient-to-t from-[#0f111a] to-transparent"></div>
           
           <div class="absolute top-4 right-4 flex gap-2">
              <button id="modal-prev" class="h-10 w-10 flex items-center justify-center rounded-full bg-black/40 hover:bg-white/10 text-white transition border border-white/10"><i data-lucide="chevron-left" class="h-5 w-5"></i></button>
              <button id="modal-next" class="h-10 w-10 flex items-center justify-center rounded-full bg-black/40 hover:bg-white/10 text-white transition border border-white/10"><i data-lucide="chevron-right" class="h-5 w-5"></i></button>
              <button id="modal-close" class="h-10 w-10 flex items-center justify-center rounded-full bg-rose-500/20 hover:bg-rose-500 text-white transition border border-white/10"><i data-lucide="x" class="h-5 w-5"></i></button>
           </div>
        </div>

        <div class="overflow-y-auto flex-1 p-6 sm:p-8 -mt-16 relative">
           <div class="flex flex-col md:flex-row gap-8">
              <div class="md:w-1/3 flex flex-col gap-6">
                 <div class="relative">
                    <div class="h-32 w-32 rounded-3xl border-4 border-[#0f111a] shadow-xl overflow-hidden bg-slate-800">
                       <img id="modal-avatar" src="" class="w-full h-full object-cover" />
                    </div>
                    <div id="modal-badges" class="flex gap-1 absolute -bottom-3 left-1/2 -translate-x-1/2 bg-[#0f111a] p-1 rounded-full"></div>
                 </div>
                 
                 <div class="text-center md:text-left">
                    <h2 id="modal-name" class="text-3xl font-display font-black text-white leading-tight mb-1"></h2>
                    <p id="modal-sub" class="text-sm text-slate-400 font-medium"></p>
                 </div>

                 <div class="flex flex-wrap gap-2 justify-center md:justify-start" id="modal-chips"></div>

                 <div class="p-4 rounded-2xl bg-white/5 border border-white/10 text-center">
                    <div class="text-xs text-slate-500 uppercase font-bold mb-3">Akcja</div>
                    <div class="grid grid-cols-2 gap-2">
                       <button id="btn-copy-name" class="btn-new btn-accent py-2 rounded-xl text-xs flex flex-col items-center justify-center gap-1">
                          <i data-lucide="copy" class="h-4 w-4"></i> Kopiuj Nick
                       </button>
                       <button id="btn-save-from-modal" class="btn-new btn-glass py-2 rounded-xl text-xs flex flex-col items-center justify-center gap-1">
                          <i data-lucide="bookmark" class="h-4 w-4"></i> Zapisz
                       </button>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-3">Kontaktujesz się bezpośrednio.</p>
                 </div>
              </div>

              <div class="md:w-2/3 space-y-8">
                 <div>
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
                       <i data-lucide="image" class="h-4 w-4 text-rose-500"></i> Portfolio
                    </h3>
                    <div class="grid grid-cols-3 gap-3" id="modal-portfolio"></div>
                 </div>

                 <div>
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
                       <i data-lucide="file-text" class="h-4 w-4 text-rose-500"></i> O Mnie / Oferta
                    </h3>
                    <div class="text-slate-300 leading-relaxed whitespace-pre-line text-sm bg-white/5 p-6 rounded-2xl border border-white/5" id="modal-about"></div>
                 </div>
              </div>
           </div>
        </div>
     </div>
  </section>

  <aside id="user-panel" class="fixed inset-y-0 right-0 z-[95] w-full md:max-w-4xl bg-[#030712] border-l border-white/10 shadow-2xl transform translate-x-full transition-transform duration-300 ease-[cubic-bezier(0.16,1,0.3,1)] flex flex-col" data-open="false">
    
    <div class="h-[72px] shrink-0 border-b border-white/10 flex items-center justify-between px-6 bg-[#030712]/80 backdrop-blur-xl">
       <div class="flex items-center gap-3">
          <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-rose-500 to-violet-600 flex items-center justify-center text-white font-black text-sm">V</div>
          <span class="font-bold text-white tracking-tight">Panel Użytkownika</span>
       </div>
       <div class="flex items-center gap-3">
          <div class="hidden sm:flex px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs font-mono text-emerald-400 items-center gap-2">
             <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
             <span id="header-vpln-balance">0.00 VPLN</span>
          </div>
          <button id="btn-close-panel" class="h-8 w-8 flex items-center justify-center rounded-lg hover:bg-white/10 transition"><i data-lucide="x" class="h-5 w-5 text-slate-400"></i></button>
       </div>
    </div>

    <div class="flex-1 overflow-hidden flex flex-col md:flex-row">
       
       <nav class="w-full md:w-64 bg-white/2 p-4 md:border-r border-white/5 flex flex-col gap-1 overflow-y-auto shrink-0">
          
          <div class="p-4 mb-4 rounded-xl bg-gradient-to-br from-white/5 to-transparent border border-white/5 flex items-center gap-3">
             <img id="panel-avatar" src="" class="h-10 w-10 rounded-full object-cover bg-slate-800" />
             <div class="overflow-hidden">
                <div id="panel-username" class="font-bold text-white truncate text-sm">User</div>
                <div id="panel-status" class="text-[10px] text-slate-500 uppercase font-bold tracking-wider">Free Plan</div>
             </div>
          </div>

          <button class="nav-tab w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition text-left" data-tab="edit">
             <i data-lucide="settings-2" class="h-4 w-4"></i> Edytuj Profil
          </button>
          <button class="nav-tab w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition text-left" data-tab="listing">
             <i data-lucide="file-plus" class="h-4 w-4"></i> Ogłoszenie
          </button>
          <button class="nav-tab w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition text-left" data-tab="preview">
             <i data-lucide="eye" class="h-4 w-4"></i> Podgląd
          </button>
          <div class="h-px bg-white/10 my-2"></div>
          <button class="nav-tab w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-rose-300 hover:text-rose-200 hover:bg-rose-500/10 transition text-left" data-tab="shop">
             <i data-lucide="crown" class="h-4 w-4"></i> Plany / Premium
          </button>
          <button class="nav-tab w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition text-left" data-tab="settings">
             <i data-lucide="sliders" class="h-4 w-4"></i> Ustawienia
          </button>
          
          <div class="mt-auto pt-4">
             <button id="logout-btn" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-red-400 hover:bg-red-500/10 transition text-left">
                <i data-lucide="log-out" class="h-4 w-4"></i> Wyloguj
             </button>
          </div>
       </nav>

       <div class="flex-1 overflow-y-auto p-6 md:p-10 relative bg-[#030712]">
          <div class="max-w-2xl mx-auto space-y-8 pb-20">
             
             <section id="tab-edit" class="space-y-6">
                <div>
                   <h2 class="text-2xl font-display font-bold text-white mb-1">Twój Profil</h2>
                   <p class="text-slate-400 text-sm">To jak widzą Cię inni w katalogu.</p>
                </div>
                
                <div class="grid gap-5">
                   <div class="grid md:grid-cols-2 gap-5">
                      <div>
                         <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Nick / Imię</label>
                         <input id="edit-name" class="input-modern w-full p-3" />
                      </div>
                      <div>
                         <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Branża</label>
                         <select id="edit-industry" class="input-modern w-full p-3">
                            <option value="dev">Programista</option>
                            <option value="gfx">Grafik</option>
                            <option value="video">Montażysta</option>
                            <option value="tech">Technik / DevOps</option>
                            <option value="mc">Minecraft</option>
                         </select>
                      </div>
                   </div>

                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Avatar URL</label>
                      <input id="edit-avatar-url" class="input-modern w-full p-3" placeholder="https://..." />
                   </div>

                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Bio / O mnie</label>
                      <textarea id="edit-about" rows="4" class="input-modern w-full p-3" placeholder="Krótka historia..."></textarea>
                   </div>
                   
                   <div class="grid md:grid-cols-3 gap-5">
                      <div>
                         <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Budżet Min (PLN)</label>
                         <input id="edit-budget" type="number" class="input-modern w-full p-3" />
                      </div>
                      <div>
                         <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Dostępność</label>
                         <select id="edit-availability" class="input-modern w-full p-3">
                            <option value="24h">24h</option>
                            <option value="48h">48h</option>
                            <option value="72h">72h</option>
                            <option value="Tydzień">Tydzień</option>
                         </select>
                      </div>
                   </div>

                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Tagi (max 12, po przecinku)</label>
                      <input id="edit-tags" class="input-modern w-full p-3" placeholder="React, Figma, Adobe..." />
                   </div>

                   <div class="pt-4 border-t border-white/10">
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-4">Portfolio (URL do obrazków)</label>
                      <div class="grid grid-cols-3 gap-3">
                         <input id="edit-portfolio-1" class="input-modern w-full p-2 text-xs" placeholder="Img 1" />
                         <input id="edit-portfolio-2" class="input-modern w-full p-2 text-xs" placeholder="Img 2" />
                         <input id="edit-portfolio-3" class="input-modern w-full p-2 text-xs" placeholder="Img 3" />
                      </div>
                   </div>

                   <div class="flex items-center gap-3 pt-4">
                      <button id="btn-save-profile" class="btn-new btn-accent px-6 py-3 rounded-xl text-sm">Zapisz Zmiany</button>
                      <button id="btn-reset-profile" class="btn-new btn-glass px-6 py-3 rounded-xl text-sm">Cofnij</button>
                      <button id="btn-open-me-modal" class="btn-new btn-glass px-6 py-3 rounded-xl text-sm">Otwórz</button>
                      <span id="save-status" class="text-xs text-slate-500 ml-auto italic">Wszystko aktualne</span>
                   </div>
                </div>
             </section>

             <section id="tab-listing" class="hidden space-y-6">
                <div>
                   <h2 class="text-2xl font-display font-bold text-white mb-1">Twoje Ogłoszenie</h2>
                   <p class="text-slate-400 text-sm">Treść widoczna na karcie w katalogu.</p>
                </div>
                <div class="grid gap-5 bg-white/5 border border-white/5 rounded-2xl p-6">
                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Nagłówek (Catchphrase)</label>
                      <input id="listing-title" class="input-modern w-full p-3" placeholder="np. Szybkie strony WWW w 3 dni" />
                   </div>
                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Preferowany Kontakt</label>
                      <select id="listing-contact-main" class="input-modern w-full p-3">
                         <option value="Discord">Discord</option>
                         <option value="E-mail">E-mail</option>
                         <option value="Instagram">Instagram</option>
                         <option value="Facebook">Facebook</option>
                      </select>
                   </div>
                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Krótki opis (zajawka)</label>
                      <input id="listing-short" class="input-modern w-full p-3" maxlength="120" />
                   </div>
                   <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Pełna treść oferty</label>
                      <textarea id="listing-long" rows="6" class="input-modern w-full p-3" placeholder="Szczegóły współpracy..."></textarea>
                   </div>
                   
                   <div class="flex gap-3 pt-2">
                      <button id="btn-publish" class="flex-1 btn-new btn-accent py-3 rounded-xl text-sm">Opublikuj</button>
                      <button id="btn-unpublish" class="flex-1 btn-new btn-glass py-3 rounded-xl text-sm text-slate-400">Ukryj</button>
                   </div>
                </div>
             </section>

             <section id="tab-preview" class="hidden space-y-6">
                <div>
                   <h2 class="text-2xl font-display font-bold text-white mb-1">Podgląd</h2>
                   <p class="text-slate-400 text-sm">Tak wyglądasz w wynikach wyszukiwania.</p>
                </div>
                <div class="flex justify-center py-8">
                   <div id="preview-card" class="w-full max-w-md"></div>
                </div>
             </section>

             <section id="tab-shop" class="hidden space-y-6">
                <div>
                   <h2 class="text-2xl font-display font-bold text-white mb-1">Plany & Boost</h2>
                   <p class="text-slate-400 text-sm">Zwiększ widoczność w katalogu.</p>
                   <span id="plan-status" class="hidden"></span> </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                   <div class="relative group p-6 rounded-2xl border border-rose-500/30 bg-gradient-to-b from-rose-500/10 to-transparent hover:bg-rose-500/15 transition-all">
                      <div class="absolute top-0 right-0 p-3">
                         <i data-lucide="zap" class="h-6 w-6 text-rose-500"></i>
                      </div>
                      <h3 class="text-lg font-bold text-white mb-1">Premium</h3>
                      <div class="text-2xl font-black text-rose-400 mb-4">23.99 PLN <span class="text-xs font-medium text-slate-500">/mc</span></div>
                      <ul class="text-sm text-slate-300 space-y-2 mb-6">
                         <li class="flex items-center gap-2"><i data-lucide="check" class="h-3 w-3 text-rose-500"></i> Odznaka Premium</li>
                         <li class="flex items-center gap-2"><i data-lucide="check" class="h-3 w-3 text-rose-500"></i> Wyżej w wynikach</li>
                         <li class="flex items-center gap-2"><i data-lucide="check" class="h-3 w-3 text-rose-500"></i> Złota ramka</li>
                      </ul>
                      <button id="btn-buy-premium" class="w-full btn-new btn-accent py-2 rounded-xl text-sm">Aktywuj</button>
                      <button id="btn-cancel-premium" class="w-full mt-2 py-2 text-xs text-slate-500 hover:text-white">Anuluj subskrypcję</button>
                   </div>

                   <div class="relative group p-6 rounded-2xl border border-violet-500/30 bg-gradient-to-b from-violet-500/10 to-transparent hover:bg-violet-500/15 transition-all">
                      <div class="absolute top-0 right-0 p-3">
                         <i data-lucide="badge-check" class="h-6 w-6 text-violet-500"></i>
                      </div>
                      <h3 class="text-lg font-bold text-white mb-1">Verified</h3>
                      <div class="text-2xl font-black text-violet-400 mb-4">19.55 PLN <span class="text-xs font-medium text-slate-500">/mc</span></div>
                       <ul class="text-sm text-slate-300 space-y-2 mb-6">
                         <li class="flex items-center gap-2"><i data-lucide="check" class="h-3 w-3 text-violet-500"></i> Odznaka Zweryfikowany</li>
                         <li class="flex items-center gap-2"><i data-lucide="check" class="h-3 w-3 text-violet-500"></i> Buduje zaufanie</li>
                         <li class="flex items-center gap-2"><i data-lucide="check" class="h-3 w-3 text-violet-500"></i> Dostęp do zleceń PRO</li>
                      </ul>
                      <button id="btn-buy-verified" class="w-full btn-new btn-glass border-violet-500/50 text-violet-300 hover:bg-violet-500/20 py-2 rounded-xl text-sm">Aktywuj</button>
                      <button id="btn-cancel-verified" class="w-full mt-2 py-2 text-xs text-slate-500 hover:text-white">Anuluj subskrypcję</button>
                   </div>
                </div>
             </section>

             <section id="tab-settings" class="hidden space-y-6">
                <div>
                   <h2 class="text-2xl font-display font-bold text-white mb-1">Ustawienia</h2>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/5 divide-y divide-white/5">
                   <label class="flex items-center justify-between p-4 cursor-pointer">
                      <div>
                         <div class="font-bold text-sm text-white">Toasty / Powiadomienia</div>
                         <div class="text-xs text-slate-500">Komunikaty o akcjach w rogu ekranu.</div>
                      </div>
                      <input id="set-toast" type="checkbox" class="accent-rose-500 h-5 w-5" />
                   </label>
                   <label class="flex items-center justify-between p-4 cursor-pointer">
                      <div>
                         <div class="font-bold text-sm text-white">Skrót klawiszowy "/"</div>
                         <div class="text-xs text-slate-500">Szybkie przejście do wyszukiwarki.</div>
                      </div>
                      <input id="set-slash" type="checkbox" class="accent-rose-500 h-5 w-5" />
                   </label>
                   <label class="flex items-center justify-between p-4 cursor-pointer">
                      <div>
                         <div class="font-bold text-sm text-white">Ukryj budżet</div>
                         <div class="text-xs text-slate-500">Nie pokazuj "od X PLN" na kartach.</div>
                      </div>
                      <input id="set-hide-budget" type="checkbox" class="accent-rose-500 h-5 w-5" />
                   </label>
                   <label class="flex items-center justify-between p-4 cursor-pointer">
                      <div>
                         <div class="font-bold text-sm text-white">Ukryj ocenę</div>
                         <div class="text-xs text-slate-500">Nie pokazuj gwiazdek na kartach.</div>
                      </div>
                      <input id="set-hide-rating" type="checkbox" class="accent-rose-500 h-5 w-5" />
                   </label>
                   <label class="flex items-center justify-between p-4 cursor-pointer">
                      <div>
                         <div class="font-bold text-sm text-white">Focus Trap</div>
                         <div class="text-xs text-slate-500">Dostępność w oknach modalnych.</div>
                      </div>
                      <input id="set-focus-trap" type="checkbox" class="accent-rose-500 h-5 w-5" />
                   </label>
                </div>
                <button id="btn-reset-settings" class="text-xs text-slate-500 hover:text-white underline">Przywróć domyślne</button>
             </section>

             <section id="tab-security" class="hidden space-y-6">
                <div><h2 class="text-2xl font-display font-bold text-white mb-1">Bezpieczeństwo</h2></div>
                <div class="p-6 bg-white/5 border border-white/5 rounded-2xl text-sm text-slate-400">
                   Zalecamy ostrożność. To demo front-endowe.
                </div>
             </section>

          </div>
       </div>
    </div>
  </aside>

  <script>
    (function(){
      /* Utility Helpers */
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
      const now = () => Date.now();
      const safeParse = (v, f) => { try { return JSON.parse(v); } catch { return f; } };
      const safeStringify = (v, f="{}") => { try { return JSON.stringify(v); } catch { return f; } };
      const escapeHTML = (str) => String(str??"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'}[m]));
      const normalizeText = (s) => String(s||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");
      const debounce = (fn, d=250) => { let t; return (...a) => { clearTimeout(t); t=setTimeout(()=>fn(...a), d); }; };
      function decodeJwt(token){ try { return JSON.parse(atob(token.split('.')[1])); } catch { return null; } }

      /* --- STATE & STORAGE --- */
      const LS = {
        keyProfiles: "vm_profiles_v2",
        keySaved: "vm_saved_v2",
        keySubs: "vm_subs_v2",
        keyMe: "vm_me_v2",
        keySettings: "vm_settings_v2",
        getProfiles(){ return safeParse(localStorage.getItem(this.keyProfiles), null); },
        setProfiles(l){ localStorage.setItem(this.keyProfiles, safeStringify(l,"[]")); },
        getSaved(){ return new Set(safeParse(localStorage.getItem(this.keySaved), [])); },
        setSaved(setOrArr){ const arr=Array.isArray(setOrArr)?setOrArr:Array.from(setOrArr); localStorage.setItem(this.keySaved, safeStringify(arr,"[]")); },
        getSubs(){ return safeParse(localStorage.getItem(this.keySubs), {premium:false, verified:false}); },
        setSubs(o){ localStorage.setItem(this.keySubs, safeStringify(o,"{}")); },
        getMe(){ return safeParse(localStorage.getItem(this.keyMe), null); },
        setMe(o){ localStorage.setItem(this.keyMe, safeStringify(o,"{}")); },
        getSettings(){ return safeParse(localStorage.getItem(this.keySettings), {toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true}); },
        setSettings(o){ localStorage.setItem(this.keySettings, safeStringify(o,"{}")); },
      };

      const state = {
        q:"", industry:"all", premiumOnly:false, verifiedOnly:false, availableOnly:false, savedOnly:false, sort:"recommended", budgetMin:null, budgetMax:null,
        pageSize:6, shown:0, modalOpen:false, modalList:[], modalIndex:-1, lastFocus:null
      };

      /* --- SEED DATA (Original) --- */
      const FALLBACK_PROFILES = [
        { id:"p1", name:"zxq0", industry:"dev", industryLabel:"Programista", tagline:"React • Node • API • Automatyzacje", about:"Buduję szybkie MVP, integracje i automatyzacje.", rating:4.9, availableIn:"48h", minBudget:300, location:"Online", premium:true, verified:true, avatar:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop", portfolio:["https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900","https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900","https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900"], createdAt: now() },
        { id:"p2", name:"Klaudia", industry:"gfx", industryLabel:"Grafik", tagline:"Branding • UI • Miniatury", about:"Robię branding, UI i grafiki pod social.", rating:4.7, availableIn:"24h", minBudget:200, location:"Online", premium:true, verified:false, avatar:"https://images.unsplash.com/photo-1548142813-c348350df52b?q=80&w=512&auto=format&fit=crop", portfolio:["https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=900","",""], createdAt: now()-100000 },
        { id:"p3", name:"kubus", industry:"tech", industryLabel:"DevOps", tagline:"Linux • Proxy • Security", about:"Pomagam z serwerami i bezpieczeństwem.", rating:4.8, availableIn:"72h", minBudget:250, location:"Online", premium:false, verified:true, avatar:"https://images.unsplash.com/photo-1603415526960-f7e0328b7cf6?q=80&w=512", portfolio:[], createdAt: now()-200000 },
        { id:"p4", name:"A.I.", industry:"video", industryLabel:"Montażysta", tagline:"Shortsy • Motion • TikTok", about:"Montaż shortów i reels.", rating:4.6, availableIn:"48h", minBudget:300, location:"Online", premium:false, verified:false, avatar:"https://images.unsplash.com/photo-1520975682038-1c5d5cfc20a1?q=80&w=512", portfolio:[], createdAt: now()-300000 }
      ];

      function ensureInit(){
        if(!LS.getProfiles()) LS.setProfiles(FALLBACK_PROFILES);
        if(!LS.getMe()) LS.setMe({ id:"me", name:"zxq0", industry:"dev", about:"Tworzę produkty web.", availability:"48h", minBudget:300, tags:["React","Node"], avatar:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512", portfolio:["","",""], listing:{ title:"Programista React", contactMain:"Discord", short:"Buduję MVP.", long:"Pełna oferta...", published:true } });
        if(!localStorage.getItem(LS.keySaved)) LS.setSaved([]);
        if(!localStorage.getItem(LS.keySubs)) LS.setSubs({premium:false, verified:false});
        if(!localStorage.getItem(LS.keySettings)) LS.setSettings({toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true});
      }

      /* --- TOAST SYSTEM --- */
      const Toast = (() => {
         let container;
         const ensure = () => {
            if(container) return;
            container = document.createElement("div");
            container.className = "fixed bottom-5 right-5 z-[200] flex flex-col gap-2 pointer-events-none";
            document.body.appendChild(container);
         };
         return {
            push(msg, icon="check") {
               if(!LS.getSettings().toast) return;
               ensure();
               const el = document.createElement("div");
               el.className = "pointer-events-auto flex items-center gap-3 bg-[#111] border border-white/10 text-white px-4 py-3 rounded-xl shadow-2xl shadow-black/50 translate-y-10 opacity-0 transition-all duration-300 transform";
               el.innerHTML = `<i data-lucide="${icon}" class="h-4 w-4 text-rose-500"></i><span class="text-sm font-medium">${escapeHTML(msg)}</span>`;
               container.appendChild(el);
               try { lucide.createIcons(); } catch {}
               requestAnimationFrame(() => el.classList.remove("translate-y-10", "opacity-0"));
               setTimeout(() => { el.classList.add("translate-y-5", "opacity-0"); setTimeout(() => el.remove(), 300); }, 2500);
            }
         }
      })();
      const notify = (m, i) => Toast.push(m, i);

      /* --- HELPERS --- */
      const industryLabel = (c) => ({dev:"Programista", gfx:"Grafik", video:"Montażysta", tech:"Technik/DevOps", mc:"Budowniczy MC"}[c] || "Freelancer");
      const formatMoney = (n) => n ? `${n} PLN` : "";
      
      /* --- RENDER CARD (New Premium Design) --- */
      function profileCardHTML(p) {
         const settings = LS.getSettings();
         const saved = LS.getSaved().has(p.id);
         const borderClass = p.premium ? "premium-border" : "border-white/10 hover:border-white/20";
         
         const badges = [];
         if(p.premium) badges.push(`<span class="inline-flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider text-rose-300 bg-rose-500/10 px-2 py-0.5 rounded-full border border-rose-500/20"><i data-lucide="zap" class="h-3 w-3"></i> PRO</span>`);
         if(p.verified) badges.push(`<span class="inline-flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider text-emerald-300 bg-emerald-500/10 px-2 py-0.5 rounded-full border border-emerald-500/20"><i data-lucide="badge-check" class="h-3 w-3"></i> VERIFIED</span>`);
         
         const thumbs = (p.portfolio||[]).slice(0,3).map((src, i) => 
            src ? `<div class="aspect-[4/3] bg-black/50 rounded-lg overflow-hidden border border-white/5"><img src="${escapeHTML(src)}" class="w-full h-full object-cover opacity-70 hover:opacity-100 transition-opacity" loading="lazy"/></div>` 
                : `<div class="aspect-[4/3] bg-white/5 rounded-lg border border-white/5 flex items-center justify-center"><i data-lucide="image-off" class="h-4 w-4 text-white/20"></i></div>`
         ).join("");

         const chips = [];
         if(!settings.hideRating) chips.push(`<span class="bg-white/5 px-2 py-1 rounded border border-white/5"><i data-lucide="star" class="h-3 w-3 inline mr-1 text-amber-400"></i>${p.rating}</span>`);
         chips.push(`<span class="bg-white/5 px-2 py-1 rounded border border-white/5"><i data-lucide="clock" class="h-3 w-3 inline mr-1 text-blue-400"></i>${p.availableIn}</span>`);
         if(!settings.hideBudget && p.minBudget) chips.push(`<span class="bg-white/5 px-2 py-1 rounded border border-white/5 text-emerald-400">od ${p.minBudget} PLN</span>`);

         return `
         <article class="glass-card rounded-2xl p-5 ${borderClass} group relative">
            <div class="flex items-start justify-between gap-4 mb-4">
               <div class="flex items-center gap-3">
                  <div class="h-14 w-14 rounded-2xl overflow-hidden bg-slate-800 shadow-lg shrink-0">
                     <img src="${escapeHTML(p.avatar||"")}" class="w-full h-full object-cover" loading="lazy" alt=""/>
                  </div>
                  <div class="min-w-0">
                     <h3 class="font-display font-bold text-white text-lg leading-tight group-hover:text-rose-400 transition-colors truncate">${escapeHTML(p.name)}</h3>
                     <div class="text-xs text-slate-400 font-medium mb-1 truncate">${escapeHTML(p.tagline||"")}</div>
                     <div class="flex gap-2 flex-wrap">${badges.join("")}</div>
                  </div>
               </div>
               <button class="h-9 w-9 flex items-center justify-center rounded-full bg-white/5 hover:bg-white/10 text-slate-400 hover:text-rose-400 transition shrink-0" data-action="save" data-id="${p.id}">
                  <i data-lucide="${saved ? 'bookmark-check' : 'bookmark'}" class="h-4 w-4 ${saved ? 'text-rose-500 fill-rose-500' : ''}"></i>
               </button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-4 text-[11px] font-semibold text-slate-400">
               ${chips.join("")}
            </div>

            <div class="grid grid-cols-3 gap-2 mb-4">
               ${thumbs}
            </div>

            <button class="w-full btn-new btn-glass py-2.5 rounded-xl text-sm group-hover:bg-white/10 group-hover:border-white/20" data-action="open" data-id="${p.id}">
               Zobacz Profil
            </button>
         </article>
         `;
      }

      /* --- LOGIC PRESERVED FROM ORIGINAL --- */
      function matchesBudget(p){
         const min = state.budgetMin, max = state.budgetMax;
         const b = Number(p.minBudget||0);
         if(min!=null && b<min) return false;
         if(max!=null && b>max) return false;
         return true;
      }
      function matchesSearch(p){
         const q = normalizeText(state.q).trim();
         if(!q) return true;
         return normalizeText([p.name, p.tagline, industryLabel(p.industry), p.about].join(" ")).includes(q);
      }
      function parseAvailableHours(str){
         const s=String(str||"").toLowerCase();
         if(s.includes("tydz")) return 168;
         const m=s.match(/(\d+)\s*h/);
         return m ? Number(m[1]) : 9999;
      }
      function scoreRecommended(p){
         return (p.premium?4:0) + (p.verified?2.2:0) + (Number(p.rating||0)*1.2) + ((p.createdAt||0)/1e12);
      }

      function getFilteredList() {
         let all = LS.getProfiles() || [];
         const me = LS.getMe();
         const subs = LS.getSubs();
         if(me && me.listing?.published) {
             const meP = { ...me, ...me.listing, industryLabel: industryLabel(me.industry), rating: 4.9, verified: subs.verified, premium: subs.premium, id:"me", createdAt: now() };
             all = [meP, ...all.filter(x=>x.id!=="me")];
         }
         
         const savedSet = LS.getSaved();
         let list = all.filter(p => {
             if(state.industry!=="all" && p.industry!==state.industry) return false;
             if(state.premiumOnly && !p.premium) return false;
             if(state.verifiedOnly && !p.verified) return false;
             if(state.availableOnly && parseAvailableHours(p.availableIn) > 72) return false;
             if(state.savedOnly && !savedSet.has(p.id)) return false;
             if(!matchesBudget(p)) return false;
             if(!matchesSearch(p)) return false;
             return true;
         });

         if(state.sort==="newest") list.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
         else if(state.sort==="rating") list.sort((a,b)=>(Number(b.rating||0)-Number(a.rating||0)));
         else if(state.sort==="verified") list.sort((a,b)=>((b.verified?1:0)-(a.verified?1:0)) || (scoreRecommended(b)-scoreRecommended(a)));
         else list.sort((a,b)=>scoreRecommended(b)-scoreRecommended(a));
         
         return list;
      }

      function renderList(resetShown=true) {
         const list = getFilteredList();
         if(resetShown) state.shown = Math.min(state.pageSize, list.length);
         
         $("#stat-results").textContent = list.length;
         $("#stat-saved").textContent = LS.getSaved().size;
         $("#stat-filters").textContent = [state.q, state.industry!="all", state.premiumOnly, state.verifiedOnly, state.budgetMin].filter(Boolean).length;
         $("#saved-pill").textContent = LS.getSaved().size;
         $("#saved-pill-m").className = LS.getSaved().size ? "absolute top-0 right-0 h-2 w-2 bg-rose-500 rounded-full" : "hidden";
         $("#shown-count").textContent = Math.min(state.shown, list.length);
         $("#total-count").textContent = list.length;

         const container = $("#profiles-list");
         if(!list.length) {
            container.innerHTML = `<div class="col-span-full py-20 text-center text-slate-500 flex flex-col items-center"><i data-lucide="ghost" class="h-12 w-12 mb-4 opacity-50"></i><p>Nic nie znaleziono.</p></div>`;
            $("#btn-load-more").style.display = "none";
         } else {
            container.innerHTML = list.slice(0, state.shown).map(profileCardHTML).join("");
            const canMore = state.shown < list.length;
            $("#btn-load-more").style.display = "flex";
            $("#btn-load-more").disabled = !canMore;
            $("#btn-load-more span").textContent = canMore ? "Wczytaj więcej" : "To już wszystko";
         }
         
         renderActiveFilters();
         
         $$("[data-action='open']").forEach(b => b.onclick = () => openModal(b.dataset.id, list));
         $$("[data-action='save']").forEach(b => b.onclick = (e) => { e.stopPropagation(); toggleSave(b.dataset.id); });
         
         try{ lucide.createIcons(); }catch{}
      }

      function renderActiveFilters(){
         const wrap=$("#active-filters");
         if(!wrap) return;
         const pills=[];
         if(state.q.trim()) pills.push(["q", `Szukaj: ${state.q}`]);
         if(state.industry!=="all") pills.push(["industry", `Branża: ${industryLabel(state.industry)}`]);
         if(state.savedOnly) pills.push(["saved", "Zapisane"]);
         if(state.premiumOnly) pills.push(["premium", "Premium"]);
         if(state.verifiedOnly) pills.push(["verified", "Verified"]);
         if(state.availableOnly) pills.push(["avail", "≤72h"]);
         if(state.budgetMin!=null) pills.push(["bmin", `Budżet ≥ ${state.budgetMin}`]);
         if(state.budgetMax!=null) pills.push(["bmax", `Budżet ≤ ${state.budgetMax}`]);

         wrap.innerHTML = pills.map(([k,l]) => `
            <span class="tag-modern inline-flex items-center gap-1 cursor-pointer hover:bg-red-500/20 hover:text-red-300" data-action="remove-pill" data-key="${k}">
               ${escapeHTML(l)} <i data-lucide="x" class="h-3 w-3"></i>
            </span>
         `).join("");
         wrap.classList.toggle("hidden", !pills.length);
         wrap.classList.toggle("flex", !!pills.length);
      }

      function toggleSave(id) {
         const s = LS.getSaved();
         if(s.has(id)) { s.delete(id); notify("Usunięto z zapisanych", "trash"); }
         else { s.add(id); notify("Zapisano profil", "bookmark-check"); }
         LS.setSaved(s);
         renderList(false);
         // Update active modal
         if(state.modalOpen && state.modalList[state.modalIndex]?.id === id) {
            updateModalContent();
         }
      }

      /* --- MODAL LOGIC (New Style) --- */
      function openModal(id, list) {
         const fullList = list || getFilteredList();
         state.modalList = fullList;
         const idx = fullList.findIndex(p => p.id === id);
         if(idx < 0) return;
         state.modalIndex = idx;
         state.modalOpen = true;
         updateModalContent();
         
         $("#profile-modal").classList.remove("hidden");
         $("#profile-modal").classList.add("flex");
         $("#overlay").classList.remove("pointer-events-none", "opacity-0");
         document.body.style.overflow = "hidden";
      }

      function closeModal() {
         state.modalOpen = false;
         $("#profile-modal").classList.add("hidden");
         $("#profile-modal").classList.remove("flex");
         if($("#user-panel").dataset.open !== "true") {
            $("#overlay").classList.add("pointer-events-none", "opacity-0");
            document.body.style.overflow = "";
         }
      }

      function updateModalContent() {
         const p = state.modalList[state.modalIndex];
         if(!p) return;
         
         $("#modal-avatar").src = p.avatar || "";
         $("#modal-name").textContent = p.name;
         $("#modal-sub").textContent = `${industryLabel(p.industry)} • ${p.location||"Online"}`;
         
         let bHTML = "";
         if(p.premium) bHTML += `<i data-lucide="zap" class="h-4 w-4 text-rose-500 fill-rose-500"></i>`;
         if(p.verified) bHTML += `<i data-lucide="badge-check" class="h-4 w-4 text-emerald-500 fill-emerald-500"></i>`;
         $("#modal-badges").innerHTML = bHTML;

         $("#modal-chips").innerHTML = [
            `⭐️ ${p.rating}`, `💰 od ${p.minBudget||0} PLN`, p.industryLabel
         ].map(t => `<span class="px-2 py-1 rounded bg-white/5 border border-white/5 text-xs text-slate-300 font-mono">${t}</span>`).join("");

         $("#modal-portfolio").innerHTML = (p.portfolio||[]).slice(0,3).map(src => 
            src ? `<img src="${escapeHTML(src)}" class="rounded-lg border border-white/10 hover:scale-105 transition-transform cursor-pointer" />` : `<div class="rounded-lg bg-white/5 h-20"></div>`
         ).join("");

         $("#modal-about").textContent = p.about || "";
         
         const saved = LS.getSaved().has(p.id);
         const btn = $("#btn-save-from-modal");
         btn.innerHTML = saved ? `<i data-lucide="bookmark-check" class="h-4 w-4"></i> Zapisano` : `<i data-lucide="bookmark" class="h-4 w-4"></i> Zapisz`;
         btn.onclick = () => toggleSave(p.id);
         
         $("#btn-copy-name").onclick = () => { navigator.clipboard.writeText(p.name); notify("Skopiowano nick", "copy"); };

         try{ lucide.createIcons(); }catch{}
      }

      /* --- USER PANEL LOGIC --- */
      function togglePanel(open) {
         const p = $("#user-panel");
         p.dataset.open = open ? "true" : "false";
         p.style.transform = open ? "translateX(0)" : "translateX(100%)";
         if(open) {
            $("#overlay").classList.remove("pointer-events-none", "opacity-0");
            fillPanel();
         } else if(!state.modalOpen) {
            $("#overlay").classList.add("pointer-events-none", "opacity-0");
         }
      }

      function fillPanel() {
         const me = LS.getMe();
         if(!me) return;
         $("#panel-username").textContent = me.name;
         $("#panel-avatar").src = me.avatar || "";
         
         $("#edit-name").value = me.name || "";
         $("#edit-industry").value = me.industry || "dev";
         $("#edit-about").value = me.about || "";
         $("#edit-budget").value = me.minBudget || "";
         $("#edit-availability").value = me.availability || "48h";
         $("#edit-tags").value = (me.tags||[]).join(", ");
         $("#edit-avatar-url").value = me.avatar || "";
         $("#edit-portfolio-1").value = me.portfolio?.[0] || "";
         $("#edit-portfolio-2").value = me.portfolio?.[1] || "";
         $("#edit-portfolio-3").value = me.portfolio?.[2] || "";

         $("#listing-title").value = me.listing?.title || "";
         $("#listing-contact-main").value = me.listing?.contactMain || "Discord";
         $("#listing-short").value = me.listing?.short || "";
         $("#listing-long").value = me.listing?.long || "";
         
         const subs = LS.getSubs();
         $("#panel-status").textContent = subs.premium ? "PREMIUM" : "FREE PLAN";
         $("#panel-status").className = subs.premium ? "text-[10px] text-rose-400 font-bold uppercase tracking-wider" : "text-[10px] text-slate-500 uppercase font-bold tracking-wider";
      }

      function saveProfile() {
         const me = LS.getMe();
         me.name = $("#edit-name").value;
         me.industry = $("#edit-industry").value;
         me.about = $("#edit-about").value;
         me.minBudget = parseInt($("#edit-budget").value) || 0;
         me.availability = $("#edit-availability").value;
         me.tags = $("#edit-tags").value.split(",").map(s=>s.trim()).filter(Boolean);
         me.avatar = $("#edit-avatar-url").value;
         me.portfolio = [$("#edit-portfolio-1").value, $("#edit-portfolio-2").value, $("#edit-portfolio-3").value];
         
         me.listing = me.listing || {};
         me.listing.title = $("#listing-title").value;
         me.listing.contactMain = $("#listing-contact-main").value;
         me.listing.short = $("#listing-short").value;
         me.listing.long = $("#listing-long").value;
         
         LS.setMe(me);
         notify("Zapisano profil", "save");
         renderList(false);
         fillPanel();
         renderPreviewCard();
      }

      function renderPreviewCard(){
         const me = LS.getMe();
         const subs = LS.getSubs();
         $("#preview-card").innerHTML = profileCardHTML({...me, ...me.listing, industryLabel: industryLabel(me.industry), premium:subs.premium, verified:subs.verified, id:"me"});
         try{ lucide.createIcons(); }catch{}
      }

      /* --- EVENTS --- */
      function bindEvents() {
         $("#search-input").oninput = debounce((e) => { state.q = e.target.value; renderList(true); });
         $("#industry-select").onchange = (e) => { state.industry = e.target.value; renderList(true); };
         $("#sort-select").onchange = (e) => { state.sort = e.target.value; renderList(true); };
         $("#budget-min").oninput = debounce((e) => { state.budgetMin = parseInt(e.target.value)||null; renderList(true); });
         $("#budget-max").oninput = debounce((e) => { state.budgetMax = parseInt(e.target.value)||null; renderList(true); });
         
         const bindChip = (id, prop) => {
            $(id).onclick = () => { 
               state[prop] = !state[prop]; 
               $(id).dataset.active = state[prop];
               renderList(true);
               if(state[prop]) notify("Filtr włączony", "filter");
            };
         };
         bindChip("#filter-saved", "savedOnly");
         bindChip("#filter-premium", "premiumOnly");
         bindChip("#filter-verified", "verifiedOnly");
         bindChip("#filter-available", "availableOnly");

         $("#btn-reset-filters").onclick = () => {
             state.q = ""; state.industry = "all"; state.premiumOnly = false; state.verifiedOnly = false; state.budgetMin = null; state.budgetMax=null;
             $("#search-input").value = ""; $("#budget-min").value = ""; $("#budget-max").value = "";
             $$(".tag-modern").forEach(t => t.dataset.active = "false");
             renderList(true);
             notify("Wyczyszczono filtry", "rotate-ccw");
         };

         $("#active-filters").onclick = (e) => {
            const t = e.target.closest("[data-action='remove-pill']");
            if(!t) return;
            const k = t.dataset.key;
            if(k=="q") state.q=""; 
            if(k=="industry") state.industry="all";
            if(k=="saved") state.savedOnly=false;
            if(k=="premium") state.premiumOnly=false;
            if(k=="verified") state.verifiedOnly=false;
            if(k=="avail") state.availableOnly=false;
            if(k=="bmin") state.budgetMin=null;
            if(k=="bmax") state.budgetMax=null;
            renderList(true);
         };

         $("#btn-load-more").onclick = () => { state.shown += state.pageSize; renderList(false); };

         $("#modal-close").onclick = closeModal;
         $("#overlay").onclick = () => { closeModal(); togglePanel(false); };
         $("#modal-next").onclick = () => { if(state.modalOpen) { state.modalIndex = (state.modalIndex+1)%state.modalList.length; updateModalContent(); }};
         $("#modal-prev").onclick = () => { if(state.modalOpen) { state.modalIndex = (state.modalIndex-1+state.modalList.length)%state.modalList.length; updateModalContent(); }};
         document.onkeydown = (e) => { 
            if(e.key === "Escape") { closeModal(); togglePanel(false); }
            if(state.modalOpen) {
                if(e.key === "ArrowRight") $("#modal-next").click();
                if(e.key === "ArrowLeft") $("#modal-prev").click();
            }
            if(e.key === "/" && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName) && LS.getSettings().slash) {
               e.preventDefault(); $("#search-input").focus();
            }
         };

         $("#btn-open-panel").onclick = () => togglePanel(true);
         $("#btn-open-panel-m").onclick = () => togglePanel(true);
         $("#btn-open-panel-inline").onclick = () => togglePanel(true);
         $("#m-account").onclick = () => togglePanel(true);
         $("#btn-close-panel").onclick = () => togglePanel(false);
         
         $$(".nav-tab").forEach(t => t.onclick = () => {
            $$(".nav-tab").forEach(x => { x.classList.remove("text-white","bg-white/5"); x.classList.add("text-slate-400"); });
            t.classList.add("text-white","bg-white/5");
            t.classList.remove("text-slate-400");
            ["edit","listing","preview","shop","settings","security"].forEach(s => $(`#tab-${s}`).classList.add("hidden"));
            $(`#tab-${t.dataset.tab}`).classList.remove("hidden");
            if(t.dataset.tab === "preview") renderPreviewCard();
         });

         $("#btn-save-profile").onclick = saveProfile;
         $("#btn-reset-profile").onclick = () => { fillPanel(); notify("Cofnięto zmiany", "rotate-ccw"); };
         $("#btn-open-me-modal").onclick = () => { togglePanel(false); openModal("me", getFilteredList()); };
         $("#btn-publish").onclick = () => { const me = LS.getMe(); me.listing.published = true; LS.setMe(me); notify("Opublikowano!", "rocket"); renderList(false); };
         $("#btn-unpublish").onclick = () => { const me = LS.getMe(); me.listing.published = false; LS.setMe(me); notify("Ukryto ogłoszenie", "eye-off"); renderList(false); };
         
         $("#btn-buy-premium").onclick = () => { LS.setSubs({...LS.getSubs(), premium:true}); notify("Witaj w Premium!", "zap"); fillPanel(); };
         $("#btn-cancel-premium").onclick = () => { LS.setSubs({...LS.getSubs(), premium:false}); notify("Anulowano Premium", "info"); fillPanel(); };
         $("#btn-buy-verified").onclick = () => { LS.setSubs({...LS.getSubs(), verified:true}); notify("Konto zweryfikowane!", "check-circle"); fillPanel(); };
         $("#btn-cancel-verified").onclick = () => { LS.setSubs({...LS.getSubs(), verified:false}); notify("Anulowano weryfikację", "info"); fillPanel(); };
         
         $("#set-toast").onchange = (e) => LS.setSettings({...LS.getSettings(), toast:e.target.checked});
         $("#set-slash").onchange = (e) => LS.setSettings({...LS.getSettings(), slash:e.target.checked});
         $("#set-hide-budget").onchange = (e) => LS.setSettings({...LS.getSettings(), hideBudget:e.target.checked});
         $("#set-hide-rating").onchange = (e) => LS.setSettings({...LS.getSettings(), hideRating:e.target.checked});
         $("#set-focus-trap").onchange = (e) => LS.setSettings({...LS.getSettings(), focusTrap:e.target.checked});
         $("#btn-reset-settings").onclick = () => { LS.setSettings({toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true}); syncSettings(); notify("Przywrócono domyślne", "rotate-ccw"); };

         window.onscroll = () => {
             const h = document.documentElement, b = document.body, st = 'scrollTop', sh = 'scrollHeight';
             const pct = (h[st]||b[st]) / ((h[sh]||b[sh]) - h.clientHeight) * 100;
             $("#scroll-progress").style.width = pct + "%";
             $("#app-header").classList.toggle("bg-[#030712]/80", window.scrollY > 50);
             $("#app-header").classList.toggle("border-white/5", window.scrollY > 50);
         };
         
         $("#m-search").onclick = () => { window.scrollTo({top:0, behavior:'smooth'}); $("#search-input").focus(); };
         $("#m-saved").onclick = () => { state.savedOnly = !state.savedOnly; renderList(true); notify(state.savedOnly?"Pokaż zapisane":"Wszystkie", "bookmark"); };
      }

      function syncSettings(){
         const s = LS.getSettings();
         $("#set-toast").checked = s.toast; 
         $("#set-slash").checked = s.slash; 
         $("#set-hide-budget").checked = s.hideBudget; 
         $("#set-hide-rating").checked = s.hideRating; 
         $("#set-focus-trap").checked = s.focusTrap;
      }

      /* --- INIT --- */
      function boot(){
         ensureInit();
         state.pageSize = 6; state.shown = 6;
         bindEvents();
         syncSettings();
         renderList(true);
         // Auto-open active tab
         $(`[data-tab="edit"]`).click();
         setTimeout(() => { if(window.location.hash.startsWith("#profile=")) openModal(decodeURIComponent(window.location.hash.slice(9))); }, 100);
      }

      document.addEventListener("DOMContentLoaded", boot);
    })();
  </script>
</body>
</html>
