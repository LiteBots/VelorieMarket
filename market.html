<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Velorie Market ‚Äî Katalog og≈Çosze≈Ñ</title>
  <meta name="description" content="Velorie Market ‚Äî katalog og≈Çosze≈Ñ freelancer√≥w. Filtry, zapisane, profil, konto." />
  <meta name="theme-color" content="#0a1030" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --accent:#ff0354;
      --accent2:#7c3aed;
      --bg0:#00010f;
      --bg1:#0a1030;

      --glass: rgba(255,255,255,.06);
      --glass-pinned: rgba(10, 16, 48, 0.95);
      --border: rgba(255,255,255,.12);

      --shadow: 0 18px 75px rgba(0,0,0,.62);
      
      --radius-xl: 26px;
      
      --ease: cubic-bezier(.2,.9,.2,1);

      --header-h: 66px;
      --filters-gap: 0px;   
    }

    html{ scroll-behavior:smooth; }
    body{
      background-color: var(--bg0);
      background-image:
        radial-gradient(1200px 700px at 70% -10%, rgba(10,16,48,1) 0%, rgba(6,6,18,.9) 35%, rgba(0,1,15,1) 70%),
        radial-gradient(900px 550px at 12% 110%, rgba(255,3,84,.18) 0%, rgba(255,3,84,0) 62%),
        radial-gradient(850px 550px at 95% 85%, rgba(124,58,237,.16) 0%, rgba(124,58,237,0) 62%),
        radial-gradient(700px 420px at 40% 35%, rgba(0,163,255,.08) 0%, rgba(0,163,255,0) 70%);
      color:#fff;
      overflow-x:hidden;
    }

    /* scrollbars */
    ::-webkit-scrollbar{ width:10px; height:10px; }
    ::-webkit-scrollbar-thumb{ background: var(--accent); border-radius:999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.08); }

    /* progress bar */
    #scroll-progress{
      position:fixed;
      inset:0 0 auto 0;
      height:2px;
      width:0%;
      background: linear-gradient(90deg, var(--accent), rgba(124,58,237,1), rgba(0,163,255,1));
      z-index: 100;
      box-shadow: 0 16px 60px rgba(255,3,84,.25);
    }

    /* PARTICLES */
    @keyframes particle-animation {
      0%, 100% { transform: translateY(0%) translateX(0%) rotate(0deg); }
      50% { transform: translateY(-10%) translateX(5%) rotate(20deg); }
    }
    .particle{
      animation-name: particle-animation;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }

    /* reveal */
    .reveal{
      opacity:0;
      transform: translateY(14px);
      transition: opacity .55s var(--ease), transform .55s var(--ease);
      will-change: opacity, transform;
    }
    .reveal.is-visible{ opacity:1; transform: translateY(0); }

    /* glass standard */
    .glass{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      transition: background 0.3s var(--ease), border-radius 0.3s var(--ease), border-color 0.3s var(--ease);
    }

    /* glass soft (drawer) */
    .glass-soft{
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 55px rgba(0,0,0,.55);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    /* gradient border wrapper */
    .g-border{
      position:relative;
      border-radius: var(--radius-xl);
    }
    .g-border::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:inherit;
      background: linear-gradient(120deg, rgba(255,3,84,.55), rgba(124,58,237,.35), rgba(0,163,255,.25));
      opacity:.55;
      z-index:0;
      pointer-events:none;
    }
    .g-border > *{ position:relative; z-index:1; }

    /* chips / pills */
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.50rem .72rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.13);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.86);
      font-size: 12px;
      line-height: 1;
      white-space: nowrap;
      user-select:none;
      transition: background .15s var(--ease), border-color .15s var(--ease), transform .15s var(--ease), filter .15s var(--ease);
    }
    .chip:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.20); filter: brightness(1.02); }
    .chip:active{ transform: translateY(1px); }
    .chip[data-active="true"]{
      background: rgba(255,3,84,.16);
      border-color: rgba(255,3,84,.45);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:.48rem;
      padding:.48rem .74rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: rgba(255,255,255,.88);
      font-size:12px;
      line-height:1;
      white-space:nowrap;
    }
    .pill button{
      width:18px;height:18px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
    }
    .pill button:hover{ background: rgba(255,255,255,.14); }

    /* buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.55rem;
      border-radius: 16px;
      padding: .85rem 1.05rem;
      font-weight: 850;
      letter-spacing: -.01em;
      transition: transform .14s var(--ease), filter .14s var(--ease), background .14s var(--ease), border-color .14s var(--ease), box-shadow .14s var(--ease);
      user-select:none;
      transform: translateZ(0);
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(255,3,84,1) 0%, rgba(255,3,84,.86) 100%);
      color:#0b0010;
      box-shadow: 0 18px 70px rgba(255,3,84,.22);
    }
    .btn-primary:hover{ filter: brightness(1.07); box-shadow: 0 18px 80px rgba(255,3,84,.28); }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }
    .btn-outline{
      background: transparent;
      border:1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.92);
    }
    .btn-outline:hover{ background: rgba(255,255,255,.06); }

    /* badges */
    .badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size: 12px;
      font-weight: 900;
      padding:.28rem .62rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.94);
    }
    .badge-verified{ background: rgba(124,58,237,.18); }
    .badge-premium{ background: rgba(255,3,84,.18); }

    /* inputs */
    .input{
      width:100%;
      border-radius:16px;
      padding:.82rem .95rem;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      outline:none;
      transition: border-color .15s var(--ease), background .15s var(--ease), box-shadow .15s var(--ease);
      appearance:none;
      -webkit-appearance:none;
    }
    .input:focus{
      border-color: rgba(255,3,84,.60);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 4px rgba(255,3,84,.12);
    }
    .label{
      font-size:12px;
      color: rgba(255,255,255,.70);
      margin-bottom:.35rem;
      display:block;
    }

    /* profile card */
    .profile-card{
      border-radius: var(--radius-xl);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 14px 70px rgba(0,0,0,.50);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      transition: transform .25s var(--ease), background .25s var(--ease), border-color .25s var(--ease), box-shadow .25s var(--ease);
      position:relative;
      overflow:hidden;
      contain: layout paint;
    }
    .profile-card::before{
      content:"";
      position:absolute;
      inset:-120px -120px auto -120px;
      height:180px;
      background:
        radial-gradient(closest-side at 20% 30%, rgba(255,3,84,.18), rgba(255,3,84,0)),
        radial-gradient(closest-side at 80% 35%, rgba(124,58,237,.14), rgba(124,58,237,0));
      opacity:.9;
      pointer-events:none;
      filter: blur(8px);
    }
    .profile-card:hover{
      transform: translateY(-4px) scale(1.005);
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.25);
      box-shadow: 0 22px 90px rgba(0,0,0,.65);
    }
    
    /* Premium Card Pulsing Glow */
    @keyframes pulse-border {
      0% { box-shadow: 0 0 0 0 rgba(255,3,84, 0.4); border-color: rgba(255,3,84,0.3); }
      70% { box-shadow: 0 0 0 6px rgba(255,3,84, 0); border-color: rgba(255,3,84,0.1); }
      100% { box-shadow: 0 0 0 0 rgba(255,3,84, 0); border-color: rgba(255,3,84,0.3); }
    }
    .profile-card-premium {
      border-color: rgba(255,3,84,0.3);
    }
    .profile-card-premium:hover {
      animation: pulse-border 2s infinite;
    }

    .avatar{
      width:58px;
      height:58px;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      flex:0 0 auto;
      background: rgba(255,255,255,.06);
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* portfolio thumbs */
    .thumb{
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      box-shadow: 0 12px 38px rgba(0,0,0,.28);
      position:relative;
    }
    .thumb::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.25) 100%);
      opacity:0;
      transition: opacity .25s var(--ease);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.03);
      transition: transform .35s var(--ease);
    }
    .thumb:hover img{ transform: scale(1.09); }
    .thumb:hover::after{ opacity:.6; }

    /* overlay */
    .overlay{
      position:fixed;
      inset:0;
      z-index:110;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      display:none;
      opacity:0;
      transition: opacity .2s var(--ease);
    }
    .overlay[data-open="true"]{ display:block; opacity:1; }

    /* modal */
    .modal{
      position:fixed;
      inset:0;
      z-index:150;
      display:none;
      place-items:center;
      padding:16px;
    }
    .modal[data-open="true"]{ display:grid; }
    .modal-card{
      width: min(1020px, 96vw);
      max-height: min(86vh, 820px);
      overflow:hidden;
      border-radius:28px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 22px 100px rgba(0,0,0,.70);
      transform: translateY(6px) scale(.99);
      animation: pop .22s var(--ease) forwards;
    }
    @keyframes pop{ to{ transform: translateY(0) scale(1); } }

    .divider{ height:1px; background: rgba(255,255,255,.10); }

    /* drawer */
    .drawer{
      position:fixed;
      inset:0;
      width:100%;
      z-index:140;
      transform: translateY(110%);
      transition: transform .28s var(--ease);
      display:flex;
      flex-direction:column;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      overflow:auto;
    }
    .drawer[data-open="true"]{ transform: translateY(0%); }

    /* STICKY FILTERS & SENTINEL */
    #filters-sentinel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 1px;
      pointer-events: none;
      visibility: hidden;
      transform: translateY(-80px); 
    }

    #filters-bar {
      position: relative;
      top: auto;
      z-index: 10;
      transition: all 0.3s var(--ease);
      margin-top: 1.5rem; 
    }

    #filters-bar.is-pinned {
      margin-top: 0;
      padding-top: 0;
    }

    #filters-bar.is-pinned .glass {
      background: var(--glass-pinned);
      border-radius: 0 0 26px 26px; 
      border-top: none;
      border-left: none;
      border-right: none;
      border-bottom: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      backdrop-filter: blur(25px);
    }
    
    /* bottom bar */
    #mobile-bar{
      position:fixed;
      inset:auto 0 0 0;
      z-index:120;
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      display:none;
    }
    @media (max-width: 768px){
      #mobile-bar{ display:block; }
    }

    /* focus */
    :focus-visible{
      outline:none;
      box-shadow: 0 0 0 4px rgba(255,3,84,.16);
      border-radius:16px;
    }

    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto; }
      .reveal{ transition:none !important; }
      .modal-card{ animation:none !important; transform:none !important; }
      .btn, .profile-card, .thumb img{ transition:none !important; }
    }

    /* --- DASHBOARD V3 STYLES --- */
    
    /* Bento Grid Layout */
    .bento-grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 1rem;
    }
    @media (min-width: 768px) {
      .bento-grid {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: auto auto;
      }
    }
    .bento-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 1.25rem;
      position: relative;
      overflow: hidden;
      transition: border-color 0.2s, background 0.2s;
    }
    .bento-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.15);
    }
    .bento-span-2 { grid-column: span 1; }
    @media (min-width: 768px) { .bento-span-2 { grid-column: span 2; } }

    /* Circular Progress */
    .progress-ring circle {
      transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }

    /* iOS Style Switch */
    .toggle-checkbox:checked {
      right: 0;
      border-color: var(--accent);
    }
    .toggle-checkbox:checked + .toggle-label {
      background-color: var(--accent);
    }
    .toggle-label {
      width: 44px; height: 24px;
      background-color: rgba(255,255,255,0.1);
      border-radius: 999px;
      position: relative;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }
    .toggle-label:after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 20px; height: 20px;
      background-color: #fff;
      border-radius: 50%;
      transition: transform 0.2s ease-in-out;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .toggle-checkbox:checked + .toggle-label:after {
      transform: translateX(20px);
    }
    .toggle-checkbox { display: none; }

    /* Sidebar Navigation Active State */
    .nav-item {
      position: relative;
      transition: all 0.2s;
    }
    .nav-item[data-active="true"] {
      background: rgba(255,255,255,0.08);
      color: #fff;
    }
    .nav-item[data-active="true"]::before {
      content: "";
      position: absolute;
      left: 0; top: 10%; bottom: 10%;
      width: 3px;
      background: var(--accent);
      border-radius: 0 4px 4px 0;
      box-shadow: 0 0 10px var(--accent);
    }
    
    /* Fake Bar Chart */
    .bar-chart {
      display: flex;
      align-items: flex-end;
      gap: 6px;
      height: 60px;
    }
    .bar {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      transition: height 0.5s ease;
    }
    .bar:hover { background: var(--accent); }
    .fade-in { animation: fade-in .3s ease forwards; }
    @keyframes fade-in { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            glow: "0 18px 80px rgba(255,3,84,0.28)"
          }
        }
      }
    };
  </script>
</head>

<body class="min-h-screen text-white selection:bg-[#ff0354]/40 selection:text-white">
  <div id="scroll-progress" aria-hidden="true"></div>

  <div id="particles-container" aria-hidden="true" class="pointer-events-none fixed inset-0 overflow-hidden -z-10"></div>

  <header id="app-header" class="sticky top-0 z-[95] backdrop-blur-xl bg-black/25 border-b border-white/10 transition-colors duration-300">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-3">
      <a href="#katalog" class="flex items-center gap-3 group">
        <div class="h-10 w-10 rounded-xl ring-1 ring-white/10 group-hover:ring-white/20 transition overflow-hidden bg-white/5 flex items-center justify-center">
          <span class="font-black">V</span>
        </div>
        <div class="leading-tight">
          <div class="text-lg font-black tracking-tight">
            Velorie Market
            <span class="ml-2 inline-flex items-center gap-1 text-[10px] font-black text-white/70 bg-white/5 border border-white/10 px-2 py-1 rounded-full align-middle">
              <i data-lucide="sparkles" class="h-3 w-3 text-[var(--accent)]"></i>
              v3.0
            </span>
          </div>
          <div class="text-xs text-white/60">Katalog og≈Çosze≈Ñ ‚Ä¢ Filtry ‚Ä¢ Zapisane ‚Ä¢ Profil</div>
        </div>
      </a>

      <div class="hidden md:flex items-center gap-2">
        <button id="btn-jump-search" class="btn btn-outline px-4 py-2 text-sm" type="button" aria-label="Przejd≈∫ do wyszukiwarki">
          <i data-lucide="search" class="h-4 w-4"></i>
          <span>Szukaj</span>
          <span class="ml-1 text-[10px] px-2 py-1 rounded-full bg-white/5 border border-white/10 text-white/70 font-black">/</span>
        </button>

        <button id="btn-open-saved" class="btn btn-ghost px-4 py-2 text-sm" type="button" aria-label="W≈ÇƒÖcz filtr: zapisane">
          <i data-lucide="bookmark" class="h-4 w-4"></i>
          <span>Zapisane</span>
          <span id="saved-pill" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
        </button>

        <button id="btn-open-panel" class="btn btn-ghost px-4 py-2 text-sm" type="button" aria-label="Otw√≥rz konto">
          <i data-lucide="user" class="h-4 w-4"></i>
          <span>Konto</span>
        </button>
      </div>

      <div class="flex md:hidden items-center gap-2">
        <button id="btn-open-saved-m" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Zapisane">
          <i data-lucide="bookmark" class="h-4 w-4"></i>
          <span id="saved-pill-m" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
        </button>
        <button id="btn-open-panel-m" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Konto">
          <i data-lucide="user" class="h-4 w-4"></i>
        </button>
      </div>
    </div>
  </header>

  <div id="overlay" class="overlay" data-open="false" aria-hidden="true"></div>

  <main id="katalog" class="relative py-10">
    <div class="mx-auto max-w-7xl px-4 relative">

      <section class="reveal g-border mb-8">
        <div class="glass rounded-[26px] p-6 md:p-7">
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
            <div class="max-w-2xl">
              <div class="inline-flex items-center gap-2 text-xs font-black text-white/70 bg-white/5 border border-white/10 px-3 py-2 rounded-full">
                <i data-lucide="shield" class="h-4 w-4 text-[var(--accent)]"></i>
                kontakt bezpo≈õredni ‚Ä¢ bez escrow ‚Ä¢ bez prowizji
              </div>

              <h1 class="mt-3 text-3xl md:text-4xl font-black tracking-tight leading-[1.05]">
                Katalog og≈Çosze≈Ñ
              </h1>

              <p class="text-white/65 mt-3 leading-relaxed">
                Wyszukuj, filtruj, zapisuj i otwieraj profile. Konto s≈Çu≈ºy do edycji profilu publicznego i og≈Çoszenia.
              </p>

              <div class="mt-4 flex flex-wrap items-center gap-2 text-xs text-white/60">
                <span class="chip"><i data-lucide="sparkles" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium = wyr√≥≈ºnienie</span>
                <span class="chip"><i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Verified = zaufanie</span>
                <span class="chip"><i data-lucide="keyboard" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Skr√≥ty: <b>/</b> szukaj, <b>Esc</b> zamyka</span>
              </div>
            </div>

            <div class="min-w-[260px] w-full lg:w-[340px]">
              <div class="grid grid-cols-3 gap-2">
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Wyniki</div>
                  <div class="text-2xl font-black" id="stat-results">0</div>
                </div>
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Zapisane</div>
                  <div class="text-2xl font-black" id="stat-saved">0</div>
                </div>
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Filtry</div>
                  <div class="text-2xl font-black" id="stat-filters">0</div>
                </div>
              </div>

              <div class="mt-3 flex items-center justify-between text-xs text-white/55">
                <span class="inline-flex items-center gap-2">
                  <i data-lucide="activity" class="h-4 w-4 text-[var(--accent)]"></i>
                  ‚ÄúApp feeling‚Äù UI
                </span>
                <span id="results-hint"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="filters-sentinel"></div>

      <div id="filters-bar">
        <div class="glass rounded-[26px] p-4 md:p-5 filters-inner-container">
          <div class="flex flex-col gap-4">

            <div class="grid lg:grid-cols-12 gap-3 items-end">
              <div class="lg:col-span-6">
                <label class="label">Szukaj</label>
                <div class="relative">
                  <input id="search-input" class="input pr-10" placeholder="Szukaj po nazwie, tagach, opisie..." />
                  <div class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-white/55">
                    <i data-lucide="search" class="h-4 w-4"></i>
                  </div>
                </div>
              </div>

              <div class="lg:col-span-3">
                <label class="label">Bran≈ºa</label>
                <select id="industry-select" class="input">
                  <option value="all">Wszystkie</option>
                  <option value="dev">Programista</option>
                  <option value="gfx">Grafik</option>
                  <option value="video">Monta≈ºysta / Content</option>
                  <option value="tech">Technik / DevOps</option>
                  <option value="mc">Budowniczy Minecraft</option>
                </select>
              </div>

              <div class="lg:col-span-3">
                <label class="label">Sortowanie</label>
                <select id="sort-select" class="input">
                  <option value="recommended">Polecane</option>
                  <option value="newest">Najnowsze</option>
                  <option value="rating">Najwy≈ºsza ocena</option>
                  <option value="verified">Zweryfikowani</option>
                </select>
              </div>
            </div>

            <div class="grid lg:grid-cols-12 gap-3 items-end">
              <div class="lg:col-span-6">
                <label class="label">Szybkie filtry</label>
                <div class="flex flex-wrap gap-2">
                  <button id="filter-saved" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="bookmark" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Zapisane
                  </button>
                  <button id="filter-premium" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="zap" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium
                  </button>
                  <button id="filter-verified" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Verified
                  </button>
                  <button id="filter-available" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostƒôpny ‚â§72h
                  </button>
                </div>
              </div>

              <div class="lg:col-span-6">
                <label class="label">Bud≈ºet (PLN)</label>
                <div class="grid grid-cols-2 gap-2">
                  <input id="budget-min" class="input" type="number" min="0" step="10" placeholder="Min. np. 100" />
                  <input id="budget-max" class="input" type="number" min="0" step="10" placeholder="Max. np. 1000" />
                </div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <button class="chip" type="button" data-budget-preset="300">‚â§ 300</button>
                  <button class="chip" type="button" data-budget-preset="500">‚â§ 500</button>
                  <button class="chip" type="button" data-budget-preset="1000">‚â§ 1000</button>
                  <button class="chip" type="button" data-budget-preset="0">Bez limitu</button>
                </div>
              </div>
            </div>

            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 pt-2 border-t border-white/5 mt-1">
              <div class="text-xs text-white/60 flex items-center gap-2">
                <i data-lucide="info" class="h-4 w-4"></i>
                <span>Filtrowanie odbywa siƒô lokalnie.</span>
              </div>

              <div class="flex items-center gap-2 w-full sm:w-auto justify-end">
                <div id="active-filters" class="hidden sm:flex flex-wrap gap-2 justify-end"></div>

                <button id="btn-reset-filters" class="btn btn-outline px-3 py-2 text-xs" type="button">
                  <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                  Wyczy≈õƒá
                </button>

                <button id="btn-open-panel-inline" class="btn btn-primary px-3 py-2 text-xs" type="button">
                  <i data-lucide="sliders-horizontal" class="h-4 w-4"></i>
                  Konto
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>

      <section class="mt-8">
        <div class="flex items-center justify-between gap-3 mb-3">
          <div class="text-sm text-white/70 flex items-center gap-2">
            <i data-lucide="layers" class="h-4 w-4 text-[var(--accent)]"></i>
            <span>Wy≈õwietlane: <b id="shown-count">0</b> / <b id="total-count">0</b></span>
          </div>
          <div class="text-[11px] text-white/50 hidden md:block">
            Kliknij kartƒô profilu, aby otworzyƒá modal. Strza≈Çki ‚Üê/‚Üí dzia≈ÇajƒÖ w modalu.
          </div>
        </div>

        <div class="space-y-4" id="profiles-list"></div>
      </section>

      <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-3 text-sm text-white/70">
        <div class="flex items-center gap-2">
          <i data-lucide="sparkles" class="h-4 w-4 text-[var(--accent)]"></i>
          <span class="text-white/60">Tip:</span>
          <span>U≈ºyj <b class="text-white/90">Zapisane</b> do shortlisty.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="btn-load-more" class="btn btn-ghost px-4 py-2" type="button">
            <i data-lucide="plus" class="h-4 w-4"></i>
            <span>Wczytaj wiƒôcej</span>
          </button>
        </div>
      </div>

      <footer class="mt-10 pb-24 md:pb-8 text-xs text-white/50">
        <div class="glass rounded-[26px] p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 reveal">
          <div class="flex items-center gap-2">
            <i data-lucide="sparkles" class="h-4 w-4 text-[var(--accent)]"></i>
            <span>Velorie Market ‚Ä¢ Platforma og≈Çosze≈Ñ freelancer√≥w</span>
          </div>
          <div class="flex items-center gap-2">
            <span id="footer-year"></span>
            <span>‚Ä¢</span>
            <span class="text-white/60">Made for fast MVP</span>
          </div>
        </div>
      </footer>

    </div>
  </main>

  <div id="mobile-bar" class="pointer-events-none">
    <div class="pointer-events-auto glass rounded-[22px] px-3 py-2 flex items-center justify-between gap-2">
      <button id="m-search" class="btn btn-outline px-3 py-2 text-sm" type="button" aria-label="Szukaj">
        <i data-lucide="search" class="h-4 w-4"></i>
        <span>Szukaj</span>
      </button>
      <button id="m-saved" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Zapisane">
        <i data-lucide="bookmark" class="h-4 w-4"></i>
        <span id="m-saved-count" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
      </button>
      <button id="m-account" class="btn btn-primary px-3 py-2 text-sm" type="button" aria-label="Konto">
        <i data-lucide="user" class="h-4 w-4"></i>
        <span>Konto</span>
      </button>
    </div>
  </div>

  <section id="profile-modal" class="modal" data-open="false" aria-label="Profil" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="p-4 flex items-center justify-between gap-3 border-b border-white/10">
        <div class="flex items-center gap-3 min-w-0">
          <div class="avatar">
            <img id="modal-avatar" src="" alt="Avatar profilu" />
          </div>
          <div class="leading-tight min-w-0">
            <div class="flex items-center gap-2 flex-wrap">
              <div class="text-lg md:text-xl font-black tracking-tight truncate" id="modal-name">Profil</div>
              <span id="modal-badges" class="flex items-center gap-2"></span>
            </div>
            <div class="text-xs text-white/60 truncate" id="modal-sub">‚Äî</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button id="modal-prev" class="btn btn-ghost px-3 py-2" type="button" aria-label="Poprzedni profil">
            <i data-lucide="chevron-left" class="h-4 w-4"></i>
          </button>
          <button id="modal-next" class="btn btn-ghost px-3 py-2" type="button" aria-label="Nastƒôpny profil">
            <i data-lucide="chevron-right" class="h-4 w-4"></i>
          </button>
          <button id="modal-close" class="btn btn-outline px-3 py-2" type="button" aria-label="Zamknij modal">
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>
      </div>

      <div class="grid lg:grid-cols-12 gap-0">
        <div class="lg:col-span-7 p-4 border-b lg:border-b-0 lg:border-r border-white/10">
          <div class="flex flex-wrap items-center gap-2" id="modal-chips"></div>

          <div class="mt-4 grid grid-cols-3 gap-2" id="modal-portfolio"></div>

          <div class="mt-4 glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="file-text" class="h-4 w-4 text-[var(--accent)]"></i>
              Opis
            </div>
            <p class="mt-2 text-sm text-white/75 leading-relaxed whitespace-pre-line" id="modal-about"></p>
          </div>
        </div>

        <div class="lg:col-span-5 p-4">
          <div class="glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="message-circle" class="h-4 w-4 text-[var(--accent)]"></i>
              Kontakt
            </div>
            <p class="mt-2 text-sm text-white/70">
              Skopiuj nick i odezwij siƒô wybranym kana≈Çem. (Demo nie wysy≈Ça wiadomo≈õci.)
            </p>

            <div class="mt-3 grid sm:grid-cols-2 gap-2">
              <button id="btn-copy-name" class="btn btn-primary px-4 py-3" type="button">
                <i data-lucide="copy" class="h-4 w-4"></i>
                Kopiuj nick
              </button>
              <button id="btn-save-from-modal" class="btn btn-ghost px-4 py-3" type="button">
                <i data-lucide="bookmark" class="h-4 w-4"></i>
                Zapisz
              </button>
            </div>

            <div class="mt-4 divider"></div>

            <div class="mt-4 text-xs text-white/55">
              Tip: Link do profilu zawiera <span class="text-white/70 font-semibold">#profile=ID</span>.
            </div>
          </div>

          <div class="mt-3 glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="shield-alert" class="h-4 w-4 text-[var(--accent)]"></i>
              Bezpiecze≈Ñstwo
            </div>
            <ul class="mt-2 text-sm text-white/70 list-disc pl-5 space-y-1">
              <li>Ustalaj warunki wsp√≥≈Çpracy na pi≈õmie.</li>
              <li>Nie udostƒôpniaj hase≈Ç ani kod√≥w przed ustaleniem zasad.</li>
              <li>W razie podejrze≈Ñ ‚Äî zg≈Çaszaj naruszenia.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <aside id="user-panel" class="drawer glass-soft" data-open="false" aria-label="Panel konta">
    <div class="sticky top-0 z-[10] backdrop-blur-xl bg-[#00010f]/80 border-b border-white/10">
      <div class="mx-auto max-w-[1400px] px-4 py-3 flex items-center justify-between gap-4">
        <div class="flex items-center gap-3">
          <div class="h-9 w-9 rounded-lg bg-gradient-to-br from-[var(--accent)] to-purple-600 flex items-center justify-center font-black shadow-lg shadow-purple-900/40">V</div>
          <div class="leading-tight">
            <div class="text-base font-bold tracking-tight">Panel Sterowania</div>
            <div class="text-[10px] text-white/50 uppercase tracking-wider font-semibold">Dashboard v3.0</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <div class="hidden sm:flex items-center gap-2 rounded-lg bg-white/5 px-4 py-2 text-sm font-medium border border-white/10 mr-2">
            <i data-lucide="wallet" class="h-4 w-4 text-[var(--accent)]"></i>
            <span id="header-vpln-balance">0.00 VPLN</span>
          </div>

          <button id="btn-close-panel" class="btn btn-ghost px-3 py-2 text-sm text-white/60 hover:text-white" type="button">
            <kbd class="hidden md:inline-block font-sans text-[10px] bg-white/10 px-1.5 py-0.5 rounded mr-2 border border-white/10">ESC</kbd>
            <i data-lucide="x" class="h-5 w-5"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="mx-auto max-w-[1400px] w-full flex-1 overflow-hidden flex flex-col lg:flex-row">
      
      <nav class="w-full lg:w-64 flex-shrink-0 border-b lg:border-b-0 lg:border-r border-white/10 bg-white/[0.02] overflow-y-auto">
        <div class="p-4 space-y-1">
          <div class="text-xs font-bold text-white/40 px-3 py-2 uppercase tracking-widest mb-1">Menu</div>
          
          <button class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white/70 hover:bg-white/5 text-sm font-medium transition-colors text-left"
                  data-tab="dashboard" type="button">
            <i data-lucide="layout-dashboard" class="h-4 w-4"></i>
            <span>Pulpit</span>
          </button>

          <button class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white/70 hover:bg-white/5 text-sm font-medium transition-colors text-left"
                  data-tab="edit" type="button">
            <i data-lucide="user-cog" class="h-4 w-4"></i>
            <span>Edycja Profilu</span>
          </button>

          <button class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white/70 hover:bg-white/5 text-sm font-medium transition-colors text-left"
                  data-tab="listing" type="button">
            <i data-lucide="file-text" class="h-4 w-4"></i>
            <span>Moje Og≈Çoszenie</span>
          </button>

          <button class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white/70 hover:bg-white/5 text-sm font-medium transition-colors text-left"
                  data-tab="shop" type="button">
            <i data-lucide="shopping-bag" class="h-4 w-4"></i>
            <span>Plany i Sklep</span>
            <span class="ml-auto text-[10px] bg-[var(--accent)]/20 text-[var(--accent)] px-2 py-0.5 rounded-full font-bold">PRO</span>
          </button>

          <div class="my-2 border-t border-white/10"></div>

          <button class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white/70 hover:bg-white/5 text-sm font-medium transition-colors text-left"
                  data-tab="settings" type="button">
            <i data-lucide="settings-2" class="h-4 w-4"></i>
            <span>Ustawienia</span>
          </button>

           <a href="./wallet.html" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white/70 hover:bg-white/5 text-sm font-medium transition-colors text-left">
            <i data-lucide="wallet" class="h-4 w-4"></i>
            <span>Portfel</span>
          </a>

          <div class="mt-8 px-4">
             <div class="p-4 rounded-2xl bg-gradient-to-br from-white/5 to-transparent border border-white/10">
                <div class="flex items-center gap-3 mb-3">
                   <div class="avatar h-10 w-10 border-0 shadow-none">
                      <img id="panel-avatar-mini" src="" alt="" class="rounded-full">
                   </div>
                   <div class="overflow-hidden">
                      <div id="panel-username-mini" class="font-bold truncate text-sm">User</div>
                      <div class="text-xs text-white/50 truncate">Free Plan</div>
                   </div>
                </div>
                <button id="logout-btn" class="btn btn-outline w-full py-1.5 text-xs h-8 border-white/20 hover:bg-red-500/10 hover:border-red-500/50 hover:text-red-400">
                   Wyloguj
                </button>
             </div>
          </div>
        </div>
      </nav>

      <main class="flex-1 overflow-y-auto p-4 md:p-8 bg-[#00010f] relative">
        <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-[var(--accent)]/5 blur-[120px] rounded-full pointer-events-none -translate-y-1/2 translate-x-1/2"></div>

        <section id="tab-dashboard" class="space-y-6 max-w-5xl mx-auto fade-in">
          
          <header class="flex items-end justify-between gap-4 mb-2">
            <div>
              <h2 class="text-3xl font-black tracking-tight text-white mb-1">Dzie≈Ñ dobry! üëã</h2>
              <p class="text-white/60 text-sm">Oto podsumowanie Twojej aktywno≈õci w Velorie Market.</p>
            </div>
            <div class="hidden sm:block text-right">
               <div class="text-xs text-white/40 uppercase tracking-widest font-bold">Data</div>
               <div id="dashboard-date" class="text-white font-mono">...</div>
            </div>
          </header>

          <div class="bento-grid">
            
            <div class="bento-card flex flex-col justify-between group">
               <div class="flex justify-between items-start">
                  <div>
                     <div class="text-white/60 text-xs font-bold uppercase tracking-wider mb-1">Si≈Ça profilu</div>
                     <div class="text-2xl font-black text-white" id="profile-strength-text">0%</div>
                  </div>
                  <div class="relative w-12 h-12">
                     <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                        <path class="text-white/10" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3"></path>
                        <path id="profile-strength-ring" class="text-[var(--accent)] drop-shadow-[0_0_10px_rgba(255,3,84,0.5)]" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"></path>
                     </svg>
                  </div>
               </div>
               <div class="mt-4">
                  <p id="profile-tip" class="text-xs text-white/50 leading-relaxed">Uzupe≈Çnij portfolio, aby zwiƒôkszyƒá zasiƒôgi.</p>
                  <button class="mt-3 text-xs font-bold text-[var(--accent)] hover:text-white transition-colors flex items-center gap-1 group-hover:gap-2 transition-all" onclick="document.querySelector('[data-tab=edit]').click()">
                    Uzupe≈Çnij teraz <i data-lucide="arrow-right" class="h-3 w-3"></i>
                  </button>
               </div>
            </div>

            <div class="bento-card group">
               <div class="flex justify-between items-center mb-4">
                  <div class="text-white/60 text-xs font-bold uppercase tracking-wider">Odwiedziny</div>
                  <div class="text-xs text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded flex items-center gap-1">
                     <i data-lucide="trending-up" class="h-3 w-3"></i> +12%
                  </div>
               </div>
               <div class="bar-chart items-end justify-between h-16 w-full opacity-60 group-hover:opacity-100 transition-opacity">
                  <div class="bar" style="height: 30%"></div>
                  <div class="bar" style="height: 50%"></div>
                  <div class="bar" style="height: 40%"></div>
                  <div class="bar" style="height: 80%; background: var(--accent); box-shadow: 0 0 15px var(--accent);"></div>
                  <div class="bar" style="height: 60%"></div>
                  <div class="bar" style="height: 45%"></div>
                  <div class="bar" style="height: 70%"></div>
               </div>
               <div class="mt-3 flex justify-between items-end">
                  <div class="text-3xl font-black" id="dash-views">0</div>
                  <div class="text-xs text-white/40">ost. 7 dni</div>
               </div>
            </div>

            <div class="bento-card flex flex-col justify-between relative overflow-hidden">
               <div class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-transparent opacity-0 hover:opacity-100 transition-opacity pointer-events-none"></div>
               <div>
                  <div class="text-white/60 text-xs font-bold uppercase tracking-wider mb-2">Twoje og≈Çoszenie</div>
                  <div class="flex items-center gap-2 mb-1">
                     <div id="dash-status-dot" class="w-2 h-2 rounded-full bg-red-500"></div>
                     <span id="dash-status-text" class="font-bold text-lg">Nieaktywne</span>
                  </div>
                  <p class="text-xs text-white/50 line-clamp-2" id="dash-listing-title">Brak tytu≈Çu...</p>
               </div>
               <button class="mt-4 btn btn-ghost text-xs w-full border border-white/10 hover:bg-white/5" onclick="document.querySelector('[data-tab=listing]').click()">
                  ZarzƒÖdzaj
               </button>
            </div>

            <div class="bento-card bento-span-2 flex flex-col sm:flex-row gap-6 items-center">
               <div class="flex-1 w-full">
                  <div class="text-white/60 text-xs font-bold uppercase tracking-wider mb-2">Finanse & Plan</div>
                  <div class="flex items-baseline gap-1">
                     <span class="text-4xl font-black tracking-tighter" id="dash-balance">0.00</span>
                     <span class="text-sm font-bold text-[var(--accent)]">VPLN</span>
                  </div>
                  <div class="mt-4 flex gap-2">
                     <div class="px-3 py-1 rounded bg-white/5 border border-white/10 text-xs flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-gray-400" id="dot-premium"></span> Premium
                     </div>
                     <div class="px-3 py-1 rounded bg-white/5 border border-white/10 text-xs flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-gray-400" id="dot-verified"></span> Verified
                     </div>
                  </div>
               </div>
               <div class="sm:border-l border-white/10 sm:pl-6 flex flex-col justify-center gap-2 w-full sm:w-auto min-w-[140px]">
                  <button class="btn btn-primary w-full text-xs" onclick="document.querySelector('[data-tab=shop]').click()">
                     <i data-lucide="zap" class="h-3 w-3"></i> Ulepsz konto
                  </button>
                  <a href="./wallet.html" class="btn btn-outline w-full text-xs">
                     Do≈Çaduj
                  </a>
               </div>
            </div>

            <div class="bento-card">
               <div class="text-white/60 text-xs font-bold uppercase tracking-wider mb-3">Szybkie akcje</div>
               <div class="space-y-2">
                  <button class="w-full flex items-center justify-between text-xs p-2 rounded hover:bg-white/5 transition-colors group" id="dash-btn-preview">
                     <span>PodglƒÖd profilu</span>
                     <i data-lucide="external-link" class="h-3 w-3 opacity-50 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                  </button>
                  <button class="w-full flex items-center justify-between text-xs p-2 rounded hover:bg-white/5 transition-colors group" onclick="document.querySelector('#set-toast').click()">
                     <span>Prze≈ÇƒÖcz powiadomienia</span>
                     <i data-lucide="bell" class="h-3 w-3 opacity-50 group-hover:opacity-100"></i>
                  </button>
               </div>
            </div>

          </div>
        </section>

        <section id="tab-edit" class="hidden space-y-6 max-w-3xl mx-auto">
           <div class="flex items-center justify-between">
              <h3 class="text-xl font-black">Edycja profilu</h3>
              <button id="btn-save-profile" class="btn btn-primary px-5 py-2 text-sm shadow-[0_0_20px_rgba(255,3,84,0.3)] hover:shadow-[0_0_30px_rgba(255,3,84,0.5)] transition-all">
                Zapisz zmiany
              </button>
           </div>

           <div class="glass p-6 rounded-3xl border border-white/10">
              <label class="block text-xs font-bold uppercase tracking-widest text-white/50 mb-4">Wizerunek</label>
              <div class="flex items-center gap-6">
                 <div class="relative group cursor-pointer">
                    <div class="h-24 w-24 rounded-2xl overflow-hidden border-2 border-white/10 group-hover:border-[var(--accent)] transition-colors">
                       <img id="edit-avatar-preview" src="" class="w-full h-full object-cover">
                    </div>
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-2xl">
                       <i data-lucide="upload" class="h-6 w-6"></i>
                    </div>
                 </div>
                 <div class="flex-1">
                    <label class="label">Avatar URL</label>
                    <div class="relative">
                       <input id="edit-avatar-url" class="input pl-10" placeholder="https://..." />
                       <i data-lucide="link" class="absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-white/40"></i>
                    </div>
                    <p class="text-[10px] text-white/40 mt-2">Zalecane: 500x500px, kwadrat. Obs≈Çugujemy linki zewnƒôtrzne.</p>
                 </div>
              </div>
           </div>

           <div class="glass p-6 rounded-3xl border border-white/10 space-y-4">
              <label class="block text-xs font-bold uppercase tracking-widest text-white/50 mb-2">Dane podstawowe</label>
              <div class="grid md:grid-cols-2 gap-4">
                 <div>
                    <label class="label">Nick / Imiƒô</label>
                    <input id="edit-name" class="input font-bold" />
                 </div>
                 <div>
                    <label class="label">Bran≈ºa</label>
                    <select id="edit-industry" class="input appearance-none">
                      <option value="dev">Programista</option>
                      <option value="gfx">Grafik</option>
                      <option value="video">Monta≈ºysta / Content</option>
                      <option value="tech">Technik / DevOps</option>
                      <option value="mc">Budowniczy Minecraft</option>
                    </select>
                 </div>
              </div>
              <div>
                 <label class="label">O mnie</label>
                 <textarea id="edit-about" class="input text-sm leading-relaxed" rows="4"></textarea>
              </div>
           </div>

           <div class="glass p-6 rounded-3xl border border-white/10 space-y-4">
              <label class="block text-xs font-bold uppercase tracking-widest text-white/50 mb-2">Szczeg√≥≈Çy wsp√≥≈Çpracy</label>
              <div class="grid md:grid-cols-3 gap-4">
                 <div>
                    <label class="label">Dostƒôpno≈õƒá</label>
                    <div class="relative">
                       <i data-lucide="clock" class="absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-[var(--accent)]"></i>
                       <select id="edit-availability" class="input pl-10">
                          <option value="24h">24h</option>
                          <option value="48h">48h</option>
                          <option value="72h">72h</option>
                          <option value="Tydzie≈Ñ">Tydzie≈Ñ</option>
                       </select>
                    </div>
                 </div>
                 <div>
                    <label class="label">Bud≈ºet Min. (PLN)</label>
                    <div class="relative">
                       <i data-lucide="banknote" class="absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-emerald-400"></i>
                       <input id="edit-budget" type="number" class="input pl-10" />
                    </div>
                 </div>
                 <div>
                    <label class="label">Tagi</label>
                    <input id="edit-tags" class="input" placeholder="React, Java..." />
                 </div>
              </div>
           </div>

           <div class="glass p-6 rounded-3xl border border-white/10 space-y-4">
              <label class="block text-xs font-bold uppercase tracking-widest text-white/50 mb-2">Portfolio (Linki do obrazk√≥w)</label>
              <div class="grid grid-cols-1 gap-3">
                 <input id="edit-portfolio-1" class="input" placeholder="URL 1..." />
                 <input id="edit-portfolio-2" class="input" placeholder="URL 2..." />
                 <input id="edit-portfolio-3" class="input" placeholder="URL 3..." />
              </div>
           </div>
           
           <div class="h-8"></div></section>

        <section id="tab-listing" class="hidden space-y-6 max-w-3xl mx-auto">
            <div class="glass p-8 rounded-[32px] border border-white/10 text-center relative overflow-hidden">
               <div class="absolute inset-0 bg-gradient-to-b from-[var(--accent)]/10 to-transparent pointer-events-none"></div>
               <div class="relative z-10">
                  <div class="inline-flex p-3 rounded-2xl bg-white/5 mb-4 shadow-xl">
                     <i data-lucide="megaphone" class="h-8 w-8 text-[var(--accent)]"></i>
                  </div>
                  <h3 class="text-2xl font-black mb-2">Twoja wizyt√≥wka</h3>
                  <p class="text-white/60 max-w-md mx-auto text-sm">To tutaj konfigurujesz to, co widzƒÖ klienci w g≈Ç√≥wnym katalogu. Zadbaj o chwytliwy tytu≈Ç.</p>
               </div>
            </div>

            <div class="glass p-6 rounded-3xl border border-white/10 space-y-5">
               <div>
                  <label class="label">Tytu≈Ç og≈Çoszenia</label>
                  <input id="listing-title" class="input text-lg font-bold" placeholder="np. Profesjonalne strony WWW" />
               </div>
               
               <div class="grid md:grid-cols-2 gap-4">
                  <div>
                     <label class="label">G≈Ç√≥wny kontakt</label>
                     <div class="relative">
                        <i data-lucide="message-circle" class="absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-white/50"></i>
                        <select id="listing-contact-main" class="input pl-10">
                           <option value="Discord">Discord</option>
                           <option value="E-mail">E-mail</option>
                           <option value="Instagram">Instagram</option>
                        </select>
                     </div>
                  </div>
               </div>

               <div>
                  <label class="label">Kr√≥tki opis (zajawka)</label>
                  <input id="listing-short" class="input" placeholder="Wy≈õwietla siƒô na karcie..." />
               </div>
               
               <div>
                  <label class="label">Pe≈Çna oferta</label>
                  <textarea id="listing-long" class="input min-h-[150px]" placeholder="Opisz swoje us≈Çugi..."></textarea>
               </div>

               <div class="pt-4 border-t border-white/10 flex items-center justify-between">
                  <div class="text-sm">
                     <div class="font-bold text-white">Status og≈Çoszenia</div>
                     <div class="text-xs text-white/50">Ukryj, je≈õli masz za du≈ºo zlece≈Ñ.</div>
                  </div>
                  <div class="flex gap-2">
                     <button id="btn-unpublish" class="btn btn-ghost border border-white/10 text-xs">Ukryj</button>
                     <button id="btn-publish" class="btn btn-primary text-xs shadow-lg shadow-[var(--accent)]/20">Opublikuj</button>
                  </div>
               </div>
            </div>
        </section>

        <section id="tab-shop" class="hidden space-y-6 max-w-4xl mx-auto">
           <div class="text-center mb-8">
              <h3 class="text-3xl font-black mb-2">Wyr√≥≈ºnij siƒô üî•</h3>
              <p class="text-white/60">Zwiƒôksz swoje zasiƒôgi nawet o 300% wybierajƒÖc jeden z pakiet√≥w.</p>
           </div>

           <div class="grid md:grid-cols-2 gap-6">
              <div class="glass p-1 rounded-[32px] relative group">
                 <div class="absolute inset-0 bg-gradient-to-br from-[var(--accent)] to-purple-600 rounded-[32px] opacity-20 blur-xl group-hover:opacity-40 transition-opacity"></div>
                 <div class="bg-[#0a0a1a] rounded-[28px] p-6 h-full relative flex flex-col border border-white/10">
                    <div class="mb-4">
                       <span class="badge badge-premium mb-3">Polecane</span>
                       <h4 class="text-2xl font-black">Premium</h4>
                       <div class="text-3xl font-bold mt-2">23.99 <span class="text-base font-medium text-white/50">PLN / mc</span></div>
                    </div>
                    <ul class="space-y-3 mb-8 flex-1">
                       <li class="flex items-center gap-3 text-sm"><i data-lucide="check" class="text-[var(--accent)] h-4 w-4"></i> Badge Premium</li>
                       <li class="flex items-center gap-3 text-sm"><i data-lucide="check" class="text-[var(--accent)] h-4 w-4"></i> 1. miejsce w wynikach</li>
                       <li class="flex items-center gap-3 text-sm"><i data-lucide="check" class="text-[var(--accent)] h-4 w-4"></i> ≈öwiecƒÖca ramka</li>
                    </ul>
                    <button id="btn-buy-premium" class="btn btn-primary w-full py-3 shadow-[0_4px_20px_rgba(255,3,84,0.3)]">Aktywuj teraz</button>
                    <button id="btn-cancel-premium" class="hidden btn btn-outline w-full py-3">Anuluj subskrypcjƒô</button>
                 </div>
              </div>

              <div class="glass p-1 rounded-[32px] relative group">
                 <div class="bg-[#0a0a1a] rounded-[28px] p-6 h-full relative flex flex-col border border-white/10">
                    <div class="mb-4">
                       <span class="badge badge-verified mb-3">Zaufanie</span>
                       <h4 class="text-2xl font-black">Verified</h4>
                       <div class="text-3xl font-bold mt-2">19.55 <span class="text-base font-medium text-white/50">PLN / mc</span></div>
                    </div>
                    <ul class="space-y-3 mb-8 flex-1">
                       <li class="flex items-center gap-3 text-sm"><i data-lucide="check" class="text-purple-400 h-4 w-4"></i> Badge Zweryfikowany</li>
                       <li class="flex items-center gap-3 text-sm"><i data-lucide="check" class="text-purple-400 h-4 w-4"></i> Wiƒôksze zaufanie</li>
                    </ul>
                    <button id="btn-buy-verified" class="btn btn-ghost border border-white/20 w-full py-3 hover:bg-white/5">Aktywuj</button>
                     <button id="btn-cancel-verified" class="hidden btn btn-outline w-full py-3">Anuluj subskrypcjƒô</button>
                 </div>
              </div>
           </div>
        </section>

        <section id="tab-settings" class="hidden space-y-6 max-w-2xl mx-auto">
           <h3 class="text-xl font-black mb-4">Ustawienia aplikacji</h3>
           
           <div class="glass rounded-3xl overflow-hidden border border-white/10">
              <div class="p-4 flex items-center justify-between border-b border-white/5 hover:bg-white/[0.02]">
                 <div>
                    <div class="font-bold text-sm">Powiadomienia (Toasty)</div>
                    <div class="text-xs text-white/50">Komunikaty o akcjach w rogu ekranu.</div>
                 </div>
                 <div>
                    <input type="checkbox" id="set-toast" class="toggle-checkbox" />
                    <label for="set-toast" class="toggle-label"></label>
                 </div>
              </div>

              <div class="p-4 flex items-center justify-between border-b border-white/5 hover:bg-white/[0.02]">
                 <div>
                    <div class="font-bold text-sm">Skr√≥t klawiszowy "/"</div>
                    <div class="text-xs text-white/50">Szybkie przej≈õcie do wyszukiwarki.</div>
                 </div>
                 <div>
                    <input type="checkbox" id="set-slash" class="toggle-checkbox" />
                    <label for="set-slash" class="toggle-label"></label>
                 </div>
              </div>
              
              <div class="p-4 flex items-center justify-between border-b border-white/5 hover:bg-white/[0.02]">
                 <div>
                    <div class="font-bold text-sm">Ukryj ceny</div>
                    <div class="text-xs text-white/50">Nie pokazuj mojego bud≈ºetu "od".</div>
                 </div>
                 <div>
                    <input type="checkbox" id="set-hide-budget" class="toggle-checkbox" />
                    <label for="set-hide-budget" class="toggle-label"></label>
                 </div>
              </div>

              <div class="p-4 bg-red-500/5 flex items-center justify-between">
                 <div>
                    <div class="font-bold text-sm text-red-200">Resetuj ustawienia</div>
                 </div>
                 <button id="btn-reset-settings" class="text-xs text-red-400 font-bold hover:underline">Wykonaj</button>
              </div>
           </div>
        </section>

      </main>
    </div>
  </aside>

  <script>
    /***********************************************************************
     * Velorie Market ‚Äî market.html (UX upgrade v3.0 - Dashboard)
     ***********************************************************************/

    (function(){
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

      const now = () => Date.now();

      function safeParse(v, fallback){
        try { return JSON.parse(v); } catch { return fallback; }
      }
      function safeStringify(v, fallback="{}"){
        try { return JSON.stringify(v); } catch { return fallback; }
      }
      function escapeHTML(str){
        return String(str ?? "")
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }
      function normalizeText(s){
        return String(s||"")
          .toLowerCase()
          .normalize("NFD")
          .replace(/\p{Diacritic}/gu,"");
      }
      function debounce(fn, delay=250){
        let t=null;
        return (...args)=>{
          clearTimeout(t);
          t=setTimeout(()=>fn(...args), delay);
        };
      }

      // --- JWT decode ---
      function decodeJwt(token){
        try { return JSON.parse(atob(token.split('.')[1])); }
        catch { return null; }
      }

      /* ---------------------- Header height ---------------------- */
      function bindHeaderHeightVar(){
        const header = $("#app-header");
        if(!header) return;
        const set = () => {
          const h = Math.round(header.getBoundingClientRect().height || 66);
          document.documentElement.style.setProperty("--header-h", h + "px");
        };
        set();
        window.addEventListener("resize", set, {passive:true});
      }

      /* ---------------------- Toasts ---------------------- */
      const Toast = (() => {
        let wrap=null;
        let queue=[];
        let showing=false;

        function ensure(){
          if(wrap) return wrap;
          wrap=document.createElement("div");
          wrap.id="toast-wrap";
          wrap.className="fixed bottom-5 left-1/2 -translate-x-1/2 z-[220] space-y-2";
          document.body.appendChild(wrap);
          return wrap;
        }
        function showNext(){
          if(showing) return;
          const item=queue.shift();
          if(!item) return;
          showing=true;
          ensure();

          const el=document.createElement("div");
          el.className="glass rounded-2xl px-4 py-3 text-sm text-white/90 border border-white/10 shadow-glow max-w-[92vw] flex items-center gap-2";
          el.innerHTML=`
            <span class="inline-flex items-center justify-center w-7 h-7 rounded-xl bg-white/5 border border-white/10">
              <i data-lucide="${item.icon||"sparkles"}" class="h-4 w-4 text-[var(--accent)]"></i>
            </span>
            <span>${escapeHTML(item.message)}</span>
          `;
          wrap.appendChild(el);
          try{ lucide.createIcons(); }catch{}

          setTimeout(()=>{
            el.style.opacity="0";
            el.style.transform="translateY(6px)";
            el.style.transition="opacity .25s ease, transform .25s ease";
            setTimeout(()=>{
              el.remove();
              showing=false;
              showNext();
            }, 260);
          }, item.ms||1700);
        }
        return {
          push(message, icon="sparkles", ms=1700){
            queue.push({message, icon, ms});
            showNext();
          }
        };
      })();

      /* ---------------------- Storage ---------------------- */
      const LS = {
        keyProfiles: "vm_profiles_v2",
        keySaved: "vm_saved_v2",
        keySubs: "vm_subs_v2",
        keyMe: "vm_me_v2",
        keySettings: "vm_settings_v2",

        getProfiles(){ return safeParse(localStorage.getItem(this.keyProfiles), null); },
        setProfiles(list){ localStorage.setItem(this.keyProfiles, safeStringify(list,"[]")); },

        getSaved(){ return new Set(safeParse(localStorage.getItem(this.keySaved), [])); },
        setSaved(setOrArr){
          const arr = Array.isArray(setOrArr) ? setOrArr : Array.from(setOrArr);
          localStorage.setItem(this.keySaved, safeStringify(arr,"[]"));
        },

        getSubs(){ return safeParse(localStorage.getItem(this.keySubs), {premium:false, verified:false}); },
        setSubs(obj){ localStorage.setItem(this.keySubs, safeStringify(obj,"{}")); },

        getMe(){ return safeParse(localStorage.getItem(this.keyMe), null); },
        setMe(obj){ localStorage.setItem(this.keyMe, safeStringify(obj,"{}")); },

        getSettings(){ return safeParse(localStorage.getItem(this.keySettings), {toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true}); },
        setSettings(obj){ localStorage.setItem(this.keySettings, safeStringify(obj,"{}")); },
      };

      const notify = (msg, icon="sparkles", ms=1700)=>{
        const s=LS.getSettings();
        if(s.toast) Toast.push(msg, icon, ms);
      };

      /* ---------------------- Seed Data ---------------------- */
      const FALLBACK_PROFILES = [
        {
          id:"p1", name:"zxq0", industry:"dev", industryLabel:"Programista",
          tagline:"React ‚Ä¢ Node ‚Ä¢ API ‚Ä¢ Automatyzacje",
          about:"Budujƒô szybkie MVP, integracje i automatyzacje. Dzia≈Çam konkretnie: zakres ‚Üí prototyp ‚Üí wdro≈ºenie.\n\nPreferujƒô: React, Node, API, deployment, dashboardy.",
          rating:4.9, availableIn:"48h", minBudget:300, location:"Online", premium:true, verified:true,
          avatar:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*10
        },
        {
          id:"p2", name:"Klaudia", industry:"gfx", industryLabel:"Grafik",
          tagline:"Branding ‚Ä¢ UI ‚Ä¢ Miniatury ‚Ä¢ Packi",
          about:"Robiƒô branding, UI i grafiki pod social. Lubiƒô mocny kontrast i clean systemy.\n\nDostarczam pliki + guideline (opcjonalnie).",
          rating:4.7, availableIn:"24h", minBudget:200, location:"Online", premium:true, verified:false,
          avatar:"https://images.unsplash.com/photo-1548142813-c348350df52b?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*4
        },
        {
          id:"p3", name:"kubus", industry:"tech", industryLabel:"Technik / DevOps",
          tagline:"Linux ‚Ä¢ Proxy ‚Ä¢ Security ‚Ä¢ Optymalizacja",
          about:"Pomagam z serwerami, bezpiecze≈Ñstwem i optymalizacjƒÖ. Ustawiam proxy, monitoring, backupy.\n\nW cenie: checklist + rekomendacje.",
          rating:4.8, availableIn:"72h", minBudget:250, location:"Online", premium:false, verified:true,
          avatar:"https://images.unsplash.com/photo-1603415526960-f7e0328b7cf6?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1531297484001-80022131f5a1?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*7
        },
        {
          id:"p4", name:"A.I.", industry:"video", industryLabel:"Monta≈ºysta / Content",
          tagline:"Monta≈º ‚Ä¢ Shortsy ‚Ä¢ Motion ‚Ä¢ TikTok",
          about:"Monta≈º short√≥w, reels i d≈Çugich form. Dostarczam szybkie iteracje + wersje A/B.\n\nWorkflow: brief ‚Üí draft ‚Üí poprawki ‚Üí final.",
          rating:4.6, availableIn:"48h", minBudget:300, location:"Online", premium:false, verified:false,
          avatar:"https://images.unsplash.com/photo-1520975682038-1c5d5cfc20a1?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*2
        }
      ];

      function ensureInit(){
        if(!LS.getProfiles()) LS.setProfiles(FALLBACK_PROFILES);

        if(!LS.getMe()){
          LS.setMe({
            id:"me", name:"zxq0", industry:"dev", about:"Tworzƒô produkty web, automatyzacje i integracje. Dzia≈Çam szybko i konkretnie.",
            availability:"48h", minBudget:300, tags:["React","Node","API","Automatyzacje"],
            avatar:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
            portfolio:["","",""],
            listing:{
              title:"Programista React/Node ‚Äî szybkie MVP", contactMain:"Discord",
              short:"Budujƒô MVP, dashboardy i integracje. Szybkie iteracje i konkretne wdro≈ºenia.",
              long:"Zakres ‚Üí prototyp ‚Üí wdro≈ºenie. Integracje API, panele, automatyzacje, deployment.\n\nUstalamy cele i deadline, pracujƒô iteracyjnie.",
              published:true
            }
          });
        }
        if(!localStorage.getItem(LS.keySaved)) LS.setSaved([]);
        if(!localStorage.getItem(LS.keySubs)) LS.setSubs({premium:false, verified:false});
        if(!localStorage.getItem(LS.keySettings)) LS.setSettings({toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true});
      }

      /* ---------------------- State ---------------------- */
      const state = {
        q:"", industry:"all", premiumOnly:false, verifiedOnly:false, availableOnly:false, savedOnly:false,
        sort:"recommended", budgetMin:null, budgetMax:null, pageSize:4, shown:0,
        modalOpen:false, modalList:[], modalIndex:-1, lastFocus:null
      };

      function parseAvailableHours(str){
        const s=String(str||"").toLowerCase();
        if(s.includes("tydz")) return 168;
        const m=s.match(/(\d+)\s*h/);
        return m ? Number(m[1]) : 9999;
      }
      function scoreRecommended(p){
        const premium = p.premium ? 1 : 0;
        const verified = p.verified ? 1 : 0;
        const rating = Number(p.rating||0);
        const recency = typeof p.createdAt==="number" ? p.createdAt : 0;
        return premium*4 + verified*2.2 + rating*1.2 + recency/1e12;
      }

      /* ---------------------- UI helpers ---------------------- */
      function setOverlay(open){
        const ov=$("#overlay");
        if(!ov) return;
        ov.dataset.open=open?"true":"false";
        ov.setAttribute("aria-hidden", open?"false":"true");
      }
      function lockBody(lock){
        document.body.style.overflow = lock ? "hidden" : "";
      }
      function setPanelOpen(open){
        const panel=$("#user-panel");
        if(!panel) return;
        panel.dataset.open=open?"true":"false";
        const any = open || state.modalOpen;
        setOverlay(any);
        lockBody(any);
        if(open){
          const btn=panel.querySelector('[data-tab]');
          setTimeout(()=>btn?.focus(),0);
        }
      }
      function setModalOpen(open){
        const modal=$("#profile-modal");
        if(!modal) return;
        modal.dataset.open=open?"true":"false";
        state.modalOpen=open;
        const any = open || ($("#user-panel")?.dataset.open==="true");
        setOverlay(any);
        lockBody(any);

        if(open){
          if(LS.getSettings().focusTrap) installFocusTrap(modal);
          setTimeout(()=>$("#modal-close")?.focus(),0);
        }else{
          uninstallFocusTrap(modal);
          if(state.lastFocus) setTimeout(()=>state.lastFocus.focus?.(),0);
        }
      }

      /* ---------------------- Focus trap ---------------------- */
      const focusTrapState = new WeakMap();
      function getFocusable(root){
        const sel = [
          "a[href]", "button:not([disabled])", "textarea:not([disabled])", "input:not([disabled])", "select:not([disabled])", "[tabindex]:not([tabindex='-1'])"
        ].join(",");
        return $$(sel, root).filter(el=>!!(el.offsetWidth||el.offsetHeight||el.getClientRects().length));
      }
      function installFocusTrap(modal){
        if(focusTrapState.has(modal)) return;
        const onKeydown=(e)=>{
          if(e.key!=="Tab") return;
          const f=getFocusable(modal);
          if(!f.length) return;
          const first=f[0];
          const last=f[f.length-1];
          if(e.shiftKey){
            if(document.activeElement===first){ e.preventDefault(); last.focus(); }
          }else{
            if(document.activeElement===last){ e.preventDefault(); first.focus(); }
          }
        };
        modal.addEventListener("keydown", onKeydown);
        focusTrapState.set(modal, {onKeydown});
      }
      function uninstallFocusTrap(modal){
        const s=focusTrapState.get(modal);
        if(!s) return;
        modal.removeEventListener("keydown", s.onKeydown);
        focusTrapState.delete(modal);
      }

      /* ---------------------- Scroll progress ---------------------- */
      function initProgress(){
        const bar=$("#scroll-progress");
        if(!bar) return;
        let ticking=false;
        const onScroll=()=>{
          if(ticking) return;
          ticking=true;
          requestAnimationFrame(()=>{
            const doc=document.documentElement;
            const max=doc.scrollHeight - doc.clientHeight;
            const p=max<=0 ? 0 : (doc.scrollTop/max)*100;
            bar.style.width = p+"%";
            ticking=false;
          });
        };
        window.addEventListener("scroll", onScroll, {passive:true});
        onScroll();
      }

      /* ---------------------- Reveal observer ---------------------- */
      function initReveal(){
        const els=$$(".reveal");
        if(!els.length) return;
        const io=new IntersectionObserver((entries)=>{
          entries.forEach(e=>{
            if(e.isIntersecting) e.target.classList.add("is-visible");
          });
        },{threshold:0.12});
        els.forEach(el=>io.observe(el));
      }

      /* ---------------------- Particles ---------------------- */
      function createParticles(){
        const container = document.getElementById("particles-container");
        if(!container) return;
        const particleCount = 28;
        for(let i=0;i<particleCount;i++){
          const particle = document.createElement("span");
          const size = 24 + (i % 5) * 12;
          particle.className = "absolute rounded-full opacity-20 blur-2xl particle";
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.background = (i % 3) ? "var(--accent)" : "#4f46e5";
          particle.style.left = `${Math.random() * 100}%`;
          particle.style.top = `${Math.random() * 100}%`;
          particle.style.animationDuration = `${10 + (i % 5)}s`;
          particle.style.animationDelay = `${i * 0.2}s`;
          container.appendChild(particle);
        }
      }

      /* ---------------------- Data access ---------------------- */
      function industryLabel(code){
        switch(code){
          case "dev": return "Programista";
          case "gfx": return "Grafik";
          case "video": return "Monta≈ºysta / Content";
          case "tech": return "Technik / DevOps";
          case "mc": return "Budowniczy Minecraft";
          default: return "Freelancer";
        }
      }

      function getAllProfiles(){
        const profiles = LS.getProfiles() || [];
        const me = LS.getMe();
        const subs = LS.getSubs();

        let list = profiles.slice();
        if(me && me.listing?.published){
          const meProfile = {
            id: me.id || "me",
            name: me.name || "Me",
            industry: me.industry || "dev",
            industryLabel: industryLabel(me.industry || "dev"),
            tagline: me.listing?.title || "Og≈Çoszenie",
            about: me.listing?.long || me.about || "",
            rating: 4.9,
            availableIn: me.availability || "48h",
            minBudget: Number(me.minBudget || 0) || 0,
            location: "Online",
            premium: !!subs.premium,
            verified: !!subs.verified,
            avatar: me.avatar || "",
            portfolio: (me.portfolio || ["","",""]).filter(Boolean).length ? me.portfolio : [
              "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
              "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
              "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
            ],
            createdAt: now() - 1000*60*60*24*1
          };
          list = list.filter(p=>p.id!==meProfile.id);
          list.unshift(meProfile);
        }
        return list;
      }

      function matchesBudget(p){
        const min = state.budgetMin;
        const max = state.budgetMax;
        const b = Number(p.minBudget || 0) || 0;
        if(min != null && b < min) return false;
        if(max != null && b > max) return false;
        return true;
      }

      function matchesSearch(p){
        const q = normalizeText(state.q).trim();
        if(!q) return true;
        const hay = normalizeText([p.name, p.tagline, p.industryLabel, p.about].filter(Boolean).join(" "));
        return hay.includes(q);
      }

      function getFilteredProfiles(){
        const all = getAllProfiles();
        const savedSet = LS.getSaved();
        let list = all.filter(p=>{
          if(state.industry !== "all" && p.industry !== state.industry) return false;
          if(state.premiumOnly && !p.premium) return false;
          if(state.verifiedOnly && !p.verified) return false;
          if(state.availableOnly && parseAvailableHours(p.availableIn) > 72) return false;
          if(state.savedOnly && !savedSet.has(p.id)) return false;
          if(!matchesBudget(p)) return false;
          if(!matchesSearch(p)) return false;
          return true;
        });

        if(state.sort === "newest"){
          list.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
        }else if(state.sort === "rating"){
          list.sort((a,b)=>(Number(b.rating||0)-Number(a.rating||0)));
        }else if(state.sort === "verified"){
          list.sort((a,b)=>{
            const av = a.verified?1:0, bv=b.verified?1:0;
            if(bv!==av) return bv-av;
            return scoreRecommended(b)-scoreRecommended(a);
          });
        }else{
          list.sort((a,b)=>scoreRecommended(b)-scoreRecommended(a));
        }

        return list;
      }

      /* ---------------------- Rendering ---------------------- */
      function formatMoney(n){
        const v = Number(n||0);
        if(!Number.isFinite(v) || v<=0) return "";
        return `${v} PLN`;
      }

      function isSaved(id){
        return LS.getSaved().has(id);
      }

      function profileCardHTML(p){
        const settings = LS.getSettings();
        const saved = isSaved(p.id);

        const tagsLine = [];
        if(!settings.hideRating) tagsLine.push(`<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${escapeHTML(String(p.rating ?? "‚Äî"))}</span>`);
        tagsLine.push(`<span class="chip"><i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.availableIn||"‚Äî")}</span>`);
        tagsLine.push(`<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.location||"Online")}</span>`);
        if(!settings.hideBudget && p.minBudget){
          tagsLine.push(`<span class="chip"><i data-lucide="banknote" class="h-3.5 w-3.5 text-[var(--accent)]"></i> od ${escapeHTML(formatMoney(p.minBudget))}</span>`);
        }

        const badges = [
          p.verified ? `<span class="badge badge-verified"><i data-lucide="badge-check" class="h-3.5 w-3.5"></i> Verified</span>` : "",
          p.premium ? `<span class="badge badge-premium"><i data-lucide="zap" class="h-3.5 w-3.5"></i> Premium</span>` : ""
        ].join("");

        const portfolio = (p.portfolio||[]).slice(0,3);
        const thumbs = portfolio.map((src,i)=>`
          <div class="thumb aspect-[16/10]">
            <img src="${escapeHTML(src)}" alt="Portfolio ${i+1}" loading="lazy" />
          </div>
        `).join("");

        const cardClass = p.premium ? "profile-card profile-card-premium" : "profile-card";

        return `
          <article class="${cardClass} p-4 md:p-5">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div class="flex items-center gap-3 min-w-0">
                <div class="avatar">
                  <img src="${escapeHTML(p.avatar||"")}" alt="${escapeHTML(p.name)}" loading="lazy" />
                </div>
                <div class="min-w-0">
                  <div class="flex items-center gap-2 flex-wrap">
                    <div class="text-lg font-black tracking-tight truncate">${escapeHTML(p.name)}</div>
                    ${badges ? `<div class="flex items-center gap-2">${badges}</div>` : ""}
                  </div>
                  <div class="text-sm text-white/70 truncate">${escapeHTML(p.tagline||"")}</div>
                  <div class="text-xs text-white/55 mt-1">${escapeHTML(p.industryLabel||industryLabel(p.industry))}</div>
                </div>
              </div>

              <div class="flex items-center gap-2 md:justify-end">
                <button class="btn btn-ghost px-3 py-2 text-sm" type="button" data-action="save" data-id="${escapeHTML(p.id)}" aria-pressed="${saved ? "true":"false"}">
                  <i data-lucide="bookmark" class="h-4 w-4"></i>
                  <span>${saved ? "Zapisano":"Zapisz"}</span>
                </button>
                <button class="btn btn-outline px-3 py-2 text-sm" type="button" data-action="open" data-id="${escapeHTML(p.id)}">
                  <i data-lucide="external-link" class="h-4 w-4"></i>
                  <span>Otw√≥rz</span>
                </button>
              </div>
            </div>

            <div class="mt-4 flex flex-wrap gap-2">
              ${tagsLine.join("")}
            </div>

            <div class="mt-4 grid grid-cols-3 gap-2">
              ${thumbs || `<div class="col-span-3 text-sm text-white/55">Brak portfolio</div>`}
            </div>
          </article>
        `;
      }

      function updateStats(list){
        const savedCount = LS.getSaved().size;
        $("#stat-saved").textContent = String(savedCount);
        $("#stat-results").textContent = String(list.length);
        $("#stat-filters").textContent = String(countActiveFilters());
        $("#results-hint").textContent = list.length ? `Znaleziono: ${list.length}` : "Brak wynik√≥w";

        $("#total-count").textContent = String(list.length);
        $("#shown-count").textContent = String(Math.min(state.shown, list.length));

        $("#saved-pill").textContent = String(savedCount);
        $("#saved-pill-m").textContent = String(savedCount);
        $("#m-saved-count").textContent = String(savedCount);
      }

      function sortLabel(v){
        switch(v){
          case "newest": return "Najnowsze";
          case "rating": return "Ocena";
          case "verified": return "Zweryfikowani";
          default: return "Polecane";
        }
      }

      function countActiveFilters(){
        let c=0;
        if(state.q.trim()) c++;
        if(state.industry!=="all") c++;
        if(state.sort!=="recommended") c++;
        if(state.savedOnly) c++;
        if(state.premiumOnly) c++;
        if(state.verifiedOnly) c++;
        if(state.availableOnly) c++;
        if(state.budgetMin!=null) c++;
        if(state.budgetMax!=null) c++;
        return c;
      }

      function renderActiveFilters(){
        const wrap=$("#active-filters");
        if(!wrap) return;

        const pills=[];
        const addPill=(key,label)=>{
          pills.push(`
            <span class="pill" data-key="${escapeHTML(key)}">
              ${escapeHTML(label)}
              <button type="button" aria-label="Usu≈Ñ filtr" data-action="remove-pill" data-key="${escapeHTML(key)}">
                <i data-lucide="x" class="h-3.5 w-3.5"></i>
              </button>
            </span>
          `);
        };

        if(state.q.trim()) addPill("q", `Szukaj: ${state.q.trim().slice(0,18)}${state.q.trim().length>18?"‚Ä¶":""}`);
        if(state.industry!=="all") addPill("industry", `Bran≈ºa: ${industryLabel(state.industry)}`);
        if(state.sort!=="recommended") addPill("sort", `Sort: ${sortLabel(state.sort)}`);
        if(state.savedOnly) addPill("saved", "Zapisane");
        if(state.premiumOnly) addPill("premium", "Premium");
        if(state.verifiedOnly) addPill("verified", "Verified");
        if(state.availableOnly) addPill("avail", "‚â§72h");
        if(state.budgetMin!=null) addPill("bmin", `Bud≈ºet ‚â• ${state.budgetMin}`);
        if(state.budgetMax!=null) addPill("bmax", `Bud≈ºet ‚â§ ${state.budgetMax}`);

        wrap.innerHTML = pills.join("");
        wrap.classList.toggle("hidden", pills.length===0);
      }

      function renderList(resetShown=true){
        const list = getFilteredProfiles();
        if(resetShown){
          state.shown = Math.min(state.pageSize, list.length);
        }

        updateStats(list);
        renderActiveFilters();

        const container=$("#profiles-list");
        if(!container) return;

        if(!list.length){
          container.innerHTML = `
            <div class="glass rounded-[26px] p-6 text-white/70">
              <div class="flex items-start gap-3">
                <i data-lucide="search-x" class="h-5 w-5 text-[var(--accent)] mt-0.5"></i>
                <div>
                  <div class="font-black text-white">Brak wynik√≥w</div>
                  <div class="text-sm text-white/65 mt-1">Spr√≥buj zmieniƒá filtry lub wyczy≈õciƒá wyszukiwanie.</div>
                  <button id="btn-empty-reset" class="mt-4 btn btn-outline px-4 py-3" type="button">
                    <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                    Wyczy≈õƒá filtry
                  </button>
                </div>
              </div>
            </div>
          `;
          $("#btn-load-more").disabled = true;
          $("#btn-load-more").classList.add("opacity-50","pointer-events-none");
          try{ lucide.createIcons(); }catch{}
          $("#btn-empty-reset")?.addEventListener("click", resetFilters);
          return;
        }

        const shownList = list.slice(0, state.shown);
        container.innerHTML = shownList.map(profileCardHTML).join("");

        const canMore = state.shown < list.length;
        $("#btn-load-more").disabled = !canMore;
        $("#btn-load-more").classList.toggle("opacity-50", !canMore);
        $("#btn-load-more").classList.toggle("pointer-events-none", !canMore);

        $$("#profiles-list [data-action='open']").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const id=btn.getAttribute("data-id");
            openProfileModalById(id, getFilteredProfiles());
          });
        });
        $$("#profiles-list [data-action='save']").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const id=btn.getAttribute("data-id");
            toggleSaved(id);
            renderList(false);
          });
        });

        try{ lucide.createIcons(); }catch{}
      }

      /* ---------------------- Saved ---------------------- */
      function toggleSaved(id){
        const set = LS.getSaved();
        if(set.has(id)){
          set.delete(id);
          LS.setSaved(set);
          notify("Usuniƒôto z zapisanych", "bookmark-x");
        }else{
          set.add(id);
          LS.setSaved(set);
          notify("Zapisano profil", "bookmark");
        }
      }

      /* ---------------------- Modal ---------------------- */
      function setModalContent(p){
        $("#modal-avatar").src = p.avatar || "";
        $("#modal-name").textContent = p.name || "Profil";
        const badges=[];
        if(p.verified) badges.push(`<span class="badge badge-verified"><i data-lucide="badge-check" class="h-3.5 w-3.5"></i> Verified</span>`);
        if(p.premium) badges.push(`<span class="badge badge-premium"><i data-lucide="zap" class="h-3.5 w-3.5"></i> Premium</span>`);
        $("#modal-badges").innerHTML = badges.join("");

        const sub = `${p.industryLabel || industryLabel(p.industry)} ‚Ä¢ ${p.location||"Online"} ‚Ä¢ ${p.availableIn||"‚Äî"}${p.minBudget?` ‚Ä¢ od ${formatMoney(p.minBudget)}`:""}`;
        $("#modal-sub").textContent = sub;

        const chips=[];
        if(!LS.getSettings().hideRating) chips.push(`<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${escapeHTML(String(p.rating ?? "‚Äî"))}</span>`);
        chips.push(`<span class="chip"><i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.availableIn||"‚Äî")}</span>`);
        chips.push(`<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.location||"Online")}</span>`);
        if(!LS.getSettings().hideBudget && p.minBudget) chips.push(`<span class="chip"><i data-lucide="banknote" class="h-3.5 w-3.5 text-[var(--accent)]"></i> od ${escapeHTML(formatMoney(p.minBudget))}</span>`);
        $("#modal-chips").innerHTML = chips.join("");

        const portfolio=(p.portfolio||[]).slice(0,3);
        $("#modal-portfolio").innerHTML = portfolio.map((src,i)=>`
          <div class="thumb aspect-[16/10]">
            <img src="${escapeHTML(src)}" alt="Portfolio ${i+1}" />
          </div>
        `).join("");

        $("#modal-about").textContent = p.about || "";

        const saved=isSaved(p.id);
        const b=$("#btn-save-from-modal");
        b.innerHTML = `<i data-lucide="bookmark" class="h-4 w-4"></i> ${saved ? "Zapisano" : "Zapisz"}`;
        b.setAttribute("aria-pressed", saved ? "true" : "false");

        try{ lucide.createIcons(); }catch{}
      }

      function openProfileModalById(id, listForModal){
        const fullList = listForModal && listForModal.length ? listForModal : getFilteredProfiles();
        state.modalList = fullList;
        const idx = fullList.findIndex(p=>p.id===id);
        state.modalIndex = idx >= 0 ? idx : 0;
        const p = fullList[state.modalIndex];
        if(!p) return;

        state.lastFocus = document.activeElement;
        setModalContent(p);
        setModalOpen(true);

        const url = new URL(window.location.href);
        url.hash = `profile=${encodeURIComponent(p.id)}`;
        history.replaceState(null, "", url.toString());
      }

      function closeProfileModal(){
        const url = new URL(window.location.href);
        url.hash = "katalog";
        history.replaceState(null, "", url.toString());
        setModalOpen(false);
      }

      function modalGo(delta){
        if(!state.modalOpen) return;
        const list=state.modalList || [];
        if(!list.length) return;
        state.modalIndex = (state.modalIndex + delta + list.length) % list.length;
        const p=list[state.modalIndex];
        setModalContent(p);

        const url = new URL(window.location.href);
        url.hash = `profile=${encodeURIComponent(p.id)}`;
        history.replaceState(null, "", url.toString());
      }

      function tryOpenFromHash(){
        const h = window.location.hash || "";
        if(!h.startsWith("#profile=")) return false;
        const id = decodeURIComponent(h.replace("#profile=",""));
        const list = getFilteredProfiles();
        const found = list.find(p=>p.id===id) || getAllProfiles().find(p=>p.id===id);
        if(found){
          openProfileModalById(found.id, list);
          return true;
        }
        return false;
      }

      /* ---------------------- Filters bindings ---------------------- */
      function syncFilterUI(){
        $("#search-input").value = state.q;
        $("#industry-select").value = state.industry;
        $("#sort-select").value = state.sort;
        $("#budget-min").value = state.budgetMin ?? "";
        $("#budget-max").value = state.budgetMax ?? "";

        const setChip = (id, on)=>{
          const el=$(id);
          if(!el) return;
          el.dataset.active = on ? "true" : "false";
          el.setAttribute("aria-pressed", on ? "true":"false");
        };
        setChip("#filter-saved", state.savedOnly);
        setChip("#filter-premium", state.premiumOnly);
        setChip("#filter-verified", state.verifiedOnly);
        setChip("#filter-available", state.availableOnly);
      }

      function resetFilters(){
        state.q=""; state.industry="all"; state.sort="recommended";
        state.savedOnly=false; state.premiumOnly=false; state.verifiedOnly=false; state.availableOnly=false;
        state.budgetMin=null; state.budgetMax=null;
        syncFilterUI();
        renderList(true);
        notify("Wyczyszczono filtry", "rotate-ccw");
      }

      function bindFilters(){
        const onSearch = debounce((e)=>{
          state.q = e.target.value || "";
          renderList(true);
        }, 180);

        $("#search-input")?.addEventListener("input", onSearch);

        $("#industry-select")?.addEventListener("change",(e)=>{
          state.industry = e.target.value;
          renderList(true);
        });

        $("#sort-select")?.addEventListener("change",(e)=>{
          state.sort = e.target.value;
          renderList(true);
        });

        $("#filter-saved")?.addEventListener("click", ()=>{
          state.savedOnly = !state.savedOnly; syncFilterUI(); renderList(true);
        });
        $("#filter-premium")?.addEventListener("click", ()=>{
          state.premiumOnly = !state.premiumOnly; syncFilterUI(); renderList(true);
        });
        $("#filter-verified")?.addEventListener("click", ()=>{
          state.verifiedOnly = !state.verifiedOnly; syncFilterUI(); renderList(true);
        });
        $("#filter-available")?.addEventListener("click", ()=>{
          state.availableOnly = !state.availableOnly; syncFilterUI(); renderList(true);
        });

        $("#budget-min")?.addEventListener("input", debounce((e)=>{
          const v = e.target.value.trim();
          state.budgetMin = v==="" ? null : Math.max(0, Number(v));
          renderList(true);
        }, 150));

        $("#budget-max")?.addEventListener("input", debounce((e)=>{
          const v = e.target.value.trim();
          state.budgetMax = v==="" ? null : Math.max(0, Number(v));
          renderList(true);
        }, 150));

        $$("[data-budget-preset]").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const v = Number(btn.getAttribute("data-budget-preset")||"0");
            if(v<=0){
              state.budgetMax = null; $("#budget-max").value = "";
            }else{
              state.budgetMax = v; $("#budget-max").value = String(v);
            }
            renderList(true);
          });
        });

        $("#btn-reset-filters")?.addEventListener("click", resetFilters);

        $("#active-filters")?.addEventListener("click", (e)=>{
          const t=e.target.closest("[data-action='remove-pill']");
          if(!t) return;
          const key = t.getAttribute("data-key");
          if(!key) return;
          switch(key){
            case "q": state.q=""; break;
            case "industry": state.industry="all"; break;
            case "sort": state.sort="recommended"; break;
            case "saved": state.savedOnly=false; break;
            case "premium": state.premiumOnly=false; break;
            case "verified": state.verifiedOnly=false; break;
            case "avail": state.availableOnly=false; break;
            case "bmin": state.budgetMin=null; break;
            case "bmax": state.budgetMax=null; break;
          }
          syncFilterUI();
          renderList(true);
        });

        $("#btn-load-more")?.addEventListener("click", ()=>{
          const list=getFilteredProfiles();
          state.shown = Math.min(state.shown + state.pageSize, list.length);
          renderList(false);
        });
      }

      /* ---------------------- Header / Mobile binds ---------------------- */
      function bindHeader(){
        const focusSearch = ()=>{
          $("#search-input")?.scrollIntoView({behavior:"smooth", block:"center"});
          setTimeout(()=>$("#search-input")?.focus(), 120);
        };

        $("#btn-jump-search")?.addEventListener("click", focusSearch);
        $("#m-search")?.addEventListener("click", focusSearch);

        const toggleSavedFilter = ()=>{
          state.savedOnly = !state.savedOnly;
          syncFilterUI();
          renderList(true);
          notify(state.savedOnly ? "Pokazujƒô zapisane" : "Wy≈ÇƒÖczono filtr zapisane", "bookmark");
        };

        $("#btn-open-saved")?.addEventListener("click", toggleSavedFilter);
        $("#btn-open-saved-m")?.addEventListener("click", toggleSavedFilter);
        $("#m-saved")?.addEventListener("click", toggleSavedFilter);

        const openPanel=()=>setPanelOpen(true);
        $("#btn-open-panel")?.addEventListener("click", openPanel);
        $("#btn-open-panel-m")?.addEventListener("click", openPanel);
        $("#btn-open-panel-inline")?.addEventListener("click", openPanel);
        $("#m-account")?.addEventListener("click", openPanel);

        $("#btn-close-panel")?.addEventListener("click", ()=>setPanelOpen(false));

        $("#overlay")?.addEventListener("click", ()=>{
          if(state.modalOpen) closeProfileModal();
          else if($("#user-panel")?.dataset.open==="true") setPanelOpen(false);
        });

        document.addEventListener("keydown", (e)=>{
          if(e.key==="Escape"){
            if(state.modalOpen) closeProfileModal();
            else if($("#user-panel")?.dataset.open==="true") setPanelOpen(false);
          }

          const s=LS.getSettings();
          if(s.slash && e.key==="/" && !e.ctrlKey && !e.metaKey && !e.altKey){
            const tag = (document.activeElement?.tagName || "").toLowerCase();
            const isTyping = tag==="input" || tag==="textarea" || tag==="select";
            if(!isTyping){
              e.preventDefault();
              $("#search-input")?.focus();
            }
          }

          if(state.modalOpen){
            if(e.key==="ArrowLeft") modalGo(-1);
            if(e.key==="ArrowRight") modalGo(1);
          }
        }, {passive:false});
      }

      /* ---------------------- Modal binds ---------------------- */
      function bindModal(){
        $("#modal-close")?.addEventListener("click", closeProfileModal);
        $("#modal-prev")?.addEventListener("click", ()=>modalGo(-1));
        $("#modal-next")?.addEventListener("click", ()=>modalGo(1));

        $("#btn-copy-name")?.addEventListener("click", async ()=>{
          const name = $("#modal-name")?.textContent || "";
          try{
            await navigator.clipboard.writeText(name);
            notify("Skopiowano nick", "copy");
          }catch{
            notify("Nie uda≈Ço siƒô skopiowaƒá", "alert-triangle");
          }
        });

        $("#btn-save-from-modal")?.addEventListener("click", ()=>{
          const list=state.modalList||[];
          const p=list[state.modalIndex];
          if(!p) return;
          toggleSaved(p.id);
          setModalContent(p);
          renderList(false);
        });
      }

      /* ---------------------- DASHBOARD LOGIC (V3) ---------------------- */
      function updateDashboardDate() {
        const el = $("#dashboard-date");
        if(el) {
          const d = new Date();
          el.textContent = d.toLocaleDateString('pl-PL', { weekday: 'long', day: 'numeric', month: 'long' });
        }
      }

      function calculateProfileStrength(me) {
        let score = 0;
        let total = 6; // name, industry, about, budget, avatar, portfolio
        if(me.name && me.name.length > 2) score++;
        if(me.industry) score++;
        if(me.about && me.about.length > 10) score++;
        if(me.minBudget > 0) score++;
        if(me.avatar && me.avatar.length > 5) score++;
        if(me.portfolio && me.portfolio.some(x=>x.length>5)) score++;
        
        return Math.round((score / total) * 100);
      }

      function updateDashboard() {
        const me = LS.getMe();
        const subs = LS.getSubs();
        if(!me) return;

        // Date
        updateDashboardDate();

        // Profile Strength
        const strength = calculateProfileStrength(me);
        $("#profile-strength-text").textContent = strength + "%";
        // SVG Ring
        const ring = $("#profile-strength-ring");
        if(ring) {
           ring.setAttribute("stroke-dasharray", `${strength}, 100`);
           ring.style.stroke = strength === 100 ? "#10b981" : "var(--accent)";
        }
        const tip = $("#profile-tip");
        if(tip) tip.textContent = strength === 100 ? "Tw√≥j profil jest ≈õwietny!" : "Uzupe≈Çnij dane, by zyskaƒá zaufanie.";

        // Fake Stats
        $("#dash-views").textContent = Math.floor(Math.random() * 50) + 120;
        
        // Listing Status
        const pub = me.listing?.published;
        $("#dash-status-dot").className = `w-2 h-2 rounded-full ${pub ? 'bg-emerald-500 shadow-[0_0_8px_#10b981]' : 'bg-red-500'}`;
        $("#dash-status-text").textContent = pub ? "Aktywne" : "Nieaktywne";
        $("#dash-status-text").className = `font-bold text-lg ${pub ? 'text-emerald-400' : 'text-white/50'}`;
        $("#dash-listing-title").textContent = me.listing?.title || "(Brak tytu≈Çu)";

        // Balance & Subs
        const headerBal = $("#header-vpln-balance")?.textContent || "0.00";
        $("#dash-balance").textContent = parseFloat(headerBal).toFixed(2);

        $("#dot-premium").className = `w-1.5 h-1.5 rounded-full ${subs.premium ? 'bg-[var(--accent)] shadow-[0_0_5px_var(--accent)]' : 'bg-gray-600'}`;
        $("#dot-verified").className = `w-1.5 h-1.5 rounded-full ${subs.verified ? 'bg-purple-500 shadow-[0_0_5px_#a855f7]' : 'bg-gray-600'}`;
        
        // Buttons visibility logic for shop
        if(subs.premium) {
           $("#btn-buy-premium").classList.add("hidden");
           $("#btn-cancel-premium").classList.remove("hidden");
        } else {
           $("#btn-buy-premium").classList.remove("hidden");
           $("#btn-cancel-premium").classList.add("hidden");
        }
        
        if(subs.verified) {
           $("#btn-buy-verified").classList.add("hidden");
           $("#btn-cancel-verified").classList.remove("hidden");
        } else {
           $("#btn-buy-verified").classList.remove("hidden");
           $("#btn-cancel-verified").classList.add("hidden");
        }
        
        // Update mini profile in sidebar
        $("#panel-avatar-mini").src = me.avatar || "";
        $("#panel-username-mini").textContent = me.name || "User";
      }

      /* ---------------------- Panel Logic (Updated V3) ---------------------- */
      function fillPanelFromMe(){
        const me=LS.getMe();
        if(!me) return;
        $("#edit-name").value = me.name || "";
        $("#edit-industry").value = me.industry || "dev";
        $("#edit-about").value = me.about || "";
        $("#edit-availability").value = me.availability || "48h";
        $("#edit-budget").value = String(me.minBudget ?? "");
        $("#edit-tags").value = (me.tags || []).join(", ");
        $("#edit-avatar-url").value = me.avatar || "";

        $("#edit-portfolio-1").value = me.portfolio?.[0] || "";
        $("#edit-portfolio-2").value = me.portfolio?.[1] || "";
        $("#edit-portfolio-3").value = me.portfolio?.[2] || "";

        $("#listing-title").value = me.listing?.title || "";
        $("#listing-contact-main").value = me.listing?.contactMain || "Discord";
        $("#listing-short").value = me.listing?.short || "";
        $("#listing-long").value = me.listing?.long || "";
      }

      function bindPanelTabs(){
        const panel=$("#user-panel");
        if(!panel) return;

        const navBtns = $$("#user-panel [data-tab]");

        const setTab=(tab)=>{
          navBtns.forEach(b=>{
            const active = b.getAttribute("data-tab")===tab;
            b.dataset.active = active ? "true" : "false";
            b.classList.toggle("bg-white/5", active);
            
            const icon = b.querySelector("i[data-lucide]");
            if(icon){
              icon.classList.toggle("text-[var(--accent)]", active);
            }
          });

          ["dashboard", "edit","listing","shop","settings"].forEach(t=>{
            const sec=$("#tab-"+t);
            if(sec) {
               sec.classList.toggle("hidden", t!==tab);
               if(t===tab && !sec.classList.contains("fade-in")) {
                  sec.classList.add("fade-in");
               }
            }
          });

          if(tab==="dashboard") updateDashboard();
          if(tab==="settings") syncSettingsUI();
          if(tab==="edit") {
             const me = LS.getMe();
             $("#edit-avatar-preview").src = me?.avatar || "";
          }
          try{ lucide.createIcons(); }catch{}
        };

        navBtns.forEach(btn=>{
          btn.addEventListener("click", ()=>setTab(btn.getAttribute("data-tab")));
        });
        
        // Dashboard shortcuts
        $("#dash-btn-preview")?.addEventListener("click", ()=>{
            openProfileModalById("me", getFilteredProfiles());
        });

        // Live Preview on Avatar Edit
        $("#edit-avatar-url")?.addEventListener("input", (e)=>{
           $("#edit-avatar-preview").src = e.target.value;
        });

        // Domy≈õlny tab
        setTab("dashboard");
      }

      function syncSettingsUI(){
        const s=LS.getSettings();
        $("#set-toast").checked = !!s.toast;
        $("#set-slash").checked = !!s.slash;
        $("#set-hide-budget").checked = !!s.hideBudget;
      }

      function bindSettings(){
        const apply=()=>{
          const s=LS.getSettings();
          s.toast = $("#set-toast").checked;
          s.slash = $("#set-slash").checked;
          s.hideBudget = $("#set-hide-budget").checked;
          LS.setSettings(s);
          notify("Zapisano ustawienia", "settings");
          renderList(false);
        };

        ["set-toast","set-slash","set-hide-budget"].forEach(id=>{
          $("#"+id)?.addEventListener("change", apply);
        });

        $("#btn-reset-settings")?.addEventListener("click", ()=>{
          LS.setSettings({toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true});
          syncSettingsUI();
          notify("Przywr√≥cono ustawienia", "rotate-ccw");
          renderList(false);
        });
      }

      function bindPanelForms(){
        // Autosave logic (simplified)
        const saveMe = () => {
           const me=LS.getMe();
           if(!me) return;
           me.name = $("#edit-name").value.trim() || me.name;
           me.industry = $("#edit-industry").value;
           me.about = $("#edit-about").value;
           me.availability = $("#edit-availability").value;
           me.minBudget = Number($("#edit-budget").value || 0);
           me.tags = $("#edit-tags").value.split(",").map(s=>s.trim()).filter(Boolean).slice(0,12);
           me.avatar = $("#edit-avatar-url").value.trim();
           me.portfolio = [
             $("#edit-portfolio-1").value.trim(),
             $("#edit-portfolio-2").value.trim(),
             $("#edit-portfolio-3").value.trim()
           ];
           
           me.listing = me.listing || {};
           me.listing.title = $("#listing-title").value;
           me.listing.contactMain = $("#listing-contact-main").value;
           me.listing.short = $("#listing-short").value;
           me.listing.long = $("#listing-long").value;
           
           LS.setMe(me);
           renderList(false);
        };

        $("#btn-save-profile")?.addEventListener("click", ()=>{
          saveMe();
          notify("Zapisano profil", "save");
        });

        $("#btn-publish")?.addEventListener("click", ()=>{
          saveMe();
          const me=LS.getMe();
          me.listing.published = true;
          LS.setMe(me);
          notify("Opublikowano og≈Çoszenie", "rocket");
          renderList(false);
          updateDashboard(); // refresh dash if open
        });

        $("#btn-unpublish")?.addEventListener("click", ()=>{
          const me=LS.getMe();
          me.listing.published = false;
          LS.setMe(me);
          notify("Ukryto og≈Çoszenie", "eye-off");
          renderList(false);
          updateDashboard();
        });

        // Shop logic
        const toggleSub = (type, active) => {
           const subs=LS.getSubs();
           subs[type] = active;
           LS.setSubs(subs);
           notify(active ? `Aktywowano ${type}` : `Wy≈ÇƒÖczono ${type}`, active ? "zap" : "x-circle");
           renderList(false);
           updateDashboard();
        };

        $("#btn-buy-premium")?.addEventListener("click", ()=>toggleSub("premium", true));
        $("#btn-cancel-premium")?.addEventListener("click", ()=>toggleSub("premium", false));
        $("#btn-buy-verified")?.addEventListener("click", ()=>toggleSub("verified", true));
        $("#btn-cancel-verified")?.addEventListener("click", ()=>toggleSub("verified", false));
      }

      /* ---------------------- Boot ---------------------- */
      function boot(){
        ensureInit();
        bindHeaderHeightVar();

        $("#footer-year").textContent = "¬© " + new Date().getFullYear();

        createParticles();

        // JWT (opcjonalnie)
        const authToken = localStorage.getItem("authToken");
        if(authToken){
          const userData = decodeJwt(authToken);
          if(userData){
            const balEl = $("#header-vpln-balance");
            if(balEl) balEl.textContent = `${(userData.vplnBalance || 0).toFixed(2)} VPLN`;
          }
        }

        $("#logout-btn")?.addEventListener("click", (e)=>{
          e.preventDefault();
          localStorage.removeItem("authToken");
          window.location.href = "./index.html";
        });

        initProgress();
        initReveal();
        
        bindFilters();
        bindHeader();
        bindModal();

        bindPanelTabs();
        fillPanelFromMe();
        bindPanelForms();
        bindSettings();

        syncFilterUI();
        renderList(true);

        setTimeout(()=>{ tryOpenFromHash(); }, 30);
        try{ lucide.createIcons(); }catch{}
      }

      document.addEventListener("DOMContentLoaded", boot);
    })();
  </script>
</body>
</html>
