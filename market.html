<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Velorie Market — Katalog ogłoszeń</title>
  <meta name="description" content="Velorie Market — katalog ogłoszeń freelancerów. Filtry, zapisane, profil, konto." />
  <meta name="theme-color" content="#0a1030" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --accent:#ff0354;
      --accent2:#7c3aed;
      --bg0:#00010f;
      --bg1:#0a1030;

      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.085);
      --border: rgba(255,255,255,.12);

      --muted: rgba(255,255,255,.75);
      --muted2: rgba(255,255,255,.58);

      --shadow: 0 18px 75px rgba(0,0,0,.62);
      --shadow2: 0 18px 70px rgba(255,3,84,.18);

      --radius-xl: 26px;
      --radius-lg: 22px;
      --radius-md: 18px;

      --ease: cubic-bezier(.2,.9,.2,1);

      /* header/filtrowy offset */
      --header-h: 66px;      /* ustawiane runtime */
      --filters-gap: 12px;   /* odstęp pod headerem */
    }

    html{ scroll-behavior:smooth; }
    body{
      background-color: var(--bg0);
      /* WALLET-LIKE BACKGROUND (same as wallet.html) */
      background-image:
        radial-gradient(1200px 700px at 70% -10%, rgba(10,16,48,1) 0%, rgba(6,6,18,.9) 35%, rgba(0,1,15,1) 70%),
        radial-gradient(900px 550px at 12% 110%, rgba(255,3,84,.18) 0%, rgba(255,3,84,0) 62%),
        radial-gradient(850px 550px at 95% 85%, rgba(124,58,237,.16) 0%, rgba(124,58,237,0) 62%),
        radial-gradient(700px 420px at 40% 35%, rgba(0,163,255,.08) 0%, rgba(0,163,255,0) 70%);
      color:#fff;
      overflow-x:hidden;
    }

    /* scrollbars */
    ::-webkit-scrollbar{ width:10px; height:10px; }
    ::-webkit-scrollbar-thumb{ background: var(--accent); border-radius:999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.08); }

    /* progress bar */
    #scroll-progress{
      position:fixed;
      inset:0 0 auto 0;
      height:2px;
      width:0%;
      background: linear-gradient(90deg, var(--accent), rgba(124,58,237,1), rgba(0,163,255,1));
      z-index: 100;
      box-shadow: 0 16px 60px rgba(255,3,84,.25);
    }

    /* WALLET-LIKE PARTICLES (instead of noise/grid) */
    @keyframes particle-animation {
      0%, 100% { transform: translateY(0%) translateX(0%) rotate(0deg); }
      50% { transform: translateY(-10%) translateX(5%) rotate(20deg); }
    }
    .particle{
      animation-name: particle-animation;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }

    /* reveal */
    .reveal{
      opacity:0;
      transform: translateY(14px);
      transition: opacity .55s var(--ease), transform .55s var(--ease);
      will-change: opacity, transform;
    }
    .reveal.is-visible{ opacity:1; transform: translateY(0); }

    /* glass */
    .glass{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    /* (wallet-like) softer glass used in account drawer */
    .glass-soft{
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 55px rgba(0,0,0,.55);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    /* gradient border wrapper */
    .g-border{
      position:relative;
      border-radius: var(--radius-xl);
    }
    .g-border::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:inherit;
      background: linear-gradient(120deg, rgba(255,3,84,.55), rgba(124,58,237,.35), rgba(0,163,255,.25));
      opacity:.55;
      z-index:0;
      pointer-events:none;
    }
    .g-border > *{ position:relative; z-index:1; }

    /* chips / pills */
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.50rem .72rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.13);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.86);
      font-size: 12px;
      line-height: 1;
      white-space: nowrap;
      user-select:none;
      transition: background .15s var(--ease), border-color .15s var(--ease), transform .15s var(--ease), filter .15s var(--ease);
    }
    .chip:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.20); filter: brightness(1.02); }
    .chip:active{ transform: translateY(1px); }
    .chip[data-active="true"]{
      background: rgba(255,3,84,.16);
      border-color: rgba(255,3,84,.45);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:.48rem;
      padding:.48rem .74rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: rgba(255,255,255,.88);
      font-size:12px;
      line-height:1;
      white-space:nowrap;
    }
    .pill button{
      width:18px;height:18px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
    }
    .pill button:hover{ background: rgba(255,255,255,.14); }

    /* buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.55rem;
      border-radius: 16px;
      padding: .85rem 1.05rem;
      font-weight: 850;
      letter-spacing: -.01em;
      transition: transform .14s var(--ease), filter .14s var(--ease), background .14s var(--ease), border-color .14s var(--ease), box-shadow .14s var(--ease);
      user-select:none;
      transform: translateZ(0);
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(255,3,84,1) 0%, rgba(255,3,84,.86) 100%);
      color:#0b0010;
      box-shadow: 0 18px 70px rgba(255,3,84,.22);
    }
    .btn-primary:hover{ filter: brightness(1.07); box-shadow: 0 18px 80px rgba(255,3,84,.28); }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }
    .btn-outline{
      background: transparent;
      border:1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.92);
    }
    .btn-outline:hover{ background: rgba(255,255,255,.06); }

    /* badges */
    .badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size: 12px;
      font-weight: 900;
      padding:.28rem .62rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.94);
    }
    .badge-verified{ background: rgba(124,58,237,.18); }
    .badge-premium{ background: rgba(255,3,84,.18); }

    /* inputs */
    .input{
      width:100%;
      border-radius:16px;
      padding:.82rem .95rem;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      outline:none;
      transition: border-color .15s var(--ease), background .15s var(--ease), box-shadow .15s var(--ease);
      appearance:none;
      -webkit-appearance:none;
    }
    .input:focus{
      border-color: rgba(255,3,84,.60);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 4px rgba(255,3,84,.12);
    }
    .label{
      font-size:12px;
      color: rgba(255,255,255,.70);
      margin-bottom:.35rem;
      display:block;
    }

    /* profile card */
    .profile-card{
      border-radius: var(--radius-xl);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 14px 70px rgba(0,0,0,.50);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      transition: transform .16s var(--ease), background .16s var(--ease), border-color .16s var(--ease), box-shadow .16s var(--ease);
      position:relative;
      overflow:hidden;
      contain: layout paint;
    }
    .profile-card::before{
      content:"";
      position:absolute;
      inset:-120px -120px auto -120px;
      height:180px;
      background:
        radial-gradient(closest-side at 20% 30%, rgba(255,3,84,.18), rgba(255,3,84,0)),
        radial-gradient(closest-side at 80% 35%, rgba(124,58,237,.14), rgba(124,58,237,0));
      opacity:.9;
      pointer-events:none;
      filter: blur(8px);
    }
    .profile-card:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.062);
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 18px 85px rgba(0,0,0,.56);
    }

    .avatar{
      width:58px;
      height:58px;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      flex:0 0 auto;
      background: rgba(255,255,255,.06);
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* portfolio thumbs */
    .thumb{
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      box-shadow: 0 12px 38px rgba(0,0,0,.28);
      position:relative;
    }
    .thumb::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.25) 100%);
      opacity:0;
      transition: opacity .25s var(--ease);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.03);
      transition: transform .35s var(--ease);
    }
    .thumb:hover img{ transform: scale(1.09); }
    .thumb:hover::after{ opacity:.6; }

    /* overlay */
    .overlay{
      position:fixed;
      inset:0;
      z-index:110;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      display:none;
      opacity:0;
      transition: opacity .2s var(--ease);
    }
    .overlay[data-open="true"]{ display:block; opacity:1; }

    /* modal */
    .modal{
      position:fixed;
      inset:0;
      z-index:150;
      display:none;
      place-items:center;
      padding:16px;
    }
    .modal[data-open="true"]{ display:grid; }
    .modal-card{
      width: min(1020px, 96vw);
      max-height: min(86vh, 820px);
      overflow:hidden;
      border-radius:28px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 22px 100px rgba(0,0,0,.70);
      transform: translateY(6px) scale(.99);
      animation: pop .22s var(--ease) forwards;
    }
    @keyframes pop{ to{ transform: translateY(0) scale(1); } }

    .divider{ height:1px; background: rgba(255,255,255,.10); }

    /* drawer (fullscreen account) */
    .drawer{
      position:fixed;
      inset:0;
      width:100%;
      z-index:140;
      transform: translateY(110%);
      transition: transform .28s var(--ease);
      display:flex;
      flex-direction:column;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      overflow:auto;
    }
    .drawer[data-open="true"]{ transform: translateY(0%); }

    /* sticky filters */
    #filters-bar{
      position: sticky;
      top: calc(var(--header-h) + var(--filters-gap));
      z-index: 90;
      transform: translateZ(0);
    }

    /* bottom bar */
    #mobile-bar{
      position:fixed;
      inset:auto 0 0 0;
      z-index:120;
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      display:none;
    }
    @media (max-width: 768px){
      #mobile-bar{ display:block; }
    }

    /* focus */
    :focus-visible{
      outline:none;
      box-shadow: 0 0 0 4px rgba(255,3,84,.16);
      border-radius:16px;
    }

    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto; }
      .reveal{ transition:none !important; }
      .modal-card{ animation:none !important; transform:none !important; }
      .btn, .profile-card, .thumb img{ transition:none !important; }
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            glow: "0 18px 80px rgba(255,3,84,0.28)"
          }
        }
      }
    };
  </script>
</head>

<body class="min-h-screen text-white selection:bg-[#ff0354]/40 selection:text-white">
  <div id="scroll-progress" aria-hidden="true"></div>

  <!-- WALLET-LIKE PARTICLES BACKGROUND -->
  <div id="particles-container" aria-hidden="true" class="pointer-events-none fixed inset-0 overflow-hidden -z-10"></div>

  <!-- HEADER -->
  <header id="app-header" class="sticky top-0 z-[95] backdrop-blur-xl bg-black/25 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-3">
      <a href="#katalog" class="flex items-center gap-3 group">
        <div class="h-10 w-10 rounded-xl ring-1 ring-white/10 group-hover:ring-white/20 transition overflow-hidden bg-white/5 flex items-center justify-center">
          <span class="font-black">V</span>
        </div>
        <div class="leading-tight">
          <div class="text-lg font-black tracking-tight">
            Velorie Market
            <span class="ml-2 inline-flex items-center gap-1 text-[10px] font-black text-white/70 bg-white/5 border border-white/10 px-2 py-1 rounded-full align-middle">
              <i data-lucide="sparkles" class="h-3 w-3 text-[var(--accent)]"></i>
              UX upgrade
            </span>
          </div>
          <div class="text-xs text-white/60">Katalog ogłoszeń • Filtry • Zapisane • Profil</div>
        </div>
      </a>

      <div class="hidden md:flex items-center gap-2">
        <button id="btn-jump-search" class="btn btn-outline px-4 py-2 text-sm" type="button" aria-label="Przejdź do wyszukiwarki">
          <i data-lucide="search" class="h-4 w-4"></i>
          <span>Szukaj</span>
          <span class="ml-1 text-[10px] px-2 py-1 rounded-full bg-white/5 border border-white/10 text-white/70 font-black">/</span>
        </button>

        <button id="btn-open-saved" class="btn btn-ghost px-4 py-2 text-sm" type="button" aria-label="Włącz filtr: zapisane">
          <i data-lucide="bookmark" class="h-4 w-4"></i>
          <span>Zapisane</span>
          <span id="saved-pill" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
        </button>

        <button id="btn-open-panel" class="btn btn-ghost px-4 py-2 text-sm" type="button" aria-label="Otwórz konto">
          <i data-lucide="user" class="h-4 w-4"></i>
          <span>Konto</span>
        </button>
      </div>

      <div class="flex md:hidden items-center gap-2">
        <button id="btn-open-saved-m" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Zapisane">
          <i data-lucide="bookmark" class="h-4 w-4"></i>
          <span id="saved-pill-m" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
        </button>
        <button id="btn-open-panel-m" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Konto">
          <i data-lucide="user" class="h-4 w-4"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- OVERLAY -->
  <div id="overlay" class="overlay" data-open="false" aria-hidden="true"></div>

  <main id="katalog" class="relative py-10">
    <div class="mx-auto max-w-7xl px-4">

      <!-- HERO -->
      <section class="reveal g-border">
        <div class="glass rounded-[26px] p-6 md:p-7">
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
            <div class="max-w-2xl">
              <div class="inline-flex items-center gap-2 text-xs font-black text-white/70 bg-white/5 border border-white/10 px-3 py-2 rounded-full">
                <i data-lucide="shield" class="h-4 w-4 text-[var(--accent)]"></i>
                kontakt bezpośredni • bez escrow • bez prowizji
              </div>

              <h1 class="mt-3 text-3xl md:text-4xl font-black tracking-tight leading-[1.05]">
                Katalog ogłoszeń
              </h1>

              <p class="text-white/65 mt-3 leading-relaxed">
                Wyszukuj, filtruj, zapisuj i otwieraj profile. Konto służy do edycji profilu publicznego i ogłoszenia.
              </p>

              <div class="mt-4 flex flex-wrap items-center gap-2 text-xs text-white/60">
                <span class="chip"><i data-lucide="sparkles" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium = wyróżnienie</span>
                <span class="chip"><i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Verified = zaufanie</span>
                <span class="chip"><i data-lucide="keyboard" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Skróty: <b>/</b> szukaj, <b>Esc</b> zamyka</span>
              </div>
            </div>

            <div class="min-w-[260px] w-full lg:w-[340px]">
              <div class="grid grid-cols-3 gap-2">
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Wyniki</div>
                  <div class="text-2xl font-black" id="stat-results">0</div>
                </div>
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Zapisane</div>
                  <div class="text-2xl font-black" id="stat-saved">0</div>
                </div>
                <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                  <div class="text-xs text-white/60">Filtry</div>
                  <div class="text-2xl font-black" id="stat-filters">0</div>
                </div>
              </div>

              <div class="mt-3 flex items-center justify-between text-xs text-white/55">
                <span class="inline-flex items-center gap-2">
                  <i data-lucide="activity" class="h-4 w-4 text-[var(--accent)]"></i>
                  “App feeling” UI (front-only demo)
                </span>
                <span id="results-hint"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- FILTERS BAR -->
      <div id="filters-bar" class="mt-6">
        <div class="glass rounded-[26px] p-4 md:p-5 reveal">
          <div class="flex flex-col gap-4">

            <!-- Row 1 -->
            <div class="grid lg:grid-cols-12 gap-3 items-end">
              <div class="lg:col-span-6">
                <label class="label">Szukaj</label>
                <div class="relative">
                  <input id="search-input" class="input pr-10" placeholder="Szukaj po nazwie, tagach, opisie..." />
                  <div class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-white/55">
                    <i data-lucide="search" class="h-4 w-4"></i>
                  </div>
                </div>
                <div class="mt-2 text-[11px] text-white/50 flex items-center gap-2">
                  <i data-lucide="sparkles" class="h-3.5 w-3.5 text-[var(--accent)]"></i>
                  Podpowiedź: wpisz np. <span class="text-white/70 font-semibold">“react”</span>, <span class="text-white/70 font-semibold">“branding”</span>, <span class="text-white/70 font-semibold">“linux”</span>.
                </div>
              </div>

              <div class="lg:col-span-3">
                <label class="label">Branża</label>
                <select id="industry-select" class="input">
                  <option value="all">Wszystkie</option>
                  <option value="dev">Programista</option>
                  <option value="gfx">Grafik</option>
                  <option value="video">Montażysta / Content</option>
                  <option value="tech">Technik / DevOps</option>
                  <option value="mc">Budowniczy Minecraft</option>
                </select>
              </div>

              <div class="lg:col-span-3">
                <label class="label">Sortowanie</label>
                <select id="sort-select" class="input">
                  <option value="recommended">Polecane</option>
                  <option value="newest">Najnowsze</option>
                  <option value="rating">Najwyższa ocena</option>
                  <option value="verified">Zweryfikowani</option>
                </select>
              </div>
            </div>

            <!-- Row 2 -->
            <div class="grid lg:grid-cols-12 gap-3 items-end">
              <div class="lg:col-span-6">
                <label class="label">Szybkie filtry</label>
                <div class="flex flex-wrap gap-2">
                  <button id="filter-saved" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="bookmark" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Zapisane
                  </button>
                  <button id="filter-premium" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="zap" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium
                  </button>
                  <button id="filter-verified" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Verified
                  </button>
                  <button id="filter-available" class="chip" type="button" aria-pressed="false">
                    <i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny ≤72h
                  </button>
                </div>
              </div>

              <div class="lg:col-span-6">
                <label class="label">Budżet (PLN)</label>
                <div class="grid grid-cols-2 gap-2">
                  <input id="budget-min" class="input" type="number" min="0" step="10" placeholder="Min. np. 100" />
                  <input id="budget-max" class="input" type="number" min="0" step="10" placeholder="Max. np. 1000" />
                </div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <button class="chip" type="button" data-budget-preset="300">≤ 300</button>
                  <button class="chip" type="button" data-budget-preset="500">≤ 500</button>
                  <button class="chip" type="button" data-budget-preset="1000">≤ 1000</button>
                  <button class="chip" type="button" data-budget-preset="0">Bez limitu</button>
                </div>
              </div>
            </div>

            <!-- Row 3 -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
              <div class="text-xs text-white/60 flex items-center gap-2">
                <i data-lucide="info" class="h-4 w-4"></i>
                <span>Kontakt i rozliczenia odbywają się bezpośrednio między stronami.</span>
              </div>

              <div class="flex items-center gap-2">
                <div id="active-filters" class="hidden sm:flex flex-wrap gap-2 justify-end"></div>

                <button id="btn-reset-filters" class="btn btn-outline px-3 py-2 text-xs" type="button">
                  <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                  Wyczyść
                </button>

                <button id="btn-open-panel-inline" class="btn btn-primary px-3 py-2 text-xs" type="button">
                  <i data-lucide="sliders-horizontal" class="h-4 w-4"></i>
                  Konto
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- RESULTS -->
      <section class="mt-8">
        <div class="flex items-center justify-between gap-3 mb-3">
          <div class="text-sm text-white/70 flex items-center gap-2">
            <i data-lucide="layers" class="h-4 w-4 text-[var(--accent)]"></i>
            <span>Wyświetlane: <b id="shown-count">0</b> / <b id="total-count">0</b></span>
          </div>
          <div class="text-[11px] text-white/50 hidden md:block">
            Kliknij kartę profilu, aby otworzyć modal. Strzałki ←/→ działają w modalu.
          </div>
        </div>

        <div class="space-y-4" id="profiles-list"></div>
      </section>

      <!-- Load more -->
      <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-3 text-sm text-white/70">
        <div class="flex items-center gap-2">
          <i data-lucide="sparkles" class="h-4 w-4 text-[var(--accent)]"></i>
          <span class="text-white/60">Tip:</span>
          <span>Użyj <b class="text-white/90">Zapisane</b> do shortlisty.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="btn-load-more" class="btn btn-ghost px-4 py-2" type="button">
            <i data-lucide="plus" class="h-4 w-4"></i>
            <span>Wczytaj więcej</span>
          </button>
        </div>
      </div>

      <!-- FOOTER -->
      <footer class="mt-10 pb-24 md:pb-8 text-xs text-white/50">
        <div class="glass rounded-[26px] p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 reveal">
          <div class="flex items-center gap-2">
            <i data-lucide="sparkles" class="h-4 w-4 text-[var(--accent)]"></i>
            <span>Velorie Market • Platforma ogłoszeń freelancerów</span>
          </div>
          <div class="flex items-center gap-2">
            <span id="footer-year"></span>
            <span>•</span>
            <span class="text-white/60">Made for fast MVP</span>
          </div>
        </div>
      </footer>

    </div>
  </main>

  <!-- MOBILE BAR -->
  <div id="mobile-bar" class="pointer-events-none">
    <div class="pointer-events-auto glass rounded-[22px] px-3 py-2 flex items-center justify-between gap-2">
      <button id="m-search" class="btn btn-outline px-3 py-2 text-sm" type="button" aria-label="Szukaj">
        <i data-lucide="search" class="h-4 w-4"></i>
        <span>Szukaj</span>
      </button>
      <button id="m-saved" class="btn btn-ghost px-3 py-2 text-sm" type="button" aria-label="Zapisane">
        <i data-lucide="bookmark" class="h-4 w-4"></i>
        <span id="m-saved-count" class="ml-1 rounded-full bg-white/10 px-2 py-0.5 text-xs font-black">0</span>
      </button>
      <button id="m-account" class="btn btn-primary px-3 py-2 text-sm" type="button" aria-label="Konto">
        <i data-lucide="user" class="h-4 w-4"></i>
        <span>Konto</span>
      </button>
    </div>
  </div>

  <!-- PROFILE MODAL -->
  <section id="profile-modal" class="modal" data-open="false" aria-label="Profil" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="p-4 flex items-center justify-between gap-3 border-b border-white/10">
        <div class="flex items-center gap-3 min-w-0">
          <div class="avatar">
            <img id="modal-avatar" src="" alt="Avatar profilu" />
          </div>
          <div class="leading-tight min-w-0">
            <div class="flex items-center gap-2 flex-wrap">
              <div class="text-lg md:text-xl font-black tracking-tight truncate" id="modal-name">Profil</div>
              <span id="modal-badges" class="flex items-center gap-2"></span>
            </div>
            <div class="text-xs text-white/60 truncate" id="modal-sub">—</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button id="modal-prev" class="btn btn-ghost px-3 py-2" type="button" aria-label="Poprzedni profil">
            <i data-lucide="chevron-left" class="h-4 w-4"></i>
          </button>
          <button id="modal-next" class="btn btn-ghost px-3 py-2" type="button" aria-label="Następny profil">
            <i data-lucide="chevron-right" class="h-4 w-4"></i>
          </button>
          <button id="modal-close" class="btn btn-outline px-3 py-2" type="button" aria-label="Zamknij modal">
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>
      </div>

      <div class="grid lg:grid-cols-12 gap-0">
        <div class="lg:col-span-7 p-4 border-b lg:border-b-0 lg:border-r border-white/10">
          <div class="flex flex-wrap items-center gap-2" id="modal-chips"></div>

          <div class="mt-4 grid grid-cols-3 gap-2" id="modal-portfolio"></div>

          <div class="mt-4 glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="file-text" class="h-4 w-4 text-[var(--accent)]"></i>
              Opis
            </div>
            <p class="mt-2 text-sm text-white/75 leading-relaxed whitespace-pre-line" id="modal-about"></p>
          </div>
        </div>

        <div class="lg:col-span-5 p-4">
          <div class="glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="message-circle" class="h-4 w-4 text-[var(--accent)]"></i>
              Kontakt
            </div>
            <p class="mt-2 text-sm text-white/70">
              Skopiuj nick i odezwij się wybranym kanałem. (Demo nie wysyła wiadomości.)
            </p>

            <div class="mt-3 grid sm:grid-cols-2 gap-2">
              <button id="btn-copy-name" class="btn btn-primary px-4 py-3" type="button">
                <i data-lucide="copy" class="h-4 w-4"></i>
                Kopiuj nick
              </button>
              <button id="btn-save-from-modal" class="btn btn-ghost px-4 py-3" type="button">
                <i data-lucide="bookmark" class="h-4 w-4"></i>
                Zapisz
              </button>
            </div>

            <div class="mt-4 divider"></div>

            <div class="mt-4 text-xs text-white/55">
              Tip: Link do profilu zawiera <span class="text-white/70 font-semibold">#profile=ID</span>.
            </div>
          </div>

          <div class="mt-3 glass rounded-[22px] p-4">
            <div class="text-sm font-black flex items-center gap-2">
              <i data-lucide="shield-alert" class="h-4 w-4 text-[var(--accent)]"></i>
              Bezpieczeństwo
            </div>
            <ul class="mt-2 text-sm text-white/70 list-disc pl-5 space-y-1">
              <li>Ustalaj warunki współpracy na piśmie.</li>
              <li>Nie udostępniaj haseł ani kodów przed ustaleniem zasad.</li>
              <li>W razie podejrzeń — zgłaszaj naruszenia.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ACCOUNT DRAWER (fullscreen) — NOW WALLET.HTML COLORS/STYLE -->
  <aside id="user-panel" class="drawer glass-soft" data-open="false" aria-label="Panel konta">

    <!-- TOP BAR (wallet-like) -->
    <div class="sticky top-0 z-[2] backdrop-blur-xl bg-black/20 border-b border-white/10">
      <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-4">
        <a href="#katalog" class="flex items-center gap-3 flex-shrink-0">
          <div class="h-10 w-10 rounded-xl ring-1 ring-white/10 bg-white/5 flex items-center justify-center font-black">V</div>
          <div class="leading-tight hidden sm:block">
            <div class="text-lg font-semibold tracking-tight">Velorie Market</div>
            <div class="text-xs text-white/60">Panel konta</div>
          </div>
        </a>

        <div class="flex items-center gap-2 flex-shrink-0">
          <div class="hidden sm:flex items-center gap-2 rounded-lg bg-white/5 px-4 py-2 text-sm font-medium border border-white/10">
            <i data-lucide="wallet" class="h-4 w-4 text-[var(--accent)]"></i>
            <span id="header-vpln-balance">0.00 VPLN</span>
          </div>

          <button id="btn-close-panel" class="inline-flex items-center gap-2 rounded-lg bg-white/5 border border-white/10 px-4 py-2 text-sm font-medium hover:bg-white/10 transition" type="button">
            <i data-lucide="x" class="h-4 w-4"></i>
            <span class="hidden sm:inline">Zamknij</span>
          </button>

          <a id="logout-btn" href="#" class="inline-flex items-center gap-2 rounded-lg bg-[var(--accent)]/80 text-white px-4 py-2 text-sm font-medium hover:bg-[var(--accent)] transition">
            <i data-lucide="log-out" class="h-4 w-4"></i>
            <span class="hidden sm:inline">Wyloguj</span>
          </a>
        </div>
      </div>
    </div>

    <!-- BODY: sidebar + content -->
    <div class="mx-auto max-w-7xl p-4 md:p-8 w-full">
      <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

        <!-- SIDEBAR -->
        <aside class="lg:col-span-1">
          <div class="p-4 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl sticky top-24">
            <div class="flex items-center gap-3 mb-4">
              <div class="avatar">
                <img id="panel-avatar" src="" alt="Ty" />
              </div>
              <div class="min-w-0">
                <div class="font-black tracking-tight truncate" id="panel-username">Użytkownik</div>
                <div class="text-xs text-white/60 truncate">
                  <span id="panel-status">Aktywne konto</span>
                </div>
              </div>
            </div>

            <nav class="flex flex-col gap-2">
              <button class="flex items-center gap-4 px-5 py-4 rounded-lg bg-white/10 font-semibold text-white transition text-base border border-white/10"
                      data-tab="edit" type="button">
                <i data-lucide="pencil" class="h-6 w-6 text-[var(--accent)]"></i>
                <span>Profil</span>
              </button>

              <button class="flex items-center gap-4 px-5 py-4 rounded-lg text-white/70 hover:bg-white/5 hover:text-white transition text-base border border-transparent hover:border-white/10"
                      data-tab="preview" type="button">
                <i data-lucide="eye" class="h-6 w-6"></i>
                <span>Podgląd</span>
              </button>

              <button class="flex items-center gap-4 px-5 py-4 rounded-lg text-white/70 hover:bg-white/5 hover:text-white transition text-base border border-transparent hover:border-white/10"
                      data-tab="listing" type="button">
                <i data-lucide="file-plus" class="h-6 w-6"></i>
                <span>Ogłoszenie</span>
              </button>

              <button class="flex items-center gap-4 px-5 py-4 rounded-lg text-white/70 hover:bg-white/5 hover:text-white transition text-base border border-transparent hover:border-white/10"
                      data-tab="shop" type="button">
                <i data-lucide="shopping-bag" class="h-6 w-6"></i>
                <span>Plany</span>
              </button>

              <a href="./wallet.html"
                 class="flex items-center gap-4 px-5 py-4 rounded-lg text-white/70 hover:bg-white/5 hover:text-white transition text-base border border-transparent hover:border-white/10">
                <i data-lucide="wallet" class="h-6 w-6"></i>
                <span>Portfel</span>
              </a>

              <button class="flex items-center gap-4 px-5 py-4 rounded-lg text-white/70 hover:bg-white/5 hover:text-white transition text-base border border-transparent hover:border-white/10"
                      data-tab="settings" type="button">
                <i data-lucide="settings" class="h-6 w-6"></i>
                <span>Ustawienia</span>
              </button>

              <button class="flex items-center gap-4 px-5 py-4 rounded-lg text-white/70 hover:bg-white/5 hover:text-white transition text-base border border-transparent hover:border-white/10"
                      data-tab="security" type="button">
                <i data-lucide="shield" class="h-6 w-6"></i>
                <span>Bezpieczeństwo</span>
              </button>
            </nav>
          </div>
        </aside>

        <!-- CONTENT -->
        <section class="lg:col-span-4 space-y-4">

          <!-- Status bar -->
          <div class="glass rounded-[22px] p-4 flex items-center justify-between gap-3">
            <div class="flex items-center gap-2 text-sm text-white/80">
              <i data-lucide="circle-check" class="h-4 w-4 text-[var(--accent)]"></i>
              <span id="save-status">Wszystko zapisane</span>
            </div>
            <div class="text-sm text-white/70">
              Plan: <span id="plan-status" class="text-white/90 font-semibold">Standard</span>
            </div>
          </div>

          <!-- EDIT -->
          <section id="tab-edit" class="space-y-4">
            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="pencil" class="h-5 w-5 text-[var(--accent)]"></i>
                Dane profilu
              </div>

              <div class="mt-4 grid sm:grid-cols-2 gap-3">
                <div>
                  <label class="label">Nick / Imię</label>
                  <input id="edit-name" class="input" />
                  <div class="mt-1 text-xs text-white/45">Min. 2 znaki.</div>
                </div>
                <div>
                  <label class="label">Branża</label>
                  <select id="edit-industry" class="input">
                    <option value="dev">Programista</option>
                    <option value="gfx">Grafik</option>
                    <option value="video">Montażysta / Content</option>
                    <option value="tech">Technik / DevOps</option>
                    <option value="mc">Budowniczy Minecraft</option>
                  </select>
                </div>

                <div class="sm:col-span-2">
                  <label class="label">Opis</label>
                  <textarea id="edit-about" class="input" rows="5" placeholder="Napisz kilka zdań o sobie..."></textarea>
                </div>

                <div>
                  <label class="label">Dostępność</label>
                  <select id="edit-availability" class="input">
                    <option value="24h">24h</option>
                    <option value="48h">48h</option>
                    <option value="72h">72h</option>
                    <option value="Tydzień">Tydzień</option>
                  </select>
                </div>

                <div>
                  <label class="label">Budżet minimalny (PLN)</label>
                  <input id="edit-budget" class="input" type="number" min="0" step="1" />
                </div>

                <div class="sm:col-span-2">
                  <label class="label">Tagi (oddziel przecinkami)</label>
                  <input id="edit-tags" class="input" placeholder="React, Node, API..." />
                  <div class="mt-1 text-xs text-white/45">Max 12 tagów.</div>
                </div>

                <div class="sm:col-span-2">
                  <label class="label">Avatar (URL)</label>
                  <input id="edit-avatar-url" class="input" placeholder="https://..." />
                  <div class="mt-1 text-xs text-white/45">Jeśli puste — zostaje obecny.</div>
                </div>
              </div>

              <div class="mt-4 flex flex-wrap items-center gap-2">
                <button id="btn-save-profile" class="btn btn-primary px-4 py-3" type="button">
                  <i data-lucide="save" class="h-4 w-4"></i>
                  <span>Zapisz</span>
                </button>
                <button id="btn-reset-profile" class="btn btn-ghost px-4 py-3" type="button">
                  <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                  <span>Przywróć</span>
                </button>
                <button id="btn-open-me-modal" class="btn btn-outline px-4 py-3" type="button">
                  <i data-lucide="external-link" class="h-4 w-4"></i>
                  <span>Otwórz profil</span>
                </button>
              </div>
            </div>

            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="images" class="h-5 w-5 text-[var(--accent)]"></i>
                Portfolio (3 zdjęcia)
              </div>
              <p class="mt-2 text-sm text-white/70">
                Widoczne w katalogu i w profilu.
              </p>

              <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
                <div>
                  <label class="label">Zdjęcie 1 URL</label>
                  <input id="edit-portfolio-1" class="input" placeholder="https://..." />
                </div>
                <div>
                  <label class="label">Zdjęcie 2 URL</label>
                  <input id="edit-portfolio-2" class="input" placeholder="https://..." />
                </div>
                <div>
                  <label class="label">Zdjęcie 3 URL</label>
                  <input id="edit-portfolio-3" class="input" placeholder="https://..." />
                </div>
              </div>
            </div>
          </section>

          <!-- PREVIEW -->
          <section id="tab-preview" class="space-y-4 hidden">
            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="eye" class="h-5 w-5 text-[var(--accent)]"></i>
                Podgląd profilu
              </div>
              <p class="mt-2 text-sm text-white/70">
                Ten podgląd pokazuje jak Twoja karta wygląda w katalogu.
              </p>
              <div class="mt-4" id="preview-card"></div>
            </div>
          </section>

          <!-- LISTING -->
          <section id="tab-listing" class="space-y-4 hidden">
            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="file-plus" class="h-5 w-5 text-[var(--accent)]"></i>
                Ogłoszenie
              </div>
              <p class="mt-2 text-sm text-white/70">
                Uzupełnij opis i opublikuj wizytówkę w katalogu.
              </p>

              <div class="mt-4 grid sm:grid-cols-2 gap-3">
                <div>
                  <label class="label">Tytuł ogłoszenia</label>
                  <input id="listing-title" class="input" placeholder="np. Programista React/Node — szybkie MVP" />
                </div>
                <div>
                  <label class="label">Kanał kontaktu (główny)</label>
                  <select id="listing-contact-main" class="input">
                    <option value="Discord">Discord</option>
                    <option value="E-mail">E-mail</option>
                    <option value="Instagram">Instagram</option>
                    <option value="Facebook">Facebook</option>
                  </select>
                </div>

                <div class="sm:col-span-2">
                  <label class="label">Krótki opis</label>
                  <input id="listing-short" class="input" placeholder="2–3 zdania: co robisz i dla kogo." />
                </div>

                <div class="sm:col-span-2">
                  <label class="label">Dłuższy opis</label>
                  <textarea id="listing-long" class="input" rows="6" placeholder="Szczegóły usług, proces, terminy, zasady..."></textarea>
                </div>
              </div>

              <div class="mt-4 flex flex-wrap items-center gap-2">
                <button id="btn-publish" class="btn btn-primary px-4 py-3" type="button">
                  <i data-lucide="rocket" class="h-4 w-4"></i>
                  <span>Opublikuj / Zaktualizuj</span>
                </button>
                <button id="btn-unpublish" class="btn btn-outline px-4 py-3" type="button">
                  <i data-lucide="eye-off" class="h-4 w-4"></i>
                  <span>Ukryj</span>
                </button>
              </div>
            </div>
          </section>

          <!-- SHOP -->
          <section id="tab-shop" class="space-y-4 hidden">
            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="shopping-bag" class="h-5 w-5 text-[var(--accent)]"></i>
                Plany i wyróżnienia
              </div>
              <p class="mt-2 text-sm text-white/70">
                Aktywny plan wpływa na widoczność oraz oznaczenia profilu w wynikach.
              </p>

              <div class="mt-4 grid md:grid-cols-2 gap-3">
                <div class="rounded-[22px] bg-white/5 border border-white/10 p-4">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-sm font-black">Premium</div>
                      <div class="text-xs text-white/60">Wyróżnienie w wynikach</div>
                    </div>
                    <div class="text-sm font-black">23.99 PLN/mies.</div>
                  </div>
                  <ul class="mt-3 text-sm text-white/70 list-disc pl-5 space-y-1">
                    <li>Badge “Premium”</li>
                    <li>Wyżej w “Polecane”</li>
                    <li>Więcej klików</li>
                  </ul>
                  <button id="btn-buy-premium" class="mt-3 btn btn-primary w-full px-4 py-3" type="button">
                    <i data-lucide="zap" class="h-4 w-4"></i>
                    <span>Aktywuj Premium</span>
                  </button>
                  <button id="btn-cancel-premium" class="mt-2 btn btn-outline w-full px-4 py-3" type="button">
                    <i data-lucide="x-circle" class="h-4 w-4"></i>
                    <span>Wyłącz Premium</span>
                  </button>
                </div>

                <div class="rounded-[22px] bg-white/5 border border-white/10 p-4">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-sm font-black">Verified</div>
                      <div class="text-xs text-white/60">Zaufanie + filtr Verified</div>
                    </div>
                    <div class="text-sm font-black">19.55 PLN/mies.</div>
                  </div>
                  <ul class="mt-3 text-sm text-white/70 list-disc pl-5 space-y-1">
                    <li>Badge “Verified”</li>
                    <li>Wyżej w sort “Zweryfikowani”</li>
                    <li>Lepsza konwersja</li>
                  </ul>
                  <button id="btn-buy-verified" class="mt-3 btn btn-primary w-full px-4 py-3" type="button">
                    <i data-lucide="badge-check" class="h-4 w-4"></i>
                    <span>Aktywuj Verified</span>
                  </button>
                  <button id="btn-cancel-verified" class="mt-2 btn btn-outline w-full px-4 py-3" type="button">
                    <i data-lucide="x-circle" class="h-4 w-4"></i>
                    <span>Wyłącz Verified</span>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- SETTINGS -->
          <section id="tab-settings" class="space-y-4 hidden">
            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="settings" class="h-5 w-5 text-[var(--accent)]"></i>
                Ustawienia
              </div>
              <div class="mt-4 grid sm:grid-cols-2 gap-3">
                <label class="rounded-[18px] bg-white/5 border border-white/10 p-4 flex items-start gap-3 cursor-pointer select-none">
                  <input id="set-toast" type="checkbox" class="mt-1" />
                  <div>
                    <div class="font-black text-sm">Toasty</div>
                    <div class="text-xs text-white/60">Powiadomienia “Kopiowano”, “Zapisano” itd.</div>
                  </div>
                </label>

                <label class="rounded-[18px] bg-white/5 border border-white/10 p-4 flex items-start gap-3 cursor-pointer select-none">
                  <input id="set-slash" type="checkbox" class="mt-1" />
                  <div>
                    <div class="font-black text-sm">Skrót “/”</div>
                    <div class="text-xs text-white/60">Fokus w pole wyszukiwarki</div>
                  </div>
                </label>

                <label class="rounded-[18px] bg-white/5 border border-white/10 p-4 flex items-start gap-3 cursor-pointer select-none">
                  <input id="set-hide-budget" type="checkbox" class="mt-1" />
                  <div>
                    <div class="font-black text-sm">Ukryj budżet</div>
                    <div class="text-xs text-white/60">Nie pokazuj “od X PLN” na kartach</div>
                  </div>
                </label>

                <label class="rounded-[18px] bg-white/5 border border-white/10 p-4 flex items-start gap-3 cursor-pointer select-none">
                  <input id="set-hide-rating" type="checkbox" class="mt-1" />
                  <div>
                    <div class="font-black text-sm">Ukryj ocenę</div>
                    <div class="text-xs text-white/60">Nie pokazuj “Ocena” na kartach</div>
                  </div>
                </label>

                <label class="rounded-[18px] bg-white/5 border border-white/10 p-4 flex items-start gap-3 cursor-pointer select-none sm:col-span-2">
                  <input id="set-focus-trap" type="checkbox" class="mt-1" />
                  <div>
                    <div class="font-black text-sm">Focus trap w modalu</div>
                    <div class="text-xs text-white/60">Tab nie ucieka poza modal</div>
                  </div>
                </label>
              </div>

              <div class="mt-4 flex flex-wrap gap-2">
                <button id="btn-reset-settings" class="btn btn-outline px-4 py-3" type="button">
                  <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                  Przywróć domyślne
                </button>
              </div>
            </div>
          </section>

          <!-- SECURITY -->
          <section id="tab-security" class="space-y-4 hidden">
            <div class="glass rounded-[22px] p-5">
              <div class="font-black flex items-center gap-2">
                <i data-lucide="shield" class="h-5 w-5 text-[var(--accent)]"></i>
                Bezpieczeństwo
              </div>
              <ul class="mt-3 text-sm text-white/70 list-disc pl-5 space-y-1">
                <li>Ustal zakres i terminy przed startem.</li>
                <li>Nie wysyłaj prywatnych danych bez potrzeby.</li>
                <li>Rozważ zaliczkę / etapy.</li>
              </ul>
              <div class="mt-4 rounded-[18px] bg-white/5 border border-white/10 p-4 text-sm text-white/70">
                Ten projekt to demo front-only (localStorage). Nie ma prawdziwych płatności ani weryfikacji.
              </div>
            </div>
          </section>

        </section>
      </div>
    </div>
  </aside>

  <script>
    /***********************************************************************
     * Velorie Market — market.html (UX upgrade)
     * ✅ Konto: w kolorach/stylu jak wallet.html (bg + glass + header)
     * ✅ Portfel: link ./wallet.html
     ***********************************************************************/

    (function(){
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

      const now = () => Date.now();

      function safeParse(v, fallback){
        try { return JSON.parse(v); } catch { return fallback; }
      }
      function safeStringify(v, fallback="{}"){
        try { return JSON.stringify(v); } catch { return fallback; }
      }
      function escapeHTML(str){
        return String(str ?? "")
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }
      function normalizeText(s){
        return String(s||"")
          .toLowerCase()
          .normalize("NFD")
          .replace(/\p{Diacritic}/gu,"");
      }
      function debounce(fn, delay=250){
        let t=null;
        return (...args)=>{
          clearTimeout(t);
          t=setTimeout(()=>fn(...args), delay);
        };
      }

      // --- JWT decode (jak prototyp #1) ---
      function decodeJwt(token){
        try { return JSON.parse(atob(token.split('.')[1])); }
        catch { return null; }
      }

      /* ---------------------- Header height -> CSS var ---------------------- */
      function bindHeaderHeightVar(){
        const header = $("#app-header");
        if(!header) return;

        const set = () => {
          const h = Math.round(header.getBoundingClientRect().height || 66);
          document.documentElement.style.setProperty("--header-h", h + "px");
        };

        set();
        window.addEventListener("resize", set, {passive:true});
      }

      /* ---------------------- Toasts ---------------------- */
      const Toast = (() => {
        let wrap=null;
        let queue=[];
        let showing=false;

        function ensure(){
          if(wrap) return wrap;
          wrap=document.createElement("div");
          wrap.id="toast-wrap";
          wrap.className="fixed bottom-5 left-1/2 -translate-x-1/2 z-[220] space-y-2";
          document.body.appendChild(wrap);
          return wrap;
        }
        function showNext(){
          if(showing) return;
          const item=queue.shift();
          if(!item) return;
          showing=true;
          ensure();

          const el=document.createElement("div");
          el.className="glass rounded-2xl px-4 py-3 text-sm text-white/90 border border-white/10 shadow-glow max-w-[92vw] flex items-center gap-2";
          el.innerHTML=`
            <span class="inline-flex items-center justify-center w-7 h-7 rounded-xl bg-white/5 border border-white/10">
              <i data-lucide="${item.icon||"sparkles"}" class="h-4 w-4 text-[var(--accent)]"></i>
            </span>
            <span>${escapeHTML(item.message)}</span>
          `;
          wrap.appendChild(el);
          try{ lucide.createIcons(); }catch{}

          setTimeout(()=>{
            el.style.opacity="0";
            el.style.transform="translateY(6px)";
            el.style.transition="opacity .25s ease, transform .25s ease";
            setTimeout(()=>{
              el.remove();
              showing=false;
              showNext();
            }, 260);
          }, item.ms||1700);
        }
        return {
          push(message, icon="sparkles", ms=1700){
            queue.push({message, icon, ms});
            showNext();
          }
        };
      })();

      /* ---------------------- Storage ---------------------- */
      const LS = {
        keyProfiles: "vm_profiles_v2",
        keySaved: "vm_saved_v2",
        keySubs: "vm_subs_v2",
        keyMe: "vm_me_v2",
        keySettings: "vm_settings_v2",

        getProfiles(){ return safeParse(localStorage.getItem(this.keyProfiles), null); },
        setProfiles(list){ localStorage.setItem(this.keyProfiles, safeStringify(list,"[]")); },

        getSaved(){ return new Set(safeParse(localStorage.getItem(this.keySaved), [])); },
        setSaved(setOrArr){
          const arr = Array.isArray(setOrArr) ? setOrArr : Array.from(setOrArr);
          localStorage.setItem(this.keySaved, safeStringify(arr,"[]"));
        },

        getSubs(){ return safeParse(localStorage.getItem(this.keySubs), {premium:false, verified:false}); },
        setSubs(obj){ localStorage.setItem(this.keySubs, safeStringify(obj,"{}")); },

        getMe(){ return safeParse(localStorage.getItem(this.keyMe), null); },
        setMe(obj){ localStorage.setItem(this.keyMe, safeStringify(obj,"{}")); },

        getSettings(){ return safeParse(localStorage.getItem(this.keySettings), {toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true}); },
        setSettings(obj){ localStorage.setItem(this.keySettings, safeStringify(obj,"{}")); },
      };

      const notify = (msg, icon="sparkles", ms=1700)=>{
        const s=LS.getSettings();
        if(s.toast) Toast.push(msg, icon, ms);
      };

      /* ---------------------- Seed Data ---------------------- */
      const FALLBACK_PROFILES = [
        {
          id:"p1",
          name:"zxq0",
          industry:"dev",
          industryLabel:"Programista",
          tagline:"React • Node • API • Automatyzacje",
          about:"Buduję szybkie MVP, integracje i automatyzacje. Działam konkretnie: zakres → prototyp → wdrożenie.\n\nPreferuję: React, Node, API, deployment, dashboardy.",
          rating:4.9,
          availableIn:"48h",
          minBudget:300,
          location:"Online",
          premium:true,
          verified:true,
          avatar:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*10
        },
        {
          id:"p2",
          name:"Klaudia",
          industry:"gfx",
          industryLabel:"Grafik",
          tagline:"Branding • UI • Miniatury • Packi",
          about:"Robię branding, UI i grafiki pod social. Lubię mocny kontrast i clean systemy.\n\nDostarczam pliki + guideline (opcjonalnie).",
          rating:4.7,
          availableIn:"24h",
          minBudget:200,
          location:"Online",
          premium:true,
          verified:false,
          avatar:"https://images.unsplash.com/photo-1548142813-c348350df52b?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*4
        },
        {
          id:"p3",
          name:"kubus",
          industry:"tech",
          industryLabel:"Technik / DevOps",
          tagline:"Linux • Proxy • Security • Optymalizacja",
          about:"Pomagam z serwerami, bezpieczeństwem i optymalizacją. Ustawiam proxy, monitoring, backupy.\n\nW cenie: checklist + rekomendacje.",
          rating:4.8,
          availableIn:"72h",
          minBudget:250,
          location:"Online",
          premium:false,
          verified:true,
          avatar:"https://images.unsplash.com/photo-1603415526960-f7e0328b7cf6?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1531297484001-80022131f5a1?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*7
        },
        {
          id:"p4",
          name:"A.I.",
          industry:"video",
          industryLabel:"Montażysta / Content",
          tagline:"Montaż • Shortsy • Motion • TikTok",
          about:"Montaż shortów, reels i długich form. Dostarczam szybkie iteracje + wersje A/B.\n\nWorkflow: brief → draft → poprawki → final.",
          rating:4.6,
          availableIn:"48h",
          minBudget:300,
          location:"Online",
          premium:false,
          verified:false,
          avatar:"https://images.unsplash.com/photo-1520975682038-1c5d5cfc20a1?q=80&w=512&auto=format&fit=crop",
          portfolio:[
            "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now() - 1000*60*60*24*2
        }
      ];

      function ensureInit(){
        if(!LS.getProfiles()) LS.setProfiles(FALLBACK_PROFILES);

        if(!LS.getMe()){
          LS.setMe({
            id:"me",
            name:"zxq0",
            industry:"dev",
            about:"Tworzę produkty web, automatyzacje i integracje. Działam szybko i konkretnie.",
            availability:"48h",
            minBudget:300,
            tags:["React","Node","API","Automatyzacje"],
            avatar:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
            portfolio:["","",""],
            listing:{
              title:"Programista React/Node — szybkie MVP",
              contactMain:"Discord",
              short:"Buduję MVP, dashboardy i integracje. Szybkie iteracje i konkretne wdrożenia.",
              long:"Zakres → prototyp → wdrożenie. Integracje API, panele, automatyzacje, deployment.\n\nUstalamy cele i deadline, pracuję iteracyjnie.",
              published:true
            }
          });
        }
        if(!localStorage.getItem(LS.keySaved)) LS.setSaved([]);
        if(!localStorage.getItem(LS.keySubs)) LS.setSubs({premium:false, verified:false});
        if(!localStorage.getItem(LS.keySettings)) LS.setSettings({toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true});
      }

      /* ---------------------- State ---------------------- */
      const state = {
        q:"",
        industry:"all",
        premiumOnly:false,
        verifiedOnly:false,
        availableOnly:false,
        savedOnly:false,
        sort:"recommended",
        budgetMin:null,
        budgetMax:null,

        pageSize:4,
        shown:0,

        modalOpen:false,
        modalList:[],
        modalIndex:-1,
        lastFocus:null
      };

      function parseAvailableHours(str){
        const s=String(str||"").toLowerCase();
        if(s.includes("tydz")) return 168;
        const m=s.match(/(\d+)\s*h/);
        return m ? Number(m[1]) : 9999;
      }
      function scoreRecommended(p){
        const premium = p.premium ? 1 : 0;
        const verified = p.verified ? 1 : 0;
        const rating = Number(p.rating||0);
        const recency = typeof p.createdAt==="number" ? p.createdAt : 0;
        return premium*4 + verified*2.2 + rating*1.2 + recency/1e12;
      }

      /* ---------------------- UI helpers ---------------------- */
      function setOverlay(open){
        const ov=$("#overlay");
        if(!ov) return;
        ov.dataset.open=open?"true":"false";
        ov.setAttribute("aria-hidden", open?"false":"true");
      }
      function lockBody(lock){
        document.body.style.overflow = lock ? "hidden" : "";
      }
      function setPanelOpen(open){
        const panel=$("#user-panel");
        if(!panel) return;
        panel.dataset.open=open?"true":"false";
        const any = open || state.modalOpen;
        setOverlay(any);
        lockBody(any);
        if(open){
          const btn=panel.querySelector('[data-tab]');
          setTimeout(()=>btn?.focus(),0);
        }
      }
      function setModalOpen(open){
        const modal=$("#profile-modal");
        if(!modal) return;
        modal.dataset.open=open?"true":"false";
        state.modalOpen=open;
        const any = open || ($("#user-panel")?.dataset.open==="true");
        setOverlay(any);
        lockBody(any);

        if(open){
          if(LS.getSettings().focusTrap) installFocusTrap(modal);
          setTimeout(()=>$("#modal-close")?.focus(),0);
        }else{
          uninstallFocusTrap(modal);
          if(state.lastFocus) setTimeout(()=>state.lastFocus.focus?.(),0);
        }
      }

      /* ---------------------- Focus trap ---------------------- */
      const focusTrapState = new WeakMap();
      function getFocusable(root){
        const sel = [
          "a[href]",
          "button:not([disabled])",
          "textarea:not([disabled])",
          "input:not([disabled])",
          "select:not([disabled])",
          "[tabindex]:not([tabindex='-1'])"
        ].join(",");
        return $$(sel, root).filter(el=>!!(el.offsetWidth||el.offsetHeight||el.getClientRects().length));
      }
      function installFocusTrap(modal){
        if(focusTrapState.has(modal)) return;
        const onKeydown=(e)=>{
          if(e.key!=="Tab") return;
          const f=getFocusable(modal);
          if(!f.length) return;
          const first=f[0];
          const last=f[f.length-1];
          if(e.shiftKey){
            if(document.activeElement===first){
              e.preventDefault(); last.focus();
            }
          }else{
            if(document.activeElement===last){
              e.preventDefault(); first.focus();
            }
          }
        };
        modal.addEventListener("keydown", onKeydown);
        focusTrapState.set(modal, {onKeydown});
      }
      function uninstallFocusTrap(modal){
        const s=focusTrapState.get(modal);
        if(!s) return;
        modal.removeEventListener("keydown", s.onKeydown);
        focusTrapState.delete(modal);
      }

      /* ---------------------- Scroll progress ---------------------- */
      function initProgress(){
        const bar=$("#scroll-progress");
        if(!bar) return;
        let ticking=false;
        const onScroll=()=>{
          if(ticking) return;
          ticking=true;
          requestAnimationFrame(()=>{
            const doc=document.documentElement;
            const max=doc.scrollHeight - doc.clientHeight;
            const p=max<=0 ? 0 : (doc.scrollTop/max)*100;
            bar.style.width = p+"%";
            ticking=false;
          });
        };
        window.addEventListener("scroll", onScroll, {passive:true});
        onScroll();
      }

      /* ---------------------- Reveal observer ---------------------- */
      function initReveal(){
        const els=$$(".reveal");
        if(!els.length) return;
        const io=new IntersectionObserver((entries)=>{
          entries.forEach(e=>{
            if(e.isIntersecting) e.target.classList.add("is-visible");
          });
        },{threshold:0.12});
        els.forEach(el=>io.observe(el));
      }

      /* ---------------------- Wallet-like particles ---------------------- */
      function createParticles(){
        const container = document.getElementById("particles-container");
        if(!container) return;
        const particleCount = 28;
        for(let i=0;i<particleCount;i++){
          const particle = document.createElement("span");
          const size = 24 + (i % 5) * 12;
          particle.className = "absolute rounded-full opacity-20 blur-2xl particle";
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.background = (i % 3) ? "var(--accent)" : "#4f46e5";
          particle.style.left = `${Math.random() * 100}%`;
          particle.style.top = `${Math.random() * 100}%`;
          particle.style.animationDuration = `${10 + (i % 5)}s`;
          particle.style.animationDelay = `${i * 0.2}s`;
          container.appendChild(particle);
        }
      }

      /* ---------------------- Data access ---------------------- */
      function industryLabel(code){
        switch(code){
          case "dev": return "Programista";
          case "gfx": return "Grafik";
          case "video": return "Montażysta / Content";
          case "tech": return "Technik / DevOps";
          case "mc": return "Budowniczy Minecraft";
          default: return "Freelancer";
        }
      }

      function getAllProfiles(){
        const profiles = LS.getProfiles() || [];
        const me = LS.getMe();
        const subs = LS.getSubs();

        let list = profiles.slice();
        if(me && me.listing?.published){
          const meProfile = {
            id: me.id || "me",
            name: me.name || "Me",
            industry: me.industry || "dev",
            industryLabel: industryLabel(me.industry || "dev"),
            tagline: me.listing?.title || "Ogłoszenie",
            about: me.listing?.long || me.about || "",
            rating: 4.9,
            availableIn: me.availability || "48h",
            minBudget: Number(me.minBudget || 0) || 0,
            location: "Online",
            premium: !!subs.premium,
            verified: !!subs.verified,
            avatar: me.avatar || "",
            portfolio: (me.portfolio || ["","",""]).filter(Boolean).length ? me.portfolio : [
              "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
              "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
              "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
            ],
            createdAt: now() - 1000*60*60*24*1
          };
          list = list.filter(p=>p.id!==meProfile.id);
          list.unshift(meProfile);
        }
        return list;
      }

      function matchesBudget(p){
        const min = state.budgetMin;
        const max = state.budgetMax;
        const b = Number(p.minBudget || 0) || 0;
        if(min != null && b < min) return false;
        if(max != null && b > max) return false;
        return true;
      }

      function matchesSearch(p){
        const q = normalizeText(state.q).trim();
        if(!q) return true;
        const hay = normalizeText([p.name, p.tagline, p.industryLabel, p.about].filter(Boolean).join(" "));
        return hay.includes(q);
      }

      function getFilteredProfiles(){
        const all = getAllProfiles();
        const savedSet = LS.getSaved();
        let list = all.filter(p=>{
          if(state.industry !== "all" && p.industry !== state.industry) return false;
          if(state.premiumOnly && !p.premium) return false;
          if(state.verifiedOnly && !p.verified) return false;
          if(state.availableOnly && parseAvailableHours(p.availableIn) > 72) return false;
          if(state.savedOnly && !savedSet.has(p.id)) return false;
          if(!matchesBudget(p)) return false;
          if(!matchesSearch(p)) return false;
          return true;
        });

        if(state.sort === "newest"){
          list.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
        }else if(state.sort === "rating"){
          list.sort((a,b)=>(Number(b.rating||0)-Number(a.rating||0)));
        }else if(state.sort === "verified"){
          list.sort((a,b)=>{
            const av = a.verified?1:0, bv=b.verified?1:0;
            if(bv!==av) return bv-av;
            return scoreRecommended(b)-scoreRecommended(a);
          });
        }else{
          list.sort((a,b)=>scoreRecommended(b)-scoreRecommended(a));
        }

        return list;
      }

      /* ---------------------- Rendering ---------------------- */
      function formatMoney(n){
        const v = Number(n||0);
        if(!Number.isFinite(v) || v<=0) return "";
        return `${v} PLN`;
      }

      function isSaved(id){
        return LS.getSaved().has(id);
      }

      function profileCardHTML(p){
        const settings = LS.getSettings();
        const saved = isSaved(p.id);

        const tagsLine = [];
        if(!settings.hideRating) tagsLine.push(`<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${escapeHTML(String(p.rating ?? "—"))}</span>`);
        tagsLine.push(`<span class="chip"><i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: ${escapeHTML(p.availableIn||"—")}</span>`);
        tagsLine.push(`<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.location||"Online")}</span>`);
        if(!settings.hideBudget && p.minBudget){
          tagsLine.push(`<span class="chip"><i data-lucide="banknote" class="h-3.5 w-3.5 text-[var(--accent)]"></i> od ${escapeHTML(formatMoney(p.minBudget))}</span>`);
        }

        const badges = [
          p.verified ? `<span class="badge badge-verified"><i data-lucide="badge-check" class="h-3.5 w-3.5"></i> Verified</span>` : "",
          p.premium ? `<span class="badge badge-premium"><i data-lucide="zap" class="h-3.5 w-3.5"></i> Premium</span>` : ""
        ].join("");

        const portfolio = (p.portfolio||[]).slice(0,3);
        const thumbs = portfolio.map((src,i)=>`
          <div class="thumb aspect-[16/10]">
            <img src="${escapeHTML(src)}" alt="Portfolio ${i+1}" loading="lazy" />
          </div>
        `).join("");

        return `
          <article class="profile-card p-4 md:p-5">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div class="flex items-center gap-3 min-w-0">
                <div class="avatar">
                  <img src="${escapeHTML(p.avatar||"")}" alt="${escapeHTML(p.name)}" loading="lazy" />
                </div>
                <div class="min-w-0">
                  <div class="flex items-center gap-2 flex-wrap">
                    <div class="text-lg font-black tracking-tight truncate">${escapeHTML(p.name)}</div>
                    ${badges ? `<div class="flex items-center gap-2">${badges}</div>` : ""}
                  </div>
                  <div class="text-sm text-white/70 truncate">${escapeHTML(p.tagline||"")}</div>
                  <div class="text-xs text-white/55 mt-1">${escapeHTML(p.industryLabel||industryLabel(p.industry))}</div>
                </div>
              </div>

              <div class="flex items-center gap-2 md:justify-end">
                <button class="btn btn-ghost px-3 py-2 text-sm" type="button" data-action="save" data-id="${escapeHTML(p.id)}" aria-pressed="${saved ? "true":"false"}">
                  <i data-lucide="bookmark" class="h-4 w-4"></i>
                  <span>${saved ? "Zapisano":"Zapisz"}</span>
                </button>
                <button class="btn btn-outline px-3 py-2 text-sm" type="button" data-action="open" data-id="${escapeHTML(p.id)}">
                  <i data-lucide="external-link" class="h-4 w-4"></i>
                  <span>Otwórz</span>
                </button>
              </div>
            </div>

            <div class="mt-4 flex flex-wrap gap-2">
              ${tagsLine.join("")}
            </div>

            <div class="mt-4 grid grid-cols-3 gap-2">
              ${thumbs || `<div class="col-span-3 text-sm text-white/55">Brak portfolio</div>`}
            </div>
          </article>
        `;
      }

      function updateStats(list){
        const savedCount = LS.getSaved().size;
        $("#stat-saved").textContent = String(savedCount);
        $("#stat-results").textContent = String(list.length);
        $("#stat-filters").textContent = String(countActiveFilters());
        $("#results-hint").textContent = list.length ? `Znaleziono: ${list.length}` : "Brak wyników";

        $("#total-count").textContent = String(list.length);
        $("#shown-count").textContent = String(Math.min(state.shown, list.length));

        $("#saved-pill").textContent = String(savedCount);
        $("#saved-pill-m").textContent = String(savedCount);
        $("#m-saved-count").textContent = String(savedCount);
      }

      function sortLabel(v){
        switch(v){
          case "newest": return "Najnowsze";
          case "rating": return "Ocena";
          case "verified": return "Zweryfikowani";
          default: return "Polecane";
        }
      }

      function countActiveFilters(){
        let c=0;
        if(state.q.trim()) c++;
        if(state.industry!=="all") c++;
        if(state.sort!=="recommended") c++;
        if(state.savedOnly) c++;
        if(state.premiumOnly) c++;
        if(state.verifiedOnly) c++;
        if(state.availableOnly) c++;
        if(state.budgetMin!=null) c++;
        if(state.budgetMax!=null) c++;
        return c;
      }

      function renderActiveFilters(){
        const wrap=$("#active-filters");
        if(!wrap) return;

        const pills=[];
        const addPill=(key,label)=>{
          pills.push(`
            <span class="pill" data-key="${escapeHTML(key)}">
              ${escapeHTML(label)}
              <button type="button" aria-label="Usuń filtr" data-action="remove-pill" data-key="${escapeHTML(key)}">
                <i data-lucide="x" class="h-3.5 w-3.5"></i>
              </button>
            </span>
          `);
        };

        if(state.q.trim()) addPill("q", `Szukaj: ${state.q.trim().slice(0,18)}${state.q.trim().length>18?"…":""}`);
        if(state.industry!=="all") addPill("industry", `Branża: ${industryLabel(state.industry)}`);
        if(state.sort!=="recommended") addPill("sort", `Sort: ${sortLabel(state.sort)}`);
        if(state.savedOnly) addPill("saved", "Zapisane");
        if(state.premiumOnly) addPill("premium", "Premium");
        if(state.verifiedOnly) addPill("verified", "Verified");
        if(state.availableOnly) addPill("avail", "≤72h");
        if(state.budgetMin!=null) addPill("bmin", `Budżet ≥ ${state.budgetMin}`);
        if(state.budgetMax!=null) addPill("bmax", `Budżet ≤ ${state.budgetMax}`);

        wrap.innerHTML = pills.join("");
        wrap.classList.toggle("hidden", pills.length===0);
      }

      function renderList(resetShown=true){
        const list = getFilteredProfiles();
        if(resetShown){
          state.shown = Math.min(state.pageSize, list.length);
        }

        updateStats(list);
        renderActiveFilters();

        const container=$("#profiles-list");
        if(!container) return;

        if(!list.length){
          container.innerHTML = `
            <div class="glass rounded-[26px] p-6 text-white/70">
              <div class="flex items-start gap-3">
                <i data-lucide="search-x" class="h-5 w-5 text-[var(--accent)] mt-0.5"></i>
                <div>
                  <div class="font-black text-white">Brak wyników</div>
                  <div class="text-sm text-white/65 mt-1">Spróbuj zmienić filtry lub wyczyścić wyszukiwanie.</div>
                  <button id="btn-empty-reset" class="mt-4 btn btn-outline px-4 py-3" type="button">
                    <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                    Wyczyść filtry
                  </button>
                </div>
              </div>
            </div>
          `;
          $("#btn-load-more").disabled = true;
          $("#btn-load-more").classList.add("opacity-50","pointer-events-none");
          try{ lucide.createIcons(); }catch{}
          $("#btn-empty-reset")?.addEventListener("click", resetFilters);
          return;
        }

        const shownList = list.slice(0, state.shown);
        container.innerHTML = shownList.map(profileCardHTML).join("");

        const canMore = state.shown < list.length;
        $("#btn-load-more").disabled = !canMore;
        $("#btn-load-more").classList.toggle("opacity-50", !canMore);
        $("#btn-load-more").classList.toggle("pointer-events-none", !canMore);

        $$("#profiles-list [data-action='open']").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const id=btn.getAttribute("data-id");
            openProfileModalById(id, getFilteredProfiles());
          });
        });
        $$("#profiles-list [data-action='save']").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const id=btn.getAttribute("data-id");
            toggleSaved(id);
            renderList(false);
          });
        });

        try{ lucide.createIcons(); }catch{}
      }

      /* ---------------------- Saved ---------------------- */
      function toggleSaved(id){
        const set = LS.getSaved();
        if(set.has(id)){
          set.delete(id);
          LS.setSaved(set);
          notify("Usunięto z zapisanych", "bookmark-x");
        }else{
          set.add(id);
          LS.setSaved(set);
          notify("Zapisano profil", "bookmark");
        }
      }

      /* ---------------------- Modal ---------------------- */
      function setModalContent(p){
        $("#modal-avatar").src = p.avatar || "";
        $("#modal-name").textContent = p.name || "Profil";
        const badges=[];
        if(p.verified) badges.push(`<span class="badge badge-verified"><i data-lucide="badge-check" class="h-3.5 w-3.5"></i> Verified</span>`);
        if(p.premium) badges.push(`<span class="badge badge-premium"><i data-lucide="zap" class="h-3.5 w-3.5"></i> Premium</span>`);
        $("#modal-badges").innerHTML = badges.join("");

        const sub = `${p.industryLabel || industryLabel(p.industry)} • ${p.location||"Online"} • ${p.availableIn||"—"}${p.minBudget?` • od ${formatMoney(p.minBudget)}`:""}`;
        $("#modal-sub").textContent = sub;

        const chips=[];
        if(!LS.getSettings().hideRating) chips.push(`<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${escapeHTML(String(p.rating ?? "—"))}</span>`);
        chips.push(`<span class="chip"><i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.availableIn||"—")}</span>`);
        chips.push(`<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(p.location||"Online")}</span>`);
        if(!LS.getSettings().hideBudget && p.minBudget) chips.push(`<span class="chip"><i data-lucide="banknote" class="h-3.5 w-3.5 text-[var(--accent)]"></i> od ${escapeHTML(formatMoney(p.minBudget))}</span>`);
        $("#modal-chips").innerHTML = chips.join("");

        const portfolio=(p.portfolio||[]).slice(0,3);
        $("#modal-portfolio").innerHTML = portfolio.map((src,i)=>`
          <div class="thumb aspect-[16/10]">
            <img src="${escapeHTML(src)}" alt="Portfolio ${i+1}" />
          </div>
        `).join("");

        $("#modal-about").textContent = p.about || "";

        const saved=isSaved(p.id);
        const b=$("#btn-save-from-modal");
        b.innerHTML = `<i data-lucide="bookmark" class="h-4 w-4"></i> ${saved ? "Zapisano" : "Zapisz"}`;
        b.setAttribute("aria-pressed", saved ? "true" : "false");

        try{ lucide.createIcons(); }catch{}
      }

      function openProfileModalById(id, listForModal){
        const fullList = listForModal && listForModal.length ? listForModal : getFilteredProfiles();
        state.modalList = fullList;
        const idx = fullList.findIndex(p=>p.id===id);
        state.modalIndex = idx >= 0 ? idx : 0;
        const p = fullList[state.modalIndex];
        if(!p) return;

        state.lastFocus = document.activeElement;
        setModalContent(p);
        setModalOpen(true);

        const url = new URL(window.location.href);
        url.hash = `profile=${encodeURIComponent(p.id)}`;
        history.replaceState(null, "", url.toString());
      }

      function closeProfileModal(){
        const url = new URL(window.location.href);
        url.hash = "katalog";
        history.replaceState(null, "", url.toString());
        setModalOpen(false);
      }

      function modalGo(delta){
        if(!state.modalOpen) return;
        const list=state.modalList || [];
        if(!list.length) return;
        state.modalIndex = (state.modalIndex + delta + list.length) % list.length;
        const p=list[state.modalIndex];
        setModalContent(p);

        const url = new URL(window.location.href);
        url.hash = `profile=${encodeURIComponent(p.id)}`;
        history.replaceState(null, "", url.toString());
      }

      function tryOpenFromHash(){
        const h = window.location.hash || "";
        if(!h.startsWith("#profile=")) return false;
        const id = decodeURIComponent(h.replace("#profile=",""));
        const list = getFilteredProfiles();
        const found = list.find(p=>p.id===id) || getAllProfiles().find(p=>p.id===id);
        if(found){
          openProfileModalById(found.id, list);
          return true;
        }
        return false;
      }

      /* ---------------------- Filters bindings ---------------------- */
      function syncFilterUI(){
        $("#search-input").value = state.q;
        $("#industry-select").value = state.industry;
        $("#sort-select").value = state.sort;
        $("#budget-min").value = state.budgetMin ?? "";
        $("#budget-max").value = state.budgetMax ?? "";

        const setChip = (id, on)=>{
          const el=$(id);
          if(!el) return;
          el.dataset.active = on ? "true" : "false";
          el.setAttribute("aria-pressed", on ? "true":"false");
        };
        setChip("#filter-saved", state.savedOnly);
        setChip("#filter-premium", state.premiumOnly);
        setChip("#filter-verified", state.verifiedOnly);
        setChip("#filter-available", state.availableOnly);
      }

      function resetFilters(){
        state.q="";
        state.industry="all";
        state.sort="recommended";
        state.savedOnly=false;
        state.premiumOnly=false;
        state.verifiedOnly=false;
        state.availableOnly=false;
        state.budgetMin=null;
        state.budgetMax=null;
        syncFilterUI();
        renderList(true);
        notify("Wyczyszczono filtry", "rotate-ccw");
      }

      function bindFilters(){
        const onSearch = debounce((e)=>{
          state.q = e.target.value || "";
          renderList(true);
        }, 180);

        $("#search-input")?.addEventListener("input", onSearch);

        $("#industry-select")?.addEventListener("change",(e)=>{
          state.industry = e.target.value;
          renderList(true);
        });

        $("#sort-select")?.addEventListener("change",(e)=>{
          state.sort = e.target.value;
          renderList(true);
        });

        $("#filter-saved")?.addEventListener("click", ()=>{
          state.savedOnly = !state.savedOnly;
          syncFilterUI();
          renderList(true);
        });
        $("#filter-premium")?.addEventListener("click", ()=>{
          state.premiumOnly = !state.premiumOnly;
          syncFilterUI();
          renderList(true);
        });
        $("#filter-verified")?.addEventListener("click", ()=>{
          state.verifiedOnly = !state.verifiedOnly;
          syncFilterUI();
          renderList(true);
        });
        $("#filter-available")?.addEventListener("click", ()=>{
          state.availableOnly = !state.availableOnly;
          syncFilterUI();
          renderList(true);
        });

        $("#budget-min")?.addEventListener("input", debounce((e)=>{
          const v = e.target.value.trim();
          state.budgetMin = v==="" ? null : Math.max(0, Number(v));
          renderList(true);
        }, 150));

        $("#budget-max")?.addEventListener("input", debounce((e)=>{
          const v = e.target.value.trim();
          state.budgetMax = v==="" ? null : Math.max(0, Number(v));
          renderList(true);
        }, 150));

        $$("[data-budget-preset]").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const v = Number(btn.getAttribute("data-budget-preset")||"0");
            if(v<=0){
              state.budgetMax = null;
              $("#budget-max").value = "";
            }else{
              state.budgetMax = v;
              $("#budget-max").value = String(v);
            }
            renderList(true);
          });
        });

        $("#btn-reset-filters")?.addEventListener("click", resetFilters);

        $("#active-filters")?.addEventListener("click", (e)=>{
          const t=e.target.closest("[data-action='remove-pill']");
          if(!t) return;
          const key = t.getAttribute("data-key");
          if(!key) return;
          switch(key){
            case "q": state.q=""; break;
            case "industry": state.industry="all"; break;
            case "sort": state.sort="recommended"; break;
            case "saved": state.savedOnly=false; break;
            case "premium": state.premiumOnly=false; break;
            case "verified": state.verifiedOnly=false; break;
            case "avail": state.availableOnly=false; break;
            case "bmin": state.budgetMin=null; break;
            case "bmax": state.budgetMax=null; break;
          }
          syncFilterUI();
          renderList(true);
        });

        $("#btn-load-more")?.addEventListener("click", ()=>{
          const list=getFilteredProfiles();
          state.shown = Math.min(state.shown + state.pageSize, list.length);
          renderList(false);
        });
      }

      /* ---------------------- Header / Mobile binds ---------------------- */
      function bindHeader(){
        const focusSearch = ()=>{
          $("#search-input")?.scrollIntoView({behavior:"smooth", block:"center"});
          setTimeout(()=>$("#search-input")?.focus(), 120);
        };

        $("#btn-jump-search")?.addEventListener("click", focusSearch);
        $("#m-search")?.addEventListener("click", focusSearch);

        const toggleSavedFilter = ()=>{
          state.savedOnly = !state.savedOnly;
          syncFilterUI();
          renderList(true);
          notify(state.savedOnly ? "Pokazuję zapisane" : "Wyłączono filtr zapisane", "bookmark");
        };

        $("#btn-open-saved")?.addEventListener("click", toggleSavedFilter);
        $("#btn-open-saved-m")?.addEventListener("click", toggleSavedFilter);
        $("#m-saved")?.addEventListener("click", toggleSavedFilter);

        const openPanel=()=>setPanelOpen(true);
        $("#btn-open-panel")?.addEventListener("click", openPanel);
        $("#btn-open-panel-m")?.addEventListener("click", openPanel);
        $("#btn-open-panel-inline")?.addEventListener("click", openPanel);
        $("#m-account")?.addEventListener("click", openPanel);

        $("#btn-close-panel")?.addEventListener("click", ()=>setPanelOpen(false));

        $("#overlay")?.addEventListener("click", ()=>{
          if(state.modalOpen) closeProfileModal();
          else if($("#user-panel")?.dataset.open==="true") setPanelOpen(false);
        });

        document.addEventListener("keydown", (e)=>{
          if(e.key==="Escape"){
            if(state.modalOpen) closeProfileModal();
            else if($("#user-panel")?.dataset.open==="true") setPanelOpen(false);
          }

          const s=LS.getSettings();
          if(s.slash && e.key==="/" && !e.ctrlKey && !e.metaKey && !e.altKey){
            const tag = (document.activeElement?.tagName || "").toLowerCase();
            const isTyping = tag==="input" || tag==="textarea" || tag==="select";
            if(!isTyping){
              e.preventDefault();
              $("#search-input")?.focus();
            }
          }

          if(state.modalOpen){
            if(e.key==="ArrowLeft") modalGo(-1);
            if(e.key==="ArrowRight") modalGo(1);
          }
        }, {passive:false});
      }

      /* ---------------------- Modal binds ---------------------- */
      function bindModal(){
        $("#modal-close")?.addEventListener("click", closeProfileModal);
        $("#modal-prev")?.addEventListener("click", ()=>modalGo(-1));
        $("#modal-next")?.addEventListener("click", ()=>modalGo(1));

        $("#btn-copy-name")?.addEventListener("click", async ()=>{
          const name = $("#modal-name")?.textContent || "";
          try{
            await navigator.clipboard.writeText(name);
            notify("Skopiowano nick", "copy");
          }catch{
            notify("Nie udało się skopiować", "alert-triangle");
          }
        });

        $("#btn-save-from-modal")?.addEventListener("click", ()=>{
          const list=state.modalList||[];
          const p=list[state.modalIndex];
          if(!p) return;
          toggleSaved(p.id);
          setModalContent(p);
          renderList(false);
        });
      }

      /* ---------------------- Panel tabs ---------------------- */
      function bindPanelTabs(){
        const panel=$("#user-panel");
        if(!panel) return;

        const navBtns = $$("#user-panel [data-tab]");

        const setTab=(tab)=>{
          navBtns.forEach(b=>{
            const active = b.getAttribute("data-tab")===tab;
            b.classList.toggle("bg-white/10", active);
            b.classList.toggle("font-semibold", active);
            b.classList.toggle("text-white", active);
            b.classList.toggle("text-white/70", !active);

            const icon = b.querySelector("i[data-lucide]");
            if(icon){
              icon.classList.toggle("text-[var(--accent)]", active);
            }
          });

          ["edit","preview","listing","shop","settings","security"].forEach(t=>{
            const sec=$("#tab-"+t);
            if(sec) sec.classList.toggle("hidden", t!==tab);
          });

          if(tab==="preview") renderPreviewCard();
          if(tab==="settings") syncSettingsUI();
          try{ lucide.createIcons(); }catch{}
        };

        navBtns.forEach(btn=>{
          btn.addEventListener("click", ()=>setTab(btn.getAttribute("data-tab")));
        });

        setTab("edit");
      }

      function setSaveStatus(txt){
        const el=$("#save-status");
        if(el) el.textContent = txt;
      }

      function updatePlanUI(){
        const subs=LS.getSubs();
        const planEl=$("#plan-status");
        const p=[];
        if(subs.premium) p.push("Premium");
        if(subs.verified) p.push("Verified");
        planEl.textContent = p.length ? p.join(" + ") : "Standard";
      }

      function renderPreviewCard(){
        const me=LS.getMe();
        const subs=LS.getSubs();
        if(!me) return;
        const meProfile = {
          id: me.id || "me",
          name: me.name || "Me",
          industry: me.industry || "dev",
          industryLabel: industryLabel(me.industry || "dev"),
          tagline: me.listing?.title || "Ogłoszenie",
          about: me.listing?.long || me.about || "",
          rating: 4.9,
          availableIn: me.availability || "48h",
          minBudget: Number(me.minBudget || 0) || 0,
          location: "Online",
          premium: !!subs.premium,
          verified: !!subs.verified,
          avatar: me.avatar || "",
          portfolio: (me.portfolio || ["","",""]).filter(Boolean).length ? me.portfolio : [
            "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
          ],
          createdAt: now()
        };
        $("#preview-card").innerHTML = profileCardHTML(meProfile);
        try{ lucide.createIcons(); }catch{}

        $("#preview-card [data-action='open']")?.addEventListener("click", ()=>{
          openProfileModalById(meProfile.id, getFilteredProfiles());
        });
        $("#preview-card [data-action='save']")?.addEventListener("click", ()=>{
          toggleSaved(meProfile.id);
          renderPreviewCard();
          renderList(false);
        });
      }

      function fillPanelFromMe(){
        const me=LS.getMe();
        if(!me) return;
        $("#panel-avatar").src = me.avatar || "";
        $("#panel-username").textContent = me.name || "Użytkownik";

        $("#edit-name").value = me.name || "";
        $("#edit-industry").value = me.industry || "dev";
        $("#edit-about").value = me.about || "";
        $("#edit-availability").value = me.availability || "48h";
        $("#edit-budget").value = String(me.minBudget ?? "");
        $("#edit-tags").value = (me.tags || []).join(", ");
        $("#edit-avatar-url").value = me.avatar || "";

        $("#edit-portfolio-1").value = me.portfolio?.[0] || "";
        $("#edit-portfolio-2").value = me.portfolio?.[1] || "";
        $("#edit-portfolio-3").value = me.portfolio?.[2] || "";

        $("#listing-title").value = me.listing?.title || "";
        $("#listing-contact-main").value = me.listing?.contactMain || "Discord";
        $("#listing-short").value = me.listing?.short || "";
        $("#listing-long").value = me.listing?.long || "";
      }

      const autosave = debounce(()=>{
        const me=LS.getMe();
        if(!me) return;

        const name=$("#edit-name").value.trim();
        const industry=$("#edit-industry").value;
        const about=$("#edit-about").value;
        const avail=$("#edit-availability").value;
        const budget = Number($("#edit-budget").value || 0);
        const tags = $("#edit-tags").value.split(",").map(s=>s.trim()).filter(Boolean).slice(0,12);
        const avatarUrl=$("#edit-avatar-url").value.trim();

        const p1=$("#edit-portfolio-1").value.trim();
        const p2=$("#edit-portfolio-2").value.trim();
        const p3=$("#edit-portfolio-3").value.trim();

        me.name = name || me.name;
        me.industry = industry || me.industry;
        me.about = about;
        me.availability = avail;
        me.minBudget = Number.isFinite(budget) ? budget : me.minBudget;
        me.tags = tags;
        if(avatarUrl) me.avatar = avatarUrl;
        me.portfolio = [p1,p2,p3];

        me.listing = me.listing || {};
        me.listing.title = $("#listing-title").value;
        me.listing.contactMain = $("#listing-contact-main").value;
        me.listing.short = $("#listing-short").value;
        me.listing.long = $("#listing-long").value;

        LS.setMe(me);
        setSaveStatus("Zapisano automatycznie");
        setTimeout(()=>setSaveStatus("Wszystko zapisane"), 900);

        $("#panel-avatar").src = me.avatar || "";
        $("#panel-username").textContent = me.name || "Użytkownik";

        renderList(false);
      }, 350);

      function bindPanelForms(){
        [
          "edit-name","edit-industry","edit-about","edit-availability","edit-budget","edit-tags","edit-avatar-url",
          "edit-portfolio-1","edit-portfolio-2","edit-portfolio-3",
          "listing-title","listing-contact-main","listing-short","listing-long"
        ].forEach(id=>{
          $("#"+id)?.addEventListener("input", ()=>{
            setSaveStatus("Edytujesz…");
            autosave();
          });
          $("#"+id)?.addEventListener("change", ()=>{
            setSaveStatus("Edytujesz…");
            autosave();
          });
        });

        $("#btn-save-profile")?.addEventListener("click", ()=>{
          notify("Zapisano profil", "save");
          renderPreviewCard();
          renderList(false);
        });

        $("#btn-reset-profile")?.addEventListener("click", ()=>{
          fillPanelFromMe();
          notify("Przywrócono wartości", "rotate-ccw");
        });

        $("#btn-open-me-modal")?.addEventListener("click", ()=>{
          openProfileModalById("me", getFilteredProfiles());
        });

        $("#btn-publish")?.addEventListener("click", ()=>{
          const me=LS.getMe();
          if(!me) return;
          me.listing = me.listing || {};
          me.listing.published = true;
          LS.setMe(me);
          notify("Opublikowano ogłoszenie", "rocket");
          renderList(false);
        });

        $("#btn-unpublish")?.addEventListener("click", ()=>{
          const me=LS.getMe();
          if(!me) return;
          me.listing = me.listing || {};
          me.listing.published = false;
          LS.setMe(me);
          notify("Ukryto ogłoszenie", "eye-off");
          renderList(false);
        });

        $("#btn-buy-premium")?.addEventListener("click", ()=>{
          const subs=LS.getSubs();
          subs.premium = true;
          LS.setSubs(subs);
          notify("Aktywowano Premium", "zap");
          updatePlanUI();
          renderList(false);
          renderPreviewCard();
        });
        $("#btn-cancel-premium")?.addEventListener("click", ()=>{
          const subs=LS.getSubs();
          subs.premium = false;
          LS.setSubs(subs);
          notify("Wyłączono Premium", "x-circle");
          updatePlanUI();
          renderList(false);
          renderPreviewCard();
        });
        $("#btn-buy-verified")?.addEventListener("click", ()=>{
          const subs=LS.getSubs();
          subs.verified = true;
          LS.setSubs(subs);
          notify("Aktywowano Verified", "badge-check");
          updatePlanUI();
          renderList(false);
          renderPreviewCard();
        });
        $("#btn-cancel-verified")?.addEventListener("click", ()=>{
          const subs=LS.getSubs();
          subs.verified = false;
          LS.setSubs(subs);
          notify("Wyłączono Verified", "x-circle");
          updatePlanUI();
          renderList(false);
          renderPreviewCard();
        });
      }

      /* ---------------------- Settings ---------------------- */
      function syncSettingsUI(){
        const s=LS.getSettings();
        $("#set-toast").checked = !!s.toast;
        $("#set-slash").checked = !!s.slash;
        $("#set-hide-budget").checked = !!s.hideBudget;
        $("#set-hide-rating").checked = !!s.hideRating;
        $("#set-focus-trap").checked = !!s.focusTrap;
      }

      function bindSettings(){
        const apply=()=>{
          const s={
            toast: $("#set-toast").checked,
            slash: $("#set-slash").checked,
            hideBudget: $("#set-hide-budget").checked,
            hideRating: $("#set-hide-rating").checked,
            focusTrap: $("#set-focus-trap").checked
          };
          LS.setSettings(s);
          notify("Zapisano ustawienia", "settings");
          renderList(false);
          if(state.modalOpen){
            const p = state.modalList?.[state.modalIndex];
            if(p) setModalContent(p);
          }
        };

        ["set-toast","set-slash","set-hide-budget","set-hide-rating","set-focus-trap"].forEach(id=>{
          $("#"+id)?.addEventListener("change", apply);
        });

        $("#btn-reset-settings")?.addEventListener("click", ()=>{
          LS.setSettings({toast:true, slash:true, hideBudget:false, hideRating:false, focusTrap:true});
          syncSettingsUI();
          notify("Przywrócono ustawienia", "rotate-ccw");
          renderList(false);
        });
      }

      /* ---------------------- Boot ---------------------- */
      function boot(){
        ensureInit();
        bindHeaderHeightVar();

        $("#footer-year").textContent = "© " + new Date().getFullYear();
        updatePlanUI();

        // Wallet-like particles
        createParticles();

        // JWT -> VPLN + username (jak prototyp #1, opcjonalnie)
        const authToken = localStorage.getItem("authToken");
        if(authToken){
          const userData = decodeJwt(authToken);
          if(userData){
            const balEl = $("#header-vpln-balance");
            if(balEl){
              balEl.textContent = `${(userData.vplnBalance || 0).toFixed(2)} VPLN`;
            }
            const u = $("#panel-username");
            if(u && userData.username) u.textContent = userData.username;
          }
        }

        // Logout (jak prototyp #1)
        $("#logout-btn")?.addEventListener("click", (e)=>{
          e.preventDefault();
          localStorage.removeItem("authToken");
          window.location.href = "./index.html";
        });

        initProgress();
        initReveal();

        bindFilters();
        bindHeader();
        bindModal();

        bindPanelTabs();
        fillPanelFromMe();
        bindPanelForms();
        bindSettings();

        syncFilterUI();
        renderList(true);

        setTimeout(()=>{ tryOpenFromHash(); }, 30);

        try{ lucide.createIcons(); }catch{}
      }

      document.addEventListener("DOMContentLoaded", boot);
    })();
  </script>
</body>
</html>
