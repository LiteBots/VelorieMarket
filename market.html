<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Velorie Market — Katalog ogłoszeń</title>
  <meta name="description" content="Velorie Market — katalog ogłoszeń freelancerów. Filtry i panel użytkownika." />
  <meta name="keywords" content="velorie market, freelancer, ogłoszenia, portfolio, katalog" />
  <meta name="theme-color" content="#0a1030" />

  <link rel="icon" type="image/png" href="favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --accent:#ff0354;
      --bg0:#00010f;
      --bg1:#0a1030;
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.08);
      --border: rgba(255,255,255,.10);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.56);
      --shadow: 0 10px 50px rgba(0,0,0,.45);
      --shadow2: 0 10px 40px rgba(255,3,84,.28);
      --ring: 0 0 0 1px rgba(255,255,255,.10) inset;
    }

    html { scroll-behavior: smooth; }
    body{
      background-color: var(--bg0);
      background-image:
        radial-gradient(1200px 600px at 80% -10%, var(--bg1) 0%, #050919 35%, var(--bg0) 65%, #000000 100%),
        radial-gradient(900px 500px at 15% 110%, rgba(255,3,84,.20) 0%, rgba(255,3,84,0) 60%),
        radial-gradient(800px 500px at 95% 90%, rgba(79,70,229,.20) 0%, rgba(79,70,229,0) 60%);
    }

    /* scrollbars */
    ::-webkit-scrollbar{ width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb{ background: var(--accent); border-radius: 999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.08); }

    /* progress bar */
    #scroll-progress{
      position: fixed;
      inset: 0 0 auto 0;
      height: 2px;
      width: 0%;
      background: var(--accent);
      z-index: 70;
      box-shadow: 0 10px 30px rgba(255,3,84,.35);
    }

    /* subtle noise */
    .noise::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.06;
      mix-blend-mode: overlay;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='190' height='190'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='190' height='190' filter='url(%23n)' opacity='.6'/%3E%3C/svg%3E");
      background-size: 190px 190px;
    }

    /* animated grid */
    .grid-bg{
      position:absolute;
      inset:-1px;
      pointer-events:none;
      opacity:.18;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 42px 42px;
      mask-image: radial-gradient(60% 60% at 50% 40%, black 0%, transparent 70%);
      animation: gridFloat 14s ease-in-out infinite;
    }
    @keyframes gridFloat{
      0%,100%{ transform: translateY(0px); }
      50%{ transform: translateY(10px); }
    }

    /* reveal */
    .animate-on-scroll{
      opacity: 0;
      transform: translateY(18px);
      transition: opacity .55s ease, transform .55s ease;
      will-change: opacity, transform;
    }
    .animate-on-scroll.is-visible{ opacity: 1; transform: translateY(0); }

    /* glass surfaces */
    .glass{
      background: var(--glass);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .glass-soft{
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 10px 40px rgba(0,0,0,.45);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    /* chips */
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding: .35rem .6rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      line-height: 1;
      white-space: nowrap;
      user-select:none;
    }

    /* buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.5rem;
      border-radius: 14px;
      padding: .8rem 1rem;
      font-weight: 700;
      transition: transform .15s ease, filter .15s ease, background .15s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: var(--accent);
      color: #0b0010;
      box-shadow: 0 10px 40px rgba(255,3,84,.35);
    }
    .btn-primary:hover{ filter: brightness(1.08); }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.10); }
    .btn-outline{
      background: transparent;
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
    }
    .btn-outline:hover{ background: rgba(255,255,255,.06); }

    /* badges */
    .badge-verified{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size: 12px;
      font-weight: 800;
      padding: .25rem .55rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(79,70,229,.14);
      color: rgba(255,255,255,.92);
    }
    .badge-premium{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size: 12px;
      font-weight: 800;
      padding: .25rem .55rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,3,84,.16);
      color: rgba(255,255,255,.92);
    }

    /* portfolio thumbs */
    .thumb{
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
    }
    .thumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform .35s ease;
    }
    .thumb:hover img{ transform: scale(1.07); }

    /* horizontal profile card */
    .profile-card{
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 10px 45px rgba(0,0,0,.40);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .profile-card:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.14);
    }
    .avatar{
      width: 54px;
      height: 54px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
      flex: 0 0 auto;
      background: rgba(255,255,255,.06);
    }
    .avatar img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    /* overlay + drawer */
    .overlay{
      position: fixed;
      inset: 0;
      z-index: 80;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: none;
    }
    .overlay[data-open="true"]{ display: block; }

    .drawer{
      position: fixed;
      inset: 0 0 0 auto;
      width: min(560px, 92vw);
      z-index: 95;
      transform: translateX(110%);
      transition: transform .26s ease;
      display: flex;
      flex-direction: column;
    }
    .drawer[data-open="true"]{ transform: translateX(0%); }

    .divider{
      height: 1px;
      background: rgba(255,255,255,.10);
    }

    /* inputs */
    .input{
      width: 100%;
      border-radius: 14px;
      padding: .75rem .9rem;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      outline: none;
      transition: border-color .15s ease, background .15s ease;
      -webkit-appearance:none;
      appearance:none;
    }
    .input:focus{
      border-color: rgba(255,3,84,.55);
      background: rgba(255,255,255,.08);
    }
    .label{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      margin-bottom: .35rem;
      display:block;
    }

    /* sticky filters bar */
    #filters-bar{
      position: sticky;
      top: 64px; /* header height-ish */
      z-index: 40;
    }
  </style>

  <script>
    // (opcjonalnie) Tailwind extend — bez logiki
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: { glow: "0 10px 40px rgba(255,3,84,0.45)" }
        }
      }
    };
  </script>
</head>

<body class="min-h-screen text-white selection:bg-[#ff0354]/40 selection:text-white">
  <div id="scroll-progress" aria-hidden="true"></div>

  <!-- BACKGROUND LAYERS -->
  <div class="pointer-events-none fixed inset-0 -z-10 noise">
    <div class="grid-bg"></div>
  </div>

  <!-- HEADER -->
  <header class="sticky top-0 z-50 backdrop-blur-xl bg-black/20 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-3">
      <a href="#katalog" class="flex items-center gap-3">
        <img src="https://i.imgur.com/ikYb7tH.png" alt="Velorie" class="h-10 w-10 rounded-xl ring-1 ring-white/10" />
        <div class="leading-tight">
          <div class="text-lg font-semibold tracking-tight">Velorie Market</div>
          <div class="text-xs text-white/60">Katalog ogłoszeń • Panel użytkownika</div>
        </div>
      </a>

      <div class="flex items-center gap-2">
        <button id="btn-open-panel" class="inline-flex items-center gap-2 rounded-xl bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition border border-white/10">
          <i data-lucide="user" class="h-4 w-4"></i>
          <span>Panel</span>
        </button>
      </div>
    </div>
  </header>

  <!-- OVERLAY -->
  <div id="overlay" class="overlay" data-open="false" aria-hidden="true"></div>

  <main id="katalog" class="relative py-10">
    <div class="mx-auto max-w-7xl px-4">

      <!-- TOP BAR: title -->
      <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
        <div>
          <h1 class="text-3xl md:text-4xl font-black">Katalog ogłoszeń</h1>
          <p class="text-white/60 mt-2 max-w-2xl">
            Poziome kafelki: nick/imię, avatar, branża oraz mini-portfolio. Panel (drawer) służy do edycji Twojego profilu i ogłoszenia.
          </p>
        </div>
      </div>

      <!-- FILTERS BAR (sticky, without search) -->
      <div id="filters-bar" class="mt-6">
        <div class="glass rounded-2xl p-4">
          <div class="grid lg:grid-cols-12 gap-3 items-end">
            <div class="lg:col-span-4">
              <label class="label">Branża</label>
              <select id="industry-select" class="input">
                <option value="all">Wszystkie</option>
                <option value="dev">Programista</option>
                <option value="gfx">Grafik</option>
                <option value="video">Montażysta / Content</option>
                <option value="tech">Technik / DevOps</option>
                <option value="mc">Budowniczy Minecraft</option>
              </select>
            </div>

            <div class="lg:col-span-4">
              <label class="label">Sortowanie</label>
              <select id="sort-select" class="input">
                <option value="recommended">Polecane (Premium + aktywność)</option>
                <option value="newest">Najnowsze</option>
                <option value="rating">Najlepsza ocena</option>
                <option value="verified">Zweryfikowani</option>
              </select>
            </div>

            <div class="lg:col-span-4">
              <label class="label">Filtry</label>
              <div class="flex flex-wrap gap-2">
                <button id="filter-premium" class="chip hover:bg-white/10 transition" type="button">
                  <i data-lucide="zap" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Premium
                </button>
                <button id="filter-verified" class="chip hover:bg-white/10 transition" type="button">
                  <i data-lucide="badge-check" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Weryfikacja
                </button>
                <button id="filter-available" class="chip hover:bg-white/10 transition" type="button">
                  <i data-lucide="clock-3" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny
                </button>
                <button id="btn-reset-filters" class="chip hover:bg-white/10 transition" type="button">
                  <i data-lucide="rotate-ccw" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Reset
                </button>
              </div>
            </div>
          </div>

          <div class="mt-3 flex items-center justify-between text-xs text-white/55">
            <div class="flex items-center gap-2">
              <i data-lucide="info" class="h-4 w-4"></i>
              <span>Kontakt i rozliczenia poza platformą (bez escrow).</span>
            </div>
            <button id="btn-open-panel-inline" class="text-white/80 hover:text-white underline decoration-white/20 hover:decoration-white/50 transition" type="button">
              Otwórz panel
            </button>
          </div>
        </div>
      </div>

      <!-- RESULTS -->
      <div class="mt-8 space-y-4" id="profiles-list">
        <!-- Template cards (demo) -->
        <article class="profile-card animate-on-scroll p-4 md:p-5" data-profile-id="p1">
          <div class="flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex items-center gap-3 min-w-[260px]">
              <div class="avatar">
                <img src="https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop" alt="Avatar" />
              </div>
              <div class="leading-tight">
                <div class="flex items-center gap-2 flex-wrap">
                  <div class="text-lg font-extrabold tracking-tight">zxq0</div>
                  <span class="badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>
                  <span class="badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>
                </div>
                <div class="text-sm text-white/70 font-semibold">Programista</div>
                <div class="text-xs text-white/55">React • Node • API • Automatyzacje</div>
              </div>
            </div>

            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2">
                <span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena 4.9</span>
                <span class="chip"><i data-lucide="clock" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: 48h</span>
                <span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Online</span>
                <span class="chip"><i data-lucide="wallet" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Budżet: od 300 PLN</span>
              </div>

              <div class="mt-3 grid grid-cols-3 gap-2">
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop" alt="Portfolio 1" />
                </div>
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop" alt="Portfolio 2" />
                </div>
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop" alt="Portfolio 3" />
                </div>
              </div>
            </div>

            <div class="flex md:flex-col gap-2 md:items-end">
              <button class="btn btn-ghost px-4 py-3 w-full md:w-auto btn-save" type="button">
                <i data-lucide="bookmark" class="h-4 w-4"></i>
                <span>Zapisz</span>
              </button>
            </div>
          </div>
        </article>

        <article class="profile-card animate-on-scroll p-4 md:p-5" data-profile-id="p2">
          <div class="flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex items-center gap-3 min-w-[260px]">
              <div class="avatar">
                <img src="https://images.unsplash.com/photo-1548142813-c348350df52b?q=80&w=512&auto=format&fit=crop" alt="Avatar" />
              </div>
              <div class="leading-tight">
                <div class="flex items-center gap-2 flex-wrap">
                  <div class="text-lg font-extrabold tracking-tight">Klaudia</div>
                  <span class="badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>
                </div>
                <div class="text-sm text-white/70 font-semibold">Grafik</div>
                <div class="text-xs text-white/55">Branding • UI • Miniatury • Packi</div>
              </div>
            </div>

            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2">
                <span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena 4.7</span>
                <span class="chip"><i data-lucide="clock" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: 24h</span>
              </div>

              <div class="mt-3 grid grid-cols-3 gap-2">
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=900&auto=format&fit=crop" alt="Portfolio 1" />
                </div>
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop" alt="Portfolio 2" />
                </div>
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=900&auto=format&fit=crop" alt="Portfolio 3" />
                </div>
              </div>
            </div>

            <div class="flex md:flex-col gap-2 md:items-end">
              <button class="btn btn-ghost px-4 py-3 w-full md:w-auto btn-save" type="button">
                <i data-lucide="bookmark" class="h-4 w-4"></i>
                <span>Zapisz</span>
              </button>
            </div>
          </div>
        </article>

        <article class="profile-card animate-on-scroll p-4 md:p-5" data-profile-id="p3">
          <div class="flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex items-center gap-3 min-w-[260px]">
              <div class="avatar">
                <img src="https://images.unsplash.com/photo-1603415526960-f7e0328b7cf6?q=80&w=512&auto=format&fit=crop" alt="Avatar" />
              </div>
              <div class="leading-tight">
                <div class="flex items-center gap-2 flex-wrap">
                  <div class="text-lg font-extrabold tracking-tight">kubus</div>
                  <span class="badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>
                </div>
                <div class="text-sm text-white/70 font-semibold">Technik / DevOps</div>
                <div class="text-xs text-white/55">Linux • Proxy • Security • Optymalizacja</div>
              </div>
            </div>

            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2">
                <span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena 4.8</span>
                <span class="chip"><i data-lucide="clock" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: 72h</span>
              </div>

              <div class="mt-3 grid grid-cols-3 gap-2">
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1531297484001-80022131f5a1?q=80&w=900&auto=format&fit=crop" alt="Portfolio 1" />
                </div>
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop" alt="Portfolio 2" />
                </div>
                <div class="thumb aspect-[4/3]">
                  <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop" alt="Portfolio 3" />
                </div>
              </div>
            </div>

            <div class="flex md:flex-col gap-2 md:items-end">
              <button class="btn btn-ghost px-4 py-3 w-full md:w-auto btn-save" type="button">
                <i data-lucide="bookmark" class="h-4 w-4"></i>
                <span>Zapisz</span>
              </button>
            </div>
          </div>
        </article>
      </div>

      <!-- Pagination shell -->
      <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-3 text-sm text-white/70">
        <div class="flex items-center gap-2">
          <i data-lucide="layers" class="h-4 w-4 text-[var(--accent)]"></i>
          <span>Wyświetlane: <b id="shown-count">3</b> / <b id="total-count">3</b> (demo)</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="btn-load-more" class="btn btn-ghost px-4 py-2">
            <i data-lucide="plus" class="h-4 w-4"></i>
            <span>Wczytaj więcej</span>
          </button>
        </div>
      </div>

    </div>
  </main>

  <!-- USER PANEL (drawer) -->
  <aside id="user-panel" class="drawer glass-soft" data-open="false" aria-label="Panel użytkownika">
    <div class="p-4 flex items-center justify-between gap-3 border-b border-white/10">
      <div class="flex items-center gap-3">
        <div class="avatar">
          <img id="panel-avatar" src="https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop" alt="Ty" />
        </div>
        <div class="leading-tight">
          <div class="font-extrabold tracking-tight">Panel użytkownika</div>
          <div class="text-xs text-white/60">
            <span id="panel-username">zxq0</span> • <span id="panel-status">Zalogowany (demo)</span>
          </div>
        </div>
      </div>
      <button id="btn-close-panel" class="btn btn-outline px-3 py-2">
        <i data-lucide="x" class="h-4 w-4"></i>
        <span class="hidden sm:inline">Zamknij</span>
      </button>
    </div>

    <!-- tabs -->
    <div class="p-4">
      <div class="grid grid-cols-2 gap-2">
        <button class="btn btn-ghost px-4 py-3" data-tab="edit">
          <i data-lucide="pencil" class="h-4 w-4"></i>
          <span>Edytuj profil</span>
        </button>
        <button class="btn btn-ghost px-4 py-3" data-tab="preview">
          <i data-lucide="eye" class="h-4 w-4"></i>
          <span>Podgląd</span>
        </button>
        <button class="btn btn-ghost px-4 py-3" data-tab="listing">
          <i data-lucide="file-plus" class="h-4 w-4"></i>
          <span>Ogłoszenie</span>
        </button>
        <button class="btn btn-primary px-4 py-3" data-tab="shop">
          <i data-lucide="shopping-bag" class="h-4 w-4"></i>
          <span>Sklep</span>
        </button>
      </div>
    </div>

    <div class="divider"></div>

    <!-- tab content -->
    <div class="p-4 space-y-4 overflow-auto" style="height: calc(100vh - 190px);">
      <!-- EDIT PROFILE -->
      <section id="tab-edit" class="space-y-4">
        <div class="glass rounded-2xl p-5">
          <div class="font-bold flex items-center gap-2">
            <i data-lucide="pencil" class="h-5 w-5 text-[var(--accent)]"></i>
            Edytuj profil
          </div>

          <div class="mt-4 grid sm:grid-cols-2 gap-3">
            <div>
              <label class="label">Nick / Imię</label>
              <input id="edit-name" class="input" value="zxq0" />
            </div>
            <div>
              <label class="label">Branża</label>
              <select id="edit-industry" class="input">
                <option value="dev" selected>Programista</option>
                <option value="gfx">Grafik</option>
                <option value="video">Montażysta / Content</option>
                <option value="tech">Technik / DevOps</option>
                <option value="mc">Budowniczy Minecraft</option>
              </select>
            </div>

            <div class="sm:col-span-2">
              <label class="label">Opis</label>
              <textarea id="edit-about" class="input" rows="5" placeholder="Napisz kilka zdań o sobie..."></textarea>
            </div>

            <div>
              <label class="label">Dostępność</label>
              <select id="edit-availability" class="input">
                <option>24h</option>
                <option selected>48h</option>
                <option>72h</option>
                <option>Tydzień</option>
              </select>
            </div>

            <div>
              <label class="label">Budżet minimalny (PLN)</label>
              <input id="edit-budget" class="input" type="number" value="300" />
            </div>

            <div class="sm:col-span-2">
              <label class="label">Tagi (oddziel przecinkami)</label>
              <input id="edit-tags" class="input" value="React, Node, API, Automatyzacje" />
            </div>

            <div class="sm:col-span-2">
              <label class="label">Link do avatara (URL)</label>
              <input id="edit-avatar-url" class="input" placeholder="https://..." />
            </div>
          </div>

          <div class="mt-4 flex items-center gap-2">
            <button id="btn-save-profile" class="btn btn-primary px-4 py-3">
              <i data-lucide="save" class="h-4 w-4"></i>
              <span>Zapisz zmiany</span>
            </button>
            <button id="btn-reset-profile" class="btn btn-ghost px-4 py-3">
              <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
              <span>Przywróć</span>
            </button>
          </div>
        </div>

        <div class="glass rounded-2xl p-5">
          <div class="font-bold flex items-center gap-2">
            <i data-lucide="images" class="h-5 w-5 text-[var(--accent)]"></i>
            Portfolio (3 zdjęcia)
          </div>
          <p class="mt-2 text-sm text-white/70">
            2–3 zdjęcia widoczne w kafelku (mini-portfolio).
          </p>

          <div class="mt-4 grid grid-cols-3 gap-3">
            <div>
              <label class="label">Zdjęcie 1 URL</label>
              <input id="edit-portfolio-1" class="input" placeholder="https://..." />
            </div>
            <div>
              <label class="label">Zdjęcie 2 URL</label>
              <input id="edit-portfolio-2" class="input" placeholder="https://..." />
            </div>
            <div>
              <label class="label">Zdjęcie 3 URL</label>
              <input id="edit-portfolio-3" class="input" placeholder="https://..." />
            </div>
          </div>
        </div>
      </section>

      <!-- PREVIEW -->
      <section id="tab-preview" class="space-y-4 hidden">
        <div class="glass rounded-2xl p-5">
          <div class="font-bold flex items-center gap-2">
            <i data-lucide="eye" class="h-5 w-5 text-[var(--accent)]"></i>
            Podgląd profilu (kafelek)
          </div>
          <p class="mt-2 text-sm text-white/70">
            Podgląd Twojego kafelka w katalogu (bez modala — mamy tylko katalog + panel).
          </p>

          <div class="mt-4 profile-card p-4">
            <div class="flex items-center justify-between gap-3">
              <div class="flex items-center gap-3">
                <div class="avatar">
                  <img src="https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop" alt="Ty" />
                </div>
                <div>
                  <div class="font-extrabold">zxq0</div>
                  <div class="text-sm text-white/70 font-semibold">Programista</div>
                  <div class="text-xs text-white/55">React • Node • API</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <span class="badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>
                <span class="badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>
              </div>
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2">
              <div class="thumb aspect-[4/3]"></div>
              <div class="thumb aspect-[4/3]"></div>
              <div class="thumb aspect-[4/3]"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- LISTING -->
      <section id="tab-listing" class="space-y-4 hidden">
        <div class="glass rounded-2xl p-5">
          <div class="font-bold flex items-center gap-2">
            <i data-lucide="file-plus" class="h-5 w-5 text-[var(--accent)]"></i>
            Twoje ogłoszenie (wizytówka)
          </div>
          <p class="mt-2 text-sm text-white/70">
            Ogłoszenie = Twój wpis w katalogu.
          </p>

          <div class="mt-4 grid sm:grid-cols-2 gap-3">
            <div>
              <label class="label">Tytuł ogłoszenia</label>
              <input id="listing-title" class="input" placeholder="np. Programista React/Node — szybkie MVP" />
            </div>
            <div>
              <label class="label">Kanał kontaktu (główny)</label>
              <select id="listing-contact-main" class="input">
                <option>Discord</option>
                <option>E-mail</option>
                <option>Instagram</option>
                <option>Facebook</option>
              </select>
            </div>

            <div class="sm:col-span-2">
              <label class="label">Krótki opis (na kafelku)</label>
              <input id="listing-short" class="input" placeholder="2–3 zdania: co robisz i dla kogo." />
            </div>

            <div class="sm:col-span-2">
              <label class="label">Dłuższy opis (w profilu/panelu)</label>
              <textarea id="listing-long" class="input" rows="6" placeholder="Szczegóły usług, proces, terminy, zasady..."></textarea>
            </div>
          </div>

          <div class="mt-4 flex items-center gap-2">
            <button id="btn-publish" class="btn btn-primary px-4 py-3">
              <i data-lucide="rocket" class="h-4 w-4"></i>
              <span>Opublikuj / Zaktualizuj</span>
            </button>
            <button id="btn-unpublish" class="btn btn-outline px-4 py-3">
              <i data-lucide="trash-2" class="h-4 w-4"></i>
              <span>Ukryj z katalogu</span>
            </button>
          </div>
        </div>
      </section>

      <!-- SHOP -->
      <section id="tab-shop" class="space-y-4">
        <div class="glass rounded-2xl p-5">
          <div class="font-bold flex items-center gap-2">
            <i data-lucide="shopping-bag" class="h-5 w-5 text-[var(--accent)]"></i>
            Sklep usług
          </div>
          <p class="mt-2 text-sm text-white/70">
            Subskrypcje miesięczne (logika demo w JS).
          </p>

          <div class="mt-4 space-y-3">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="flex items-center gap-2">
                    <span class="badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium pozycjonowanie</span>
                  </div>
                  <p class="mt-2 text-sm text-white/70">Wyżej w wynikach i wyróżnienie.</p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-extrabold">23.99 PLN</div>
                  <div class="text-xs text-white/55">/ miesiąc</div>
                </div>
              </div>

              <div class="mt-3 flex flex-col sm:flex-row gap-2">
                <button id="buy-premium" class="btn btn-primary px-4 py-3">
                  <i data-lucide="credit-card" class="h-4 w-4"></i>
                  <span>Kup premium</span>
                </button>
                <button id="cancel-premium" class="btn btn-outline px-4 py-3">
                  <i data-lucide="x-circle" class="h-4 w-4"></i>
                  <span>Anuluj</span>
                </button>
              </div>
            </div>

            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="flex items-center gap-2">
                    <span class="badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Weryfikacja konta</span>
                  </div>
                  <p class="mt-2 text-sm text-white/70">Znaczek Verified w katalogu.</p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-extrabold">19.55 PLN</div>
                  <div class="text-xs text-white/55">/ miesiąc</div>
                </div>
              </div>

              <div class="mt-3 flex flex-col sm:flex-row gap-2">
                <button id="buy-verify" class="btn btn-primary px-4 py-3">
                  <i data-lucide="badge-check" class="h-4 w-4"></i>
                  <span>Kup weryfikację</span>
                </button>
                <button id="cancel-verify" class="btn btn-outline px-4 py-3">
                  <i data-lucide="x-circle" class="h-4 w-4"></i>
                  <span>Anuluj</span>
                </button>
              </div>
            </div>

            <div class="text-xs text-white/55">
              (To jest layout — logika w JS będzie w następnym kroku.)
            </div>
          </div>
        </div>
      </section>
    </div>
  </aside>
<script>
/**
 * Velorie Market (lite): tylko Katalog + Panel
 * - bez wyszukiwarki, bez sekcji "jak to działa/funkcje/faq/footer", bez modala profilu
 * - filtry na górze: branża + premium/verified/dostępny + sort
 * - zapis (bookmark) do localStorage
 * - panel (drawer) z zakładkami + edycją profilu + portfolio + ogłoszenie + sklep (subskrypcje demo)
 */

(() => {
  /* ----------------------------- helpers ----------------------------- */
  const $ = (sel, root = document) => root.querySelector(sel);
  const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

  const safeJSON = {
    parse(v, fallback) {
      try { return JSON.parse(v); } catch { return fallback; }
    },
    stringify(v, fallback = "{}") {
      try { return JSON.stringify(v); } catch { return fallback; }
    }
  };

  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

  function toast(message) {
    // ultra-prosty toast bez zależności
    let wrap = $("#toast-wrap");
    if (!wrap) {
      wrap = document.createElement("div");
      wrap.id = "toast-wrap";
      wrap.className = "fixed bottom-5 left-1/2 -translate-x-1/2 z-[120] space-y-2";
      document.body.appendChild(wrap);
    }
    const el = document.createElement("div");
    el.className =
      "glass rounded-2xl px-4 py-3 text-sm text-white/90 border border-white/10 shadow-glow max-w-[92vw]";
    el.textContent = message;
    wrap.appendChild(el);
    setTimeout(() => {
      el.style.opacity = "0";
      el.style.transform = "translateY(6px)";
      el.style.transition = "opacity .25s ease, transform .25s ease";
      setTimeout(() => el.remove(), 260);
    }, 1800);
  }

  function escapeHTML(str) {
    return String(str ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  /* ----------------------------- storage ----------------------------- */
  const LS = {
    keyProfiles: "vm_profiles_v1",
    keySaved: "vm_saved_v1",
    keySubs: "vm_subs_v1",
    keyMe: "vm_me_v1",
    getProfiles() {
      const v = localStorage.getItem(this.keyProfiles);
      return safeJSON.parse(v, null);
    },
    setProfiles(list) {
      localStorage.setItem(this.keyProfiles, safeJSON.stringify(list, "[]"));
    },
    getSaved() {
      const v = localStorage.getItem(this.keySaved);
      return new Set(safeJSON.parse(v, []));
    },
    setSaved(setOrArr) {
      const arr = Array.isArray(setOrArr) ? setOrArr : Array.from(setOrArr);
      localStorage.setItem(this.keySaved, safeJSON.stringify(arr, "[]"));
    },
    getSubs() {
      const v = localStorage.getItem(this.keySubs);
      return safeJSON.parse(v, { premium: false, verified: false });
    },
    setSubs(obj) {
      localStorage.setItem(this.keySubs, safeJSON.stringify(obj, "{}"));
    },
    getMe() {
      const v = localStorage.getItem(this.keyMe);
      return safeJSON.parse(v, null);
    },
    setMe(obj) {
      localStorage.setItem(this.keyMe, safeJSON.stringify(obj, "{}"));
    }
  };

  /* ----------------------------- demo data ---------------------------- */
  const FALLBACK_PROFILES = [
    {
      id: "p1",
      name: "zxq0",
      industry: "dev",
      industryLabel: "Programista",
      tagline: "React • Node • API • Automatyzacje",
      rating: 4.9,
      availableIn: "48h",
      minBudget: 300,
      location: "Online",
      premium: true,
      verified: true,
      avatar:
        "https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
      portfolio: [
        "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1551650975-87deedd944c3?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=900&auto=format&fit=crop"
      ],
      createdAt: Date.now() - 1000 * 60 * 60 * 24 * 10
    },
    {
      id: "p2",
      name: "Klaudia",
      industry: "gfx",
      industryLabel: "Grafik",
      tagline: "Branding • UI • Miniatury • Packi",
      rating: 4.7,
      availableIn: "24h",
      minBudget: 200,
      location: "Online",
      premium: true,
      verified: false,
      avatar:
        "https://images.unsplash.com/photo-1548142813-c348350df52b?q=80&w=512&auto=format&fit=crop",
      portfolio: [
        "https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=900&auto=format&fit=crop"
      ],
      createdAt: Date.now() - 1000 * 60 * 60 * 24 * 4
    },
    {
      id: "p3",
      name: "kubus",
      industry: "tech",
      industryLabel: "Technik / DevOps",
      tagline: "Linux • Proxy • Security • Optymalizacja",
      rating: 4.8,
      availableIn: "72h",
      minBudget: 250,
      location: "Online",
      premium: false,
      verified: true,
      avatar:
        "https://images.unsplash.com/photo-1603415526960-f7e0328b7cf6?q=80&w=512&auto=format&fit=crop",
      portfolio: [
        "https://images.unsplash.com/photo-1531297484001-80022131f5a1?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=900&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=900&auto=format&fit=crop"
      ],
      createdAt: Date.now() - 1000 * 60 * 60 * 24 * 7
    }
  ];

  function ensureInit() {
    // profiles
    if (!LS.getProfiles()) LS.setProfiles(FALLBACK_PROFILES);

    // me
    if (!LS.getMe()) {
      LS.setMe({
        id: "me",
        name: "zxq0",
        industry: "dev",
        about: "",
        availability: "48h",
        minBudget: 300,
        tags: ["React", "Node", "API", "Automatyzacje"],
        avatar:
          "https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=512&auto=format&fit=crop",
        portfolio: ["", "", ""],
        listing: {
          title: "",
          contactMain: "Discord",
          short: "",
          long: "",
          published: true
        }
      });
    }

    // saved (set)
    const s = localStorage.getItem(LS.keySaved);
    if (!s) LS.setSaved([]);

    // subs
    const sub = localStorage.getItem(LS.keySubs);
    if (!sub) LS.setSubs({ premium: false, verified: false });
  }

  /* ----------------------------- state ------------------------------ */
  const state = {
    industry: "all",
    premiumOnly: false,
    verifiedOnly: false,
    availableOnly: false,
    sort: "recommended",
    pageSize: 6,
    shown: 0
  };

  /* ------------------------- progress + reveal ------------------------ */
  function initProgress() {
    const bar = $("#scroll-progress");
    if (!bar) return;
    const onScroll = () => {
      const doc = document.documentElement;
      const max = doc.scrollHeight - doc.clientHeight;
      const p = max <= 0 ? 0 : (doc.scrollTop / max) * 100;
      bar.style.width = `${p}%`;
    };
    window.addEventListener("scroll", onScroll, { passive: true });
    onScroll();
  }

  function initReveal() {
    const els = $$(".animate-on-scroll");
    if (!els.length) return;
    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((e) => {
          if (e.isIntersecting) e.target.classList.add("is-visible");
        });
      },
      { threshold: 0.12 }
    );
    els.forEach((el) => io.observe(el));
  }

  /* --------------------------- drawer/panel --------------------------- */
  function setOverlay(open) {
    const ov = $("#overlay");
    if (!ov) return;
    ov.dataset.open = open ? "true" : "false";
    ov.setAttribute("aria-hidden", open ? "false" : "true");
  }

  function setPanelOpen(open) {
    const panel = $("#user-panel");
    if (!panel) return;
    panel.dataset.open = open ? "true" : "false";
    setOverlay(open);
    document.body.style.overflow = open ? "hidden" : "";
  }

  function switchTab(tab) {
    const ids = ["edit", "preview", "listing", "shop"];
    ids.forEach((id) => {
      const sec = $(`#tab-${id}`);
      if (sec) sec.classList.toggle("hidden", id !== tab);
    });
  }

  function bindPanel() {
    $("#btn-open-panel")?.addEventListener("click", () => setPanelOpen(true));
    $("#btn-open-panel-inline")?.addEventListener("click", () => setPanelOpen(true));
    $("#btn-close-panel")?.addEventListener("click", () => setPanelOpen(false));
    $("#overlay")?.addEventListener("click", () => setPanelOpen(false));
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setPanelOpen(false);
    });

    $$("[data-tab]").forEach((btn) => {
      btn.addEventListener("click", () => switchTab(btn.dataset.tab));
    });
  }

  /* ------------------------------ filters ----------------------------- */
  function bindFilters() {
    $("#industry-select")?.addEventListener("change", (e) => {
      state.industry = e.target.value;
      resetPagination();
      render();
    });

    $("#sort-select")?.addEventListener("change", (e) => {
      state.sort = e.target.value;
      resetPagination();
      render();
    });

    const toggleChip = (id, key) => {
      const el = $(id);
      if (!el) return;
      el.addEventListener("click", () => {
        state[key] = !state[key];
        el.style.background = state[key] ? "rgba(255,255,255,.10)" : "rgba(255,255,255,.05)";
        el.style.borderColor = state[key] ? "rgba(255,255,255,.18)" : "rgba(255,255,255,.10)";
        resetPagination();
        render();
      });
    };

    toggleChip("#filter-premium", "premiumOnly");
    toggleChip("#filter-verified", "verifiedOnly");
    toggleChip("#filter-available", "availableOnly");

    $("#btn-reset-filters")?.addEventListener("click", () => {
      state.industry = "all";
      state.premiumOnly = false;
      state.verifiedOnly = false;
      state.availableOnly = false;
      state.sort = "recommended";

      const industry = $("#industry-select");
      const sort = $("#sort-select");
      if (industry) industry.value = "all";
      if (sort) sort.value = "recommended";

      ["#filter-premium", "#filter-verified", "#filter-available"].forEach((id) => {
        const el = $(id);
        if (!el) return;
        el.style.background = "rgba(255,255,255,.05)";
        el.style.borderColor = "rgba(255,255,255,.10)";
      });

      resetPagination();
      render();
      toast("Zresetowano filtry.");
    });

    $("#btn-load-more")?.addEventListener("click", () => {
      state.shown += state.pageSize;
      renderList();
    });
  }

  function resetPagination() {
    state.shown = 0;
  }

  /* --------------------------- list rendering -------------------------- */
  function parseAvailableHours(str) {
    // "24h" -> 24; "Tydzień" -> 168
    const s = String(str || "").toLowerCase();
    if (s.includes("tydz")) return 168;
    const m = s.match(/(\d+)\s*h/);
    return m ? Number(m[1]) : 9999;
  }

  function scoreRecommended(p) {
    const premium = p.premium ? 1 : 0;
    const verified = p.verified ? 1 : 0;
    const rating = Number(p.rating || 0);
    const recency = typeof p.createdAt === "number" ? p.createdAt : 0;
    // prosty score: premium + verified + rating + recency (z małą wagą)
    return premium * 3 + verified * 2 + rating + recency / 1e12;
  }

  function getFilteredProfiles() {
    const profiles = LS.getProfiles() || [];
    let out = profiles.slice();

    if (state.industry !== "all") out = out.filter((p) => p.industry === state.industry);
    if (state.premiumOnly) out = out.filter((p) => !!p.premium);
    if (state.verifiedOnly) out = out.filter((p) => !!p.verified);
    if (state.availableOnly) out = out.filter((p) => parseAvailableHours(p.availableIn) <= 72);

    // sorting
    if (state.sort === "newest") {
      out.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
    } else if (state.sort === "rating") {
      out.sort((a, b) => (b.rating || 0) - (a.rating || 0));
    } else if (state.sort === "verified") {
      out.sort((a, b) => Number(!!b.verified) - Number(!!a.verified));
    } else {
      out.sort((a, b) => scoreRecommended(b) - scoreRecommended(a));
    }

    return out;
  }

  function profileCardHTML(p, savedSet) {
    const verified = p.verified
      ? `<span class="badge-verified"><i data-lucide="badge-check" class="h-4 w-4"></i> Verified</span>`
      : "";
    const premium = p.premium
      ? `<span class="badge-premium"><i data-lucide="zap" class="h-4 w-4"></i> Premium</span>`
      : "";

    const tags = [
      `<span class="chip"><i data-lucide="star" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Ocena ${escapeHTML(
        (p.rating ?? 0).toFixed(1)
      )}</span>`,
      `<span class="chip"><i data-lucide="clock" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Dostępny: ${escapeHTML(
        p.availableIn || "-"
      )}</span>`,
      `<span class="chip"><i data-lucide="map-pin" class="h-3.5 w-3.5 text-[var(--accent)]"></i> ${escapeHTML(
        p.location || "Online"
      )}</span>`,
      `<span class="chip"><i data-lucide="wallet" class="h-3.5 w-3.5 text-[var(--accent)]"></i> Budżet: od ${escapeHTML(
        p.minBudget ?? "-"
      )} PLN</span>`
    ].join("");

    const port = (p.portfolio || []).slice(0, 3);
    const thumbs = [0, 1, 2]
      .map((i) => {
        const src = port[i] || "";
        return `<div class="thumb aspect-[4/3]">${src ? `<img src="${escapeHTML(src)}" alt="Portfolio" />` : ""}</div>`;
      })
      .join("");

    const isSaved = savedSet.has(p.id);
    const saveLabel = isSaved ? "Zapisano" : "Zapisz";
    const saveIcon = isSaved ? "bookmark-check" : "bookmark";

    return `
      <article class="profile-card animate-on-scroll p-4 md:p-5" data-profile-id="${escapeHTML(p.id)}">
        <div class="flex flex-col md:flex-row md:items-center gap-4">
          <div class="flex items-center gap-3 min-w-[260px]">
            <div class="avatar">
              <img src="${escapeHTML(p.avatar || "")}" alt="Avatar" />
            </div>
            <div class="leading-tight">
              <div class="flex items-center gap-2 flex-wrap">
                <div class="text-lg font-extrabold tracking-tight">${escapeHTML(p.name || "Anon")}</div>
                ${verified}
                ${premium}
              </div>
              <div class="text-sm text-white/70 font-semibold">${escapeHTML(p.industryLabel || "")}</div>
              <div class="text-xs text-white/55">${escapeHTML(p.tagline || "")}</div>
            </div>
          </div>

          <div class="flex-1">
            <div class="flex flex-wrap items-center gap-2">
              ${tags}
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2">
              ${thumbs}
            </div>
          </div>

          <div class="flex md:flex-col gap-2 md:items-end">
            <button class="btn btn-ghost px-4 py-3 w-full md:w-auto btn-save" type="button" data-save="${escapeHTML(
              p.id
            )}">
              <i data-lucide="${saveIcon}" class="h-4 w-4"></i>
              <span>${saveLabel}</span>
            </button>
          </div>
        </div>
      </article>
    `;
  }

  function renderList() {
    const listEl = $("#profiles-list");
    if (!listEl) return;

    const saved = LS.getSaved();
    const all = getFilteredProfiles();
    const total = all.length;

    if (state.shown <= 0) state.shown = state.pageSize;
    const shownList = all.slice(0, state.shown);

    $("#total-count") && ($("#total-count").textContent = String(total));
    $("#shown-count") && ($("#shown-count").textContent = String(shownList.length));

    if (!shownList.length) {
      listEl.innerHTML = `
        <div class="glass rounded-2xl p-6 text-white/80">
          Brak wyników dla wybranych filtrów.
        </div>
      `;
      try { lucide.createIcons(); } catch {}
      return;
    }

    listEl.innerHTML = shownList.map((p) => profileCardHTML(p, saved)).join("");

    // re-bind save buttons
    $$(".btn-save", listEl).forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.save;
        if (!id) return;
        const set = LS.getSaved();
        if (set.has(id)) {
          set.delete(id);
          toast("Usunięto z zapisanych.");
        } else {
          set.add(id);
          toast("Dodano do zapisanych.");
        }
        LS.setSaved(set);
        renderList();
      });
    });

    // load more button state
    const loadMore = $("#btn-load-more");
    if (loadMore) {
      const canMore = state.shown < total;
      loadMore.style.display = canMore ? "inline-flex" : "none";
    }

    // reveal again + icons
    initReveal();
    try { lucide.createIcons(); } catch {}
  }

  function renderPanelFromMe() {
    const me = LS.getMe();
    if (!me) return;

    $("#panel-username") && ($("#panel-username").textContent = me.name || "Użytkownik");
    $("#panel-avatar") && ($("#panel-avatar").src = me.avatar || "");

    // edit fields
    $("#edit-name") && ($("#edit-name").value = me.name || "");
    $("#edit-industry") && ($("#edit-industry").value = me.industry || "dev");
    $("#edit-about") && ($("#edit-about").value = me.about || "");
    $("#edit-availability") && ($("#edit-availability").value = me.availability || "48h");
    $("#edit-budget") && ($("#edit-budget").value = String(me.minBudget ?? 0));
    $("#edit-tags") && ($("#edit-tags").value = (me.tags || []).join(", "));
    $("#edit-avatar-url") && ($("#edit-avatar-url").value = "");

    // portfolio
    $("#edit-portfolio-1") && ($("#edit-portfolio-1").value = me.portfolio?.[0] || "");
    $("#edit-portfolio-2") && ($("#edit-portfolio-2").value = me.portfolio?.[1] || "");
    $("#edit-portfolio-3") && ($("#edit-portfolio-3").value = me.portfolio?.[2] || "");

    // listing
    $("#listing-title") && ($("#listing-title").value = me.listing?.title || "");
    $("#listing-contact-main") && ($("#listing-contact-main").value = me.listing?.contactMain || "Discord");
    $("#listing-short") && ($("#listing-short").value = me.listing?.short || "");
    $("#listing-long") && ($("#listing-long").value = me.listing?.long || "");

    // subs (shop)
    const subs = LS.getSubs();
    // (tu tylko toasty/disable w UI ogarniemy prosto)
    const buyP = $("#buy-premium");
    const cancelP = $("#cancel-premium");
    const buyV = $("#buy-verify");
    const cancelV = $("#cancel-verify");

    if (buyP) buyP.disabled = !!subs.premium;
    if (cancelP) cancelP.disabled = !subs.premium;
    if (buyV) buyV.disabled = !!subs.verified;
    if (cancelV) cancelV.disabled = !subs.verified;

    // wizualnie przygaszaj disabled
    [buyP, cancelP, buyV, cancelV].forEach((b) => {
      if (!b) return;
      b.classList.toggle("opacity-60", b.disabled);
      b.classList.toggle("pointer-events-none", b.disabled);
    });
  }

  function upsertMeIntoProfiles() {
    const me = LS.getMe();
    if (!me) return;

    const subs = LS.getSubs();

    // mapping
    const industryLabelMap = {
      dev: "Programista",
      gfx: "Grafik",
      video: "Montażysta / Content",
      tech: "Technik / DevOps",
      mc: "Budowniczy Minecraft"
    };

    const p = {
      id: "me",
      name: me.name || "Ja",
      industry: me.industry || "dev",
      industryLabel: industryLabelMap[me.industry] || "Freelancer",
      tagline: (me.tags || []).slice(0, 6).join(" • "),
      rating: 5.0,
      availableIn: me.availability || "48h",
      minBudget: Number(me.minBudget || 0),
      location: "Online",
      premium: !!subs.premium,
      verified: !!subs.verified,
      avatar: me.avatar || "",
      portfolio: (me.portfolio || ["", "", ""]).slice(0, 3),
      createdAt: Date.now()
    };

    const profiles = LS.getProfiles() || [];
    const idx = profiles.findIndex((x) => x.id === "me");

    // publikacja ogłoszenia kontroluje widoczność
    const published = me.listing?.published !== false;

    if (!published) {
      // jeśli ma być ukryty, usuń "me" z listy
      if (idx !== -1) {
        profiles.splice(idx, 1);
        LS.setProfiles(profiles);
      }
      return;
    }

    if (idx === -1) profiles.unshift(p);
    else profiles[idx] = { ...profiles[idx], ...p };

    LS.setProfiles(profiles);
  }

  function bindProfileSave() {
    $("#btn-save-profile")?.addEventListener("click", () => {
      const me = LS.getMe() || {};
      const name = $("#edit-name")?.value?.trim() || me.name || "Użytkownik";
      const industry = $("#edit-industry")?.value || me.industry || "dev";
      const about = $("#edit-about")?.value || "";
      const availability = $("#edit-availability")?.value || "48h";
      const minBudget = clamp(Number($("#edit-budget")?.value || 0), 0, 10_000_000);
      const tagsRaw = $("#edit-tags")?.value || "";
      const tags = tagsRaw
        .split(",")
        .map((s) => s.trim())
        .filter(Boolean)
        .slice(0, 12);

      const avatarURLInput = ($("#edit-avatar-url")?.value || "").trim();
      const avatar = avatarURLInput || me.avatar || "";

      const p1 = ($("#edit-portfolio-1")?.value || "").trim();
      const p2 = ($("#edit-portfolio-2")?.value || "").trim();
      const p3 = ($("#edit-portfolio-3")?.value || "").trim();

      const next = {
        ...me,
        name,
        industry,
        about,
        availability,
        minBudget,
        tags,
        avatar,
        portfolio: [p1, p2, p3],
        listing: me.listing || { title: "", contactMain: "Discord", short: "", long: "", published: true }
      };

      LS.setMe(next);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      renderList();
      toast("Zapisano profil.");
    });

    $("#btn-reset-profile")?.addEventListener("click", () => {
      localStorage.removeItem(LS.keyMe);
      ensureInit();
      renderPanelFromMe();
      upsertMeIntoProfiles();
      resetPagination();
      render();
      toast("Przywrócono domyślne dane profilu (demo).");
    });
  }

  function bindListing() {
    $("#btn-publish")?.addEventListener("click", () => {
      const me = LS.getMe();
      if (!me) return;

      const title = ($("#listing-title")?.value || "").trim();
      const contactMain = $("#listing-contact-main")?.value || "Discord";
      const short = ($("#listing-short")?.value || "").trim();
      const long = ($("#listing-long")?.value || "").trim();

      me.listing = {
        ...(me.listing || {}),
        title,
        contactMain,
        short,
        long,
        published: true
      };

      LS.setMe(me);
      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      toast("Ogłoszenie opublikowane / zaktualizowane.");
    });

    $("#btn-unpublish")?.addEventListener("click", () => {
      const me = LS.getMe();
      if (!me) return;
      me.listing = { ...(me.listing || {}), published: false };
      LS.setMe(me);

      upsertMeIntoProfiles();
      resetPagination();
      renderList();
      toast("Ogłoszenie ukryte w katalogu.");
    });
  }

  function bindShop() {
    $("#buy-premium")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.premium = true;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      renderList();
      toast("Premium aktywowane (demo).");
    });

    $("#cancel-premium")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.premium = false;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      renderList();
      toast("Premium anulowane (demo).");
    });

    $("#buy-verify")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.verified = true;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      renderList();
      toast("Weryfikacja aktywowana (demo).");
    });

    $("#cancel-verify")?.addEventListener("click", () => {
      const subs = LS.getSubs();
      subs.verified = false;
      LS.setSubs(subs);
      renderPanelFromMe();
      upsertMeIntoProfiles();
      renderList();
      toast("Weryfikacja anulowana (demo).");
    });
  }

  /* ------------------------------- render ------------------------------ */
  function render() {
    renderPanelFromMe();
    upsertMeIntoProfiles();
    renderList();
  }

  /* ------------------------------- boot ------------------------------- */
  document.addEventListener("DOMContentLoaded", () => {
    ensureInit();

    initProgress();
    bindPanel();
    bindFilters();
    bindProfileSave();
    bindListing();
    bindShop();

    // domyślnie pokaż zakładkę "shop" bo w HTML przycisk jest primary
    switchTab("shop");

    render();

    // icons
    try { lucide.createIcons(); } catch {}

    // focus: jeśli user wraca, przewiń do katalogu
    // (nie wymuszam, tylko jeśli hash)
    if (location.hash && location.hash.includes("katalog")) {
      const el = $("#katalog");
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  });
})();
</script>

</body>
</html>
